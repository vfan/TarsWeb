(function(e){function t(t){for(var o,n,l=t[0],i=t[1],c=t[2],p=0,u=[];p<l.length;p++)n=l[p],Object.prototype.hasOwnProperty.call(s,n)&&s[n]&&u.push(s[n][0]),s[n]=0;for(o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o]);d&&d(t);while(u.length)u.shift()();return r.push.apply(r,c||[]),a()}function a(){for(var e,t=0;t<r.length;t++){for(var a=r[t],o=!0,l=1;l<a.length;l++){var i=a[l];0!==s[i]&&(o=!1)}o&&(r.splice(t--,1),e=n(n.s=a[0]))}return e}var o={},s={index:0},r=[];function n(t){if(o[t])return o[t].exports;var a=o[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=o,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(a,o,function(t){return e[t]}.bind(null,o));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/";var l=window["webpackJsonp"]=window["webpackJsonp"]||[],i=l.push.bind(l);l.push=t,l=l.slice();for(var c=0;c<l.length;c++)t(l[c]);var d=i;r.push([0,"chunk-vendors","chunk-common"]),a()})({0:function(e,t,a){e.exports=a("56d7")},"0745":function(e,t,a){"use strict";var o=a("337b"),s=a.n(o);s.a},"169f":function(e,t,a){},"1a1a":function(e,t,a){},"1eed":function(e,t,a){"use strict";var o=a("319d"),s=a.n(o);s.a},2541:function(e,t,a){"use strict";var o=a("5793"),s=a.n(o);s.a},"319d":function(e,t,a){},"337b":function(e,t,a){},4678:function(e,t,a){var o={"./af":"2bfb","./af.js":"2bfb","./ar":"8e73","./ar-dz":"a356","./ar-dz.js":"a356","./ar-kw":"423e","./ar-kw.js":"423e","./ar-ly":"1cfd","./ar-ly.js":"1cfd","./ar-ma":"0a84","./ar-ma.js":"0a84","./ar-sa":"8230","./ar-sa.js":"8230","./ar-tn":"6d83","./ar-tn.js":"6d83","./ar.js":"8e73","./az":"485c","./az.js":"485c","./be":"1fc1","./be.js":"1fc1","./bg":"84aa","./bg.js":"84aa","./bm":"a7fa","./bm.js":"a7fa","./bn":"9043","./bn.js":"9043","./bo":"d26a","./bo.js":"d26a","./br":"6887","./br.js":"6887","./bs":"2554","./bs.js":"2554","./ca":"d716","./ca.js":"d716","./cs":"3c0d","./cs.js":"3c0d","./cv":"03ec","./cv.js":"03ec","./cy":"9797","./cy.js":"9797","./da":"0f14","./da.js":"0f14","./de":"b469","./de-at":"b3eb","./de-at.js":"b3eb","./de-ch":"bb71","./de-ch.js":"bb71","./de.js":"b469","./dv":"598a","./dv.js":"598a","./el":"8d47","./el.js":"8d47","./en-SG":"cdab","./en-SG.js":"cdab","./en-au":"0e6b","./en-au.js":"0e6b","./en-ca":"3886","./en-ca.js":"3886","./en-gb":"39a6","./en-gb.js":"39a6","./en-ie":"e1d3","./en-ie.js":"e1d3","./en-il":"7333","./en-il.js":"7333","./en-nz":"6f50","./en-nz.js":"6f50","./eo":"65db","./eo.js":"65db","./es":"898b","./es-do":"0a3c","./es-do.js":"0a3c","./es-us":"55c9","./es-us.js":"55c9","./es.js":"898b","./et":"ec18","./et.js":"ec18","./eu":"0ff2","./eu.js":"0ff2","./fa":"8df4","./fa.js":"8df4","./fi":"81e9","./fi.js":"81e9","./fo":"0721","./fo.js":"0721","./fr":"9f26","./fr-ca":"d9f8","./fr-ca.js":"d9f8","./fr-ch":"0e49","./fr-ch.js":"0e49","./fr.js":"9f26","./fy":"7118","./fy.js":"7118","./ga":"5120","./ga.js":"5120","./gd":"f6b4","./gd.js":"f6b4","./gl":"8840","./gl.js":"8840","./gom-latn":"0caa","./gom-latn.js":"0caa","./gu":"e0c5","./gu.js":"e0c5","./he":"c7aa","./he.js":"c7aa","./hi":"dc4d","./hi.js":"dc4d","./hr":"4ba9","./hr.js":"4ba9","./hu":"5b14","./hu.js":"5b14","./hy-am":"d6b6","./hy-am.js":"d6b6","./id":"5038","./id.js":"5038","./is":"0558","./is.js":"0558","./it":"6e98","./it-ch":"6f12","./it-ch.js":"6f12","./it.js":"6e98","./ja":"079e","./ja.js":"079e","./jv":"b540","./jv.js":"b540","./ka":"201b","./ka.js":"201b","./kk":"6d79","./kk.js":"6d79","./km":"e81d","./km.js":"e81d","./kn":"3e92","./kn.js":"3e92","./ko":"22f8","./ko.js":"22f8","./ku":"2421","./ku.js":"2421","./ky":"9609","./ky.js":"9609","./lb":"440c","./lb.js":"440c","./lo":"b29d","./lo.js":"b29d","./lt":"26f9","./lt.js":"26f9","./lv":"b97c","./lv.js":"b97c","./me":"293c","./me.js":"293c","./mi":"688b","./mi.js":"688b","./mk":"6909","./mk.js":"6909","./ml":"02fb","./ml.js":"02fb","./mn":"958b","./mn.js":"958b","./mr":"39bd","./mr.js":"39bd","./ms":"ebe4","./ms-my":"6403","./ms-my.js":"6403","./ms.js":"ebe4","./mt":"1b45","./mt.js":"1b45","./my":"8689","./my.js":"8689","./nb":"6ce3","./nb.js":"6ce3","./ne":"3a39","./ne.js":"3a39","./nl":"facd","./nl-be":"db29","./nl-be.js":"db29","./nl.js":"facd","./nn":"b84c","./nn.js":"b84c","./pa-in":"f3ff","./pa-in.js":"f3ff","./pl":"8d57","./pl.js":"8d57","./pt":"f260","./pt-br":"d2d4","./pt-br.js":"d2d4","./pt.js":"f260","./ro":"972c","./ro.js":"972c","./ru":"957c","./ru.js":"957c","./sd":"6784","./sd.js":"6784","./se":"ffff","./se.js":"ffff","./si":"eda5","./si.js":"eda5","./sk":"7be6","./sk.js":"7be6","./sl":"8155","./sl.js":"8155","./sq":"c8f3","./sq.js":"c8f3","./sr":"cf1e","./sr-cyrl":"13e9","./sr-cyrl.js":"13e9","./sr.js":"cf1e","./ss":"52bd","./ss.js":"52bd","./sv":"5fbd","./sv.js":"5fbd","./sw":"74dc","./sw.js":"74dc","./ta":"3de5","./ta.js":"3de5","./te":"5cbb","./te.js":"5cbb","./tet":"576c","./tet.js":"576c","./tg":"3b1b","./tg.js":"3b1b","./th":"10e8","./th.js":"10e8","./tl-ph":"0f38","./tl-ph.js":"0f38","./tlh":"cf75","./tlh.js":"cf75","./tr":"0e81","./tr.js":"0e81","./tzl":"cf51","./tzl.js":"cf51","./tzm":"c109","./tzm-latn":"b53d","./tzm-latn.js":"b53d","./tzm.js":"c109","./ug-cn":"6117","./ug-cn.js":"6117","./uk":"ada2","./uk.js":"ada2","./ur":"5294","./ur.js":"5294","./uz":"2e8c","./uz-latn":"010e","./uz-latn.js":"010e","./uz.js":"2e8c","./vi":"2921","./vi.js":"2921","./x-pseudo":"fd7e","./x-pseudo.js":"fd7e","./yo":"7f33","./yo.js":"7f33","./zh-cn":"5c3a","./zh-cn.js":"5c3a","./zh-hk":"49ab","./zh-hk.js":"49ab","./zh-tw":"90ea","./zh-tw.js":"90ea"};function s(e){var t=r(e);return a(t)}function r(e){if(!a.o(o,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return o[e]}s.keys=function(){return Object.keys(o)},s.resolve=r,e.exports=s,s.id="4678"},"4dec":function(e,t,a){"use strict";var o=a("ca5f"),s=a.n(o);s.a},"523f":function(e,t,a){"use strict";var o=a("fc15"),s=a.n(o);s.a},"56d7":function(e,t,a){"use strict";a.r(t);a("e260"),a("e6cf"),a("cca6"),a("a79d");var o=a("a026"),s=(a("42a1"),a("b3f5"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"app"}},[a("app-header"),a("p",{attrs:{id:"web_version"}},[e._v("Version:"+e._s(e.web_version))]),a("keep-alive",[a("router-view",{staticClass:"main-width"})],1),a("app-footer",{staticClass:"app_index__footer"})],1)}),r=[],n=a("bc3a"),l=a.n(n),i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app_index__header"},[a("div",{staticClass:"main-width"},[a("h1",{staticClass:"hidden"},[e._v("TARS")]),a("div",{staticClass:"logo-wrap"},[a("a",{class:{active:"true"===e.dcache},attrs:{href:"/"}},[a("img",{staticClass:"logo",attrs:{src:"/static/img/tars-logo.png"}})]),"true"===e.dcache?a("a",{attrs:{href:"/dcache.html"}},[a("img",{staticClass:"logo",attrs:{alt:"dcache",src:"/static/img/dcache-logo.png"}})]):e._e()]),a("let-tabs",{staticClass:"tabs",attrs:{center:!0,activekey:e.$route.matched[0].path},on:{click:e.clickTab}},[a("let-tab-pane",{attrs:{tab:e.$t("header.tab.tab1"),tabkey:"/server",icon:e.serverIcon}}),a("let-tab-pane",{attrs:{tab:e.$t("header.tab.tab2"),tabkey:"/operation",icon:e.opaIcon}})],1),a("div",{staticClass:"language-wrap"},[a("let-select",{attrs:{clearable:!1},on:{change:e.changeLocale},model:{value:e.locale,callback:function(t){e.locale=t},expression:"locale"}},[e._l(e.localeMessages,(function(t){return[a("let-option",{key:t.localeCode,attrs:{value:t.localeCode}},[e._v(e._s(t.localeName))])]}))],2)],1),a("div",{staticClass:"user-wrap"},[a("p",{staticClass:"user-info",on:{click:function(t){e.userOptOpen=!e.userOptOpen}}},[a("span",{staticClass:"name toe"},[e._v(e._s(e.uid)+" ")]),a("i",{directives:[{name:"show",rawName:"v-show",value:e.enableLogin,expression:"enableLogin"}],staticClass:"let-icon let-icon-caret-down",class:{up:e.userOptOpen}}),a("transition",{attrs:{name:"fade"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:e.enableLogin&&e.userOptOpen,expression:"enableLogin && userOptOpen"}],staticClass:"user-pop-wrap"},[a("div",[a("a",{attrs:{href:"#"},on:{click:e.userCenter}},[e._v(e._s(e.$t("header.userCenter")))])]),a("div",[a("a",{attrs:{href:"/logout"}},[e._v(e._s(e.$t("header.logout")))])])])])],1)])],1)])},c=[],d=(a("ac1f"),a("5319"),a("1817")),p=a.n(d),u=a("1ca6"),m=a.n(u),h=a("f51c"),f={data:function(){return{serverIcon:p.a,opaIcon:m.a,locale:this.$cookie.get("locale")||"cn",uid:"--",userOptOpen:!1,enableLogin:!1,isAdmin:!1,localeMessages:h["c"],dcache:this.$cookie.get("dcache")||"false"}},methods:{clickTab:function(e){this.$router.replace(e)},userCenter:function(){window.open("/pages/server/api/userCenter")},getLoginUid:function(){var e=this;this.$ajax.getJSON("/server/api/get_login_uid").then((function(t){t&&t.uid?e.uid=t.uid:e.uid="***"})).catch((function(t){e.$tip.error("获取用户登录信息: ".concat(t.err_msg||t.message))}))},changeLocale:function(){this.$cookie.set("locale",this.locale,{expires:"1Y"}),location.reload()},checkEnableLogin:function(){var e=this;this.$ajax.getJSON("/server/api/is_enable_login").then((function(t){e.enableLogin=t.enableLogin||!1})).catch((function(e){}))},checkAdmin:function(){var e=this;this.isAdmin=!1,this.$ajax.getJSON("/server/api/is_admin").then((function(t){e.isAdmin=t.admin})).catch((function(e){}))}},mounted:function(){this.getLoginUid(),this.checkEnableLogin(),this.checkAdmin(),window.header=this}},v=f,b=(a("a8f5"),a("2877")),_=Object(b["a"])(v,i,c,!1,null,null,null),g=_.exports,$=a("559f"),w={name:"App",components:{AppHeader:g,AppFooter:$["a"]},data:function(){return{web_version:" loading··"}},mounted:function(){var e=this;l.a.create({baseURL:"/"})({method:"get",url:"/web_version"}).then((function(t){e.web_version=t.data}))}},y=w,k=(a("a5d2"),Object(b["a"])(y,s,r,!1,null,null,null)),x=k.exports,S=a("8c4f"),M=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"page_server"},[e.treeData&&e.treeData.length?o("let-tree",{staticClass:"left-tree",attrs:{data:e.treeData,activeKey:e.$route.params.treeid},on:{"on-select":e.selectTree}}):e._e(),e.treeData&&!e.treeData.length?o("div",{staticClass:"left-tree"},[o("p",{staticClass:"loading"},[e._v(e._s(e.$t("common.noService")))])]):e._e(),e.treeData?e._e():o("div",{ref:"treeLoading",staticClass:"left-tree"},[!1===e.treeData?o("div",{staticClass:"loading"},[o("p",[e._v(e._s(e.treeErrMsg))]),o("a",{attrs:{href:"javascript:;"},on:{click:e.getTreeData}},[e._v(e._s(e.$t("common.reTry")))])]):e._e()]),this.$route.params.treeid?o("div",{staticClass:"right-view"},[o("let-tabs",{attrs:{activekey:e.$route.path},on:{click:e.clickTab}},[o("let-tab-pane",{attrs:{tabkey:e.base+"/manage",tab:e.$t("header.tab.tab1")}}),5===e.serverData.level?o("let-tab-pane",{attrs:{tabkey:e.base+"/publish",tab:e.$t("index.rightView.tab.patch")}}):e._e(),5===e.serverData.level||4===e.serverData.level||1===e.serverData.level?o("let-tab-pane",{attrs:{tabkey:e.base+"/config",tab:5===e.serverData.level?e.$t("index.rightView.tab.serviceConfig"):4===e.serverData.level?e.$t("index.rightView.tab.setConfig"):1===e.serverData.level?e.$t("index.rightView.tab.appConfig"):""}}):e._e(),5===e.serverData.level?o("let-tab-pane",{attrs:{tabkey:e.base+"/server-monitor",tab:e.$t("index.rightView.tab.statMonitor")}}):e._e(),5===e.serverData.level?o("let-tab-pane",{attrs:{tabkey:e.base+"/property-monitor",tab:e.$t("index.rightView.tab.propertyMonitor")}}):e._e(),5===e.serverData.level?o("let-tab-pane",{attrs:{tabkey:e.base+"/interface-debuger",tab:e.$t("index.rightView.tab.infDebuger")}}):e._e(),5===e.serverData.level&&e.enableAuth?o("let-tab-pane",{attrs:{tabkey:e.base+"/user-manage",tab:e.$t("index.rightView.tab.privileage")}}):e._e()],1),o("router-view",{key:e.$route.params.treeid,ref:"childView",staticClass:"page_server_child"})],1):o("div",{staticClass:"right-view"},[o("div",{staticClass:"empty",staticStyle:{width:"300px"}},[o("img",{staticClass:"package",attrs:{src:a("4824")}}),o("p",{staticClass:"title"},[e._v(e._s(e.$t("index.rightView.title")))]),o("p",{staticClass:"notice",domProps:{innerHTML:e._s(e.$t("index.rightView.tips"))}}),o("p",{staticClass:"notice"},[e._v("https://github.com/TarsCloud/Tars")])])])],1)},L=[],j=(a("4160"),a("b0c0"),a("1276"),a("159b"),{name:"Server",data:function(){return{treeErrMsg:"load failed",treeData:null,enableAuth:!1,serverData:{level:5,application:"",server_name:"",set_name:"",set_area:"",set_group:""}}},computed:{base:function(){return"/server/".concat(this.$route.params.treeid)}},watch:{"$route.params.treeid":function(e){this.serverData=this.getServerData(),this.isTrueTreeLevel()},$route:function(e,t){"/server"===e.path&&this.getTreeData()}},methods:{selectTree:function(e){"/server"===this.$route.path?this.$router.push("/server/".concat(e,"/manage")):this.$router.push({params:{treeid:e}})},handleData:function(e,t){var a=this;e&&e.length&&e.forEach((function(e){e.label=e.name,e.nodeKey=e.id,t&&(e.iconClass="tree-icon",e.expand=!0),e.children&&e.children.length&&a.handleData(e.children)}))},getTreeData:function(){var e=this;this.treeData=null,this.$nextTick((function(){var t=e.$loading.show({target:e.$refs.treeLoading});e.$ajax.getJSON("/server/api/tree").then((function(a){t.hide(),e.treeData=a,e.handleData(e.treeData,!0)})).catch((function(a){t.hide(),e.treeErrMsg=a.err_msg||a.message||"加载失败",e.treeData=!1}))}))},getServerData:function(){if(!this.$route.params.treeid)return{};var e=this.$route.params.treeid.split("."),t={level:5,application:"",server_name:"",set_name:"",set_area:"",set_group:""};return e.forEach((function(e){var a=+e.substr(0,1),o=e.substr(1);switch(a){case 1:t.application=o;break;case 2:t.set_name=o;break;case 3:t.set_area=o;break;case 4:t.set_group=o;break;case 5:t.server_name=o;break;default:break}t.level=a})),t},clickTab:function(e){this.$router.push(Object.assign({},this.$route,{path:e}))},isTrueTreeLevel:function(){var e=this.$route.path.split("/"),t=e[e.length-1],a=!1;5===this.serverData.level||"publish"!==t&&"server-monitor"!==t&&"property-monitor"!==t&&"user-manage"!==t||(a=!0),5!==this.serverData.level&&4!==this.serverData.level&&1!==this.serverData.level&&"config"===t&&(a=!0),a&&this.$router.replace("manage")}},created:function(){this.serverData=this.getServerData(),this.isTrueTreeLevel()},mounted:function(){var e=this;this.getTreeData(),this.$ajax.getJSON("/server/api/is_enable_auth").then((function(t){e.enableAuth=t.enableAuth||!1})).catch((function(e){}))}}),C=j,T=(a("9ce0"),Object(b["a"])(C,M,L,!1,null,null,null)),N=T.exports,P=a("e84a"),q=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page_server_publish"},[a("div",[e.serverList&&e.serverList.length>0?a("let-table",{ref:"table",attrs:{data:e.serverList,title:e.$t("serverList.title.serverList"),"empty-msg":e.$t("common.noService")}},[a("let-table-column",{scopedSlots:e._u([{key:"head",fn:function(t){return[a("let-checkbox",{model:{value:e.isCheckedAll,callback:function(t){e.isCheckedAll=t},expression:"isCheckedAll"}})]}},{key:"default",fn:function(t){return[a("let-checkbox",{attrs:{value:t.row.id},model:{value:t.row.isChecked,callback:function(a){e.$set(t.row,"isChecked",a)},expression:"scope.row.isChecked"}})]}}],null,!1,1693185143)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.ip"),prop:"node_name"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.enableSet")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.enable_set?e.$t("common.enable"):e.$t("common.disable")))])]}}],null,!1,2059146282)}),a("let-table-column",{attrs:{title:e.$t("common.set.setName"),prop:"set_name"}}),a("let-table-column",{attrs:{title:e.$t("common.set.setArea"),prop:"set_area"}}),a("let-table-column",{attrs:{title:e.$t("common.set.setGroup"),prop:"set_group"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.configStatus")},scopedSlots:e._u([{key:"default",fn:function(e){return[a("span",{class:"active"==e.row.setting_state?"status-active":"status-off"})]}}],null,!1,483453731)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.currStatus")},scopedSlots:e._u([{key:"default",fn:function(e){return[a("span",{class:"active"==e.row.present_state?"status-active":"status-off"})]}}],null,!1,3783586142)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.version"),prop:"patch_version"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.time")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticStyle:{"word-break":"break-word"}},[e._v(e._s(e.handleNoPublishedTime(t.row.patch_time)))])]}}],null,!1,3144837894)}),a("let-pagination",{attrs:{slot:"pagination",align:"right",total:e.totalPage,page:e.page},on:{change:e.changePage},slot:"pagination"}),a("div",{staticStyle:{"margin-left":"-15px"},attrs:{slot:"operations"},slot:"operations"},[a("let-button",{attrs:{theme:"primary",size:"small"},on:{click:e.openPublishModal}},[e._v(e._s(e.$t("pub.btn.pub")))]),e.serverList&&e.serverList.length>0?a("let-button",{attrs:{size:"small"},on:{click:e.gotoHistory}},[e._v(e._s(e.$t("pub.btn.history")))]):e._e()],1)],1):e._e(),a("let-modal",{attrs:{title:e.$t("index.rightView.tab.patch"),width:"880px",footShow:!1},on:{close:e.closePublishModal,"on-confirm":e.savePublishServer},model:{value:e.publishModal.show,callback:function(t){e.$set(e.publishModal,"show",t)},expression:"publishModal.show"}},[e.publishModal.model?a("let-form",{ref:"publishForm",attrs:{itemWidth:"100%"}},[a("let-form-item",{attrs:{label:e.$t("serverList.servant.appService")}},[e._v(" "+e._s(e.publishModal.model.application)+"·"+e._s(e.publishModal.model.server_name)+" ")]),a("let-form-item",{attrs:{label:e.$t("pub.dlg.ip")}},e._l(e.publishModal.model.serverList,(function(t){return a("div",{key:t.id},[e._v(e._s(t.node_name))])})),0),a("let-form-item",{attrs:{label:e.$t("serverList.servant.comment")}},[a("let-input",{model:{value:e.publishModal.model.update_text,callback:function(t){e.$set(e.publishModal.model,"update_text",t)},expression:"publishModal.model.update_text"}})],1),e.patchRadioData.length>1?a("let-form-item",{attrs:{label:e.$t("pub.dlg.patchType")}},[a("let-radio-group",{attrs:{type:"button",size:"small",data:e.patchRadioData},on:{change:e.patchChange},model:{value:e.patchType,callback:function(t){e.patchType=t},expression:"patchType"}})],1):e._e(),e.publishModal.model.show?a("let-form-item",{attrs:{label:e.$t("pub.dlg.releaseVersion")}},[a("div",[a("let-select",{staticStyle:{width:"50%"},attrs:{size:"small",required:"","required-tip":e.$t("pub.dlg.ab")},model:{value:e.publishModal.model.patch_id,callback:function(t){e.$set(e.publishModal.model,"patch_id",t)},expression:"publishModal.model.patch_id"}},e._l(e.publishModal.model.patchList,(function(t){return a("let-option",{key:t.id,attrs:{value:t.id}},[e._v(" "+e._s(t.id)+" | "+e._s(t.posttime)+" | "+e._s(t.comment)+" ")])})),1),e._v(" "),a("let-button",{attrs:{theme:"primary",size:"small"},on:{click:e.showUploadModal}},[e._v(e._s(e.$t("pub.dlg.upload")))]),e._v(" "),a("let-button",{attrs:{size:"small"},on:{click:e.gotoPackage}},[e._v(e._s(e.$t("managePackage.title")))])],1),a("br"),a("let-button",{staticClass:"mt10",attrs:{theme:"primary",size:"small"},on:{click:e.savePublishServer}},[e._v(e._s(e.$t("common.patch")))])],1):a("let-form-item",{attrs:{label:e.$t("serverList.table.th.version")}},[a("let-select",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty"),requred:""},model:{value:e.tagVersion,callback:function(t){e.tagVersion=t},expression:"tagVersion"}},e._l(e.tagList,(function(t){return a("let-option",{key:""+t.version,attrs:{value:t.path+"--"+t.version}},[e._v(e._s(t.version))])})),1),a("let-button",{staticClass:"mt10",attrs:{theme:"primary",size:"small"},on:{click:e.addCompileTask}},[e._v(e._s(e.$t("pub.dlg.compileAndPublish")))]),e._e()],1)],1):e._e()],1),a("let-modal",{attrs:{title:e.$t("pub.dlg.upload"),width:"880px",footShow:!1},on:{"on-cancel":e.closeUploadModal},model:{value:e.uploadModal.show,callback:function(t){e.$set(e.uploadModal,"show",t)},expression:"uploadModal.show"}},[e.uploadModal.model?a("let-form",{ref:"uploadForm",attrs:{itemWidth:"100%"},nativeOn:{submit:function(t){return t.preventDefault(),e.uploadPatchPackage(t)}}},[a("let-form-item",{attrs:{label:e.$t("pub.dlg.releasePkg"),itemWidth:"400px"}},[a("let-uploader",{attrs:{placeholder:e.$t("pub.dlg.defaultValue")},on:{upload:e.uploadFile}},[e._v(e._s(e.$t("common.choose"))+" ")]),e.uploadModal.model.file?a("span",[e._v(e._s(e.uploadModal.model.file.name))]):e._e()],1),a("let-form-item",{attrs:{label:e.$t("serverList.servant.comment")}},[a("let-input",{attrs:{type:"textarea",rows:3},model:{value:e.uploadModal.model.comment,callback:function(t){e.$set(e.uploadModal.model,"comment",t)},expression:"uploadModal.model.comment"}})],1),a("let-button",{attrs:{type:"submit",theme:"primary"}},[e._v(e._s(e.$t("serverList.servant.upload")))])],1):e._e()],1),a("PublishStatus",{ref:"publishStatus"})],1),a("let-modal",{attrs:{width:"1000px",footShow:!1,title:e.$t("managePackage.title")},model:{value:e.showPackage,callback:function(t){e.showPackage=t},expression:"showPackage"}},[a("let-table",{ref:"packageTable",attrs:{data:e.packageList,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("managePackage.table.th.c1"),prop:"id"}}),a("let-table-column",{attrs:{title:e.$t("managePackage.table.th.c2"),prop:"server"}}),a("let-table-column",{attrs:{title:e.$t("managePackage.table.th.c3"),prop:"posttime"}}),a("let-table-column",{attrs:{title:e.$t("managePackage.table.th.c4"),prop:"comment"}}),a("let-table-column",{attrs:{title:e.$t("managePackage.table.th.c5"),prop:"publish_time"}}),a("let-table-column",{attrs:{title:e.$t("managePackage.table.th.c6")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.deletePackage(t.row.id)}}},[e._v(e._s(e.$t("operate.delete")))])]}}])}),a("let-pagination",{attrs:{slot:"pagination",align:"right",total:e.packageTotalPage,page:e.packagePage},on:{change:e.changePackagePage},slot:"pagination"}),a("div",{staticStyle:{"margin-left":"-15px"},attrs:{slot:"operations"},slot:"operations"},[a("let-button",{attrs:{theme:"primary",size:"small"},on:{click:function(t){e.showPackage=!1}}},[e._v(e._s(e.$t("operate.goback")))])],1)],1)],1),a("let-modal",{attrs:{width:"1200px",footShow:!1,title:e.$t("pub.btn.history")},model:{value:e.showHistory,callback:function(t){e.showHistory=t},expression:"showHistory"}},[a("let-form",{nativeOn:{submit:function(t){return t.preventDefault(),e.getHistoryList(t)}}},[a("let-form-item",{attrs:{itemWidth:"100%",label:e.$t("pub.date")}},[a("let-date-range-picker",{attrs:{start:e.startTime,end:e.endTime},on:{"update:start":function(t){e.startTime=t},"update:end":function(t){e.endTime=t}}}),a("let-button",{staticStyle:{"margin-left":"20px"},attrs:{type:"submit",theme:"primary"}},[e._v(e._s(e.$t("operate.search")))])],1)],1),a("let-table",{ref:"historyTable",attrs:{data:e.totalHistoryList,title:e.$t("historyList.title"),"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("historyList.table.th.c1"),prop:"create_time"}}),a("let-table-column",{attrs:{title:e.$t("serverList.servant.taskID"),prop:"task_no"}}),a("let-table-column",{attrs:{title:e.$t("historyList.table.th.c2")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.serial?e.$t("common.yes"):e.$t("common.no")))])]}}])}),a("let-table-column",{attrs:{title:e.$t("historyList.table.th.c3"),prop:"userName"}}),a("let-table-column",{attrs:{title:e.$t("serverList.dlg.title.taskStatus")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e.statusMap[t.row.status]||"-"))])]}}])}),a("let-table-column",{attrs:{title:e.$t("historyList.table.th.c4")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.viewTask(t.row.task_no)}}},[e._v(e._s(e.$t("operate.view")))]),a("let-table-operation",{on:{click:function(a){return e.deleteTask(t.row.task_no)}}},[e._v(e._s(e.$t("operate.delete")))])]}}])}),a("let-pagination",{attrs:{slot:"pagination",align:"right",total:e.historyTotalPage,page:e.historyPage},on:{change:e.changeHistoryPage},slot:"pagination"}),a("div",{staticStyle:{"margin-left":"-15px"},attrs:{slot:"operations"},slot:"operations"},[a("let-button",{attrs:{theme:"primary",size:"small"},on:{click:function(t){e.showHistory=!1}}},[e._v(e._s(e.$t("operate.goback")))])],1)],1)],1),a("let-modal",{attrs:{title:e.$t("historyList.table.th.c4"),width:"1200px",footShow:!1},on:{"on-cancel":function(t){e.taskModal.show=!1}},model:{value:e.taskModal.show,callback:function(t){e.$set(e.taskModal,"show",t)},expression:"taskModal.show"}},[e.taskModal.model?a("let-table",{attrs:{data:e.taskModal.model.items}},[a("let-table-column",{attrs:{title:e.$t("historyList.dlg.th.c1"),prop:"item_no"}}),a("let-table-column",{attrs:{title:e.$t("historyList.dlg.th.c2"),prop:"application"}}),a("let-table-column",{attrs:{title:e.$t("historyList.dlg.th.c3"),prop:"server_name"}}),a("let-table-column",{attrs:{title:e.$t("historyList.dlg.th.c4"),prop:"node_name"}}),a("let-table-column",{attrs:{title:e.$t("historyList.dlg.th.c5"),prop:"command"}}),a("let-table-column",{attrs:{title:e.$t("monitor.search.start"),prop:"start_time"}}),a("let-table-column",{attrs:{title:e.$t("monitor.search.end"),prop:"end_time"}}),a("let-table-column",{attrs:{title:e.$t("common.status"),prop:"status_info"}}),a("let-table-column",{attrs:{title:e.$t("historyList.dlg.th.c7"),prop:"execute_info"}})],1):e._e()],1),a("let-modal",{attrs:{title:e.$t("pub.dlg.conf"),width:"800px",footShow:!0},on:{"on-confirm":e.saveCompilerUrl,"on-cancel":function(t){e.publishUrlConfModal.show=!1}},model:{value:e.publishUrlConfModal.show,callback:function(t){e.$set(e.publishUrlConfModal,"show",t)},expression:"publishUrlConfModal.show"}},[e.publishUrlConfModal.model?a("let-form",{ref:"compilerForm",attrs:{itemWidth:"100%",required:""}},[a("let-form-item",{attrs:{label:e.$t("pub.dlg.tag")}},[a("let-input",{attrs:{size:"small",placeholder:e.$t("pub.tips.tag"),"required-tip":e.$t("deployService.table.tips.empty"),required:""},model:{value:e.publishUrlConfModal.model.tag,callback:function(t){e.$set(e.publishUrlConfModal.model,"tag",t)},expression:"publishUrlConfModal.model.tag"}})],1)],1):e._e()],1),a("let-modal",{attrs:{title:e.$t("pub.dlg.compileProgress"),width:"880px",footShow:!1},model:{value:e.compilerModal.show,callback:function(t){e.$set(e.compilerModal,"show",t)},expression:"compilerModal.show"}},[e.compilerModal.model?a("let-table",{attrs:{data:e.compilerModal.model.progress}},[a("let-table-column",{attrs:{title:e.$t("historyList.dlg.th.c2"),prop:"application"}}),a("let-table-column",{attrs:{title:e.$t("historyList.dlg.th.c3"),prop:"server_name"}}),a("let-table-column",{attrs:{title:e.$t("historyList.dlg.th.c4"),prop:"node"}}),a("let-table-column",{attrs:{title:e.$t("historyList.dlg.th.c8"),prop:"status"},scopedSlots:e._u([{key:"default",fn:function(t){return["1"==t.row.state?a("span",{staticClass:"running"},[e._v(e._s(t.row.status))]):"2"==t.row.state?a("span",{staticClass:"success"},[e._v(e._s(t.row.status))]):a("span",{staticClass:"stop"},[e._v(e._s(t.row.status))])]}}],null,!1,3193835083)}),a("let-table-column",{attrs:{title:e.$t("monitor.search.start"),prop:"start_time"}}),a("let-table-column",{attrs:{title:e.$t("monitor.search.end"),prop:"end_time"}})],1):e._e()],1)],1)},O=[],z=(a("99af"),a("4de4"),a("a15b"),a("d81d"),a("fb6a"),a("b64b"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("let-modal",{attrs:{title:e.$t("serverList.table.th.result"),width:"880px",footShow:!1},on:{"on-cancel":e.onClose,close:e.onClose},model:{value:e.finishModal.show,callback:function(t){e.$set(e.finishModal,"show",t)},expression:"finishModal.show"}},[e.finishModal.model?a("let-table",{attrs:{title:e.$t("serverList.servant.taskID")+e.finishModal.model.task_no,data:e.finishModal.model.items}},[a("let-table-column",{attrs:{title:e.$t("serverList.table.th.ip"),prop:"node_name"}}),a("let-table-column",{attrs:{title:e.$t("common.status")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-tag",{attrs:{theme:2==t.row.status?"success":3==t.row.status?"danger":"",checked:""}},[e._v(" "+e._s(e.statusConfig[t.row.status]+(2!=t.row.status&&3!=t.row.status?"...":""))+" ")])]}}],null,!1,244065872)})],1):e._e()],1)],1)}),D=[],E=(a("caad"),a("d3b7"),a("25f0"),{name:"PublishStatus",data:function(){return{closeCallback:null,finishModal:{show:!1,model:{task_no:"",items:[]}},statusConfig:{0:this.$t("serverList.restart.notStart"),1:this.$t("serverList.restart.running"),2:this.$t("serverList.restart.success"),3:this.$t("serverList.restart.failed"),4:this.$t("serverList.restart.cancel"),5:this.$t("serverList.restart.parial")},statusMap:{0:"EM_T_NOT_START",1:"EM_T_RUNNING",2:"EM_T_SUCCESS",3:"EM_T_FAILED",4:"EM_T_CANCEL",5:"EM_T_PARIAL"}}},methods:{onClose:function(){this.closeCallback&&this.closeCallback()},savePublishServer:function(e,t){var a=this;this.closeCallback=t;var o=[];e.model.serverList.forEach((function(t){o.push({server_id:t.id.toString(),command:"patch_tars",parameters:{patch_id:e.model.patch_id.toString(),bak_flag:t.bak_flag||!1,update_text:e.model.update_text||""}})}));var s=this.$Loading.show();this.$ajax.postJSON("/server/api/add_task",{serial:!0,items:o}).then((function(e){s.hide(),a.finishModal.model.task_no=e,a.finishModal.show=!0,a.getTaskRepeat(e)})).catch((function(e){s.hide(),a.$tip.error("".concat(a.$t("common.error"),": ").concat(e.message||e.err_msg))}))},getTaskRepeat:function(e){var t,a=this;t&&clearTimeout(t);var o=function o(){a.$ajax.getJSON("/server/api/task",{task_no:e}).then((function(e){var s=!0;e.items.forEach((function(e){[2,3].includes(e.status)||(s=!1)})),s?clearTimeout(t):t=setTimeout(o,2e3),a.finishModal.model.items=e.items})).catch((function(e){clearTimeout(t),a.$tip.error("".concat(a.$t("common.error"),": ").concat(e.message||e.err_msg))}))};o()}}}),I=E,A=Object(b["a"])(I,z,D,!1,null,null,null),J=A.exports,F={name:"ServerPublish",components:{PublishStatus:J},data:function(){return{activeKey:"",treeData:[],totalServerList:[],serverList:[],isCheckedAll:!1,totalPage:0,pageSize:20,page:1,showPackage:!1,packageList:[],packageTotalPage:0,packagePage:1,packagePageSize:20,publishModal:{show:!1,model:null},statusConfig:{0:this.$t("serverList.restart.notStart"),1:this.$t("serverList.restart.running"),2:this.$t("serverList.restart.success"),3:this.$t("serverList.restart.failed"),4:this.$t("serverList.restart.cancel"),5:this.$t("serverList.restart.parial")},statusMap:{0:"EM_T_NOT_START",1:"EM_T_RUNNING",2:"EM_T_SUCCESS",3:"EM_T_FAILED",4:"EM_T_CANCEL",5:"EM_T_PARIAL"},showHistory:!1,startTime:"",endTime:"",totalHistoryList:[],historyList:[],historyTotalPage:0,historyPage:1,historyPageSize:20,taskModal:{show:!1,modal:!0},uploadModal:{show:!1,model:null},patchType:"patch",patchRadioData:[{value:"patch",text:this.$t("pub.dlg.upload")}],tagList:[],tagVersion:"",publishUrlConfModal:{show:!1,model:{tag:"",compiler:"",task:""}},compilerModal:{show:!1,model:null},pkgUpload:{show:!1,model:null}}},methods:{getCompileConf:function(){var e=this;this.$ajax.getJSON("/server/api/get_compile_conf").then((function(t){t.enable&&e.patchRadioData.push({value:"compile",text:e.$t("pub.dlg.compileAndPublish")})})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))},getServerList:function(){var e=this,t=this.$Loading.show();this.$ajax.getJSON("/server/api/server_list",{tree_node_id:this.$route.params.treeid}).then((function(a){t.hide();var o=a||[];o.forEach((function(e){e.isChecked=!1})),e.totalServerList=o,e.totalPage=Math.ceil(e.totalServerList.length/e.pageSize),e.page=1,e.updateServerList()})).catch((function(a){t.hide(),e.$confirm(a.err_msg||a.message||e.$t("serverList.table.msg.fail")).then((function(){e.getServerList()}))}))},changePage:function(e){this.page=e},openPublishModal:function(){var e=this,t=this.serverList.filter((function(e){return e.isChecked}));if(t.length<=0)this.$tip.warning(this.$t("pub.dlg.a"));else{var a=t[0];this.publishModal.model={application:a.application,server_name:a.server_name,serverList:t,patchList:[],patch_id:"",update_text:"",show:!0},this.getPatchList(a.application,a.server_name,1,50).then((function(t){e.publishModal.model.patchList=t.rows,window.setTimeout((function(){return e.publishModal.show=!0}),300)}))}},getPatchList:function(e,t,a,o){return this.$ajax.getJSON("/server/api/server_patch_list",{application:e,module_name:t,curr_page:a,page_size:o})},closePublishModal:function(){this.publishModal.show=!1,this.publishModal.modal=null,this.patchType="patch",this.$refs.publishForm.resetValid()},savePublishServer:function(){this.$refs.publishForm.validate()&&this.$refs.publishStatus.savePublishServer(this.publishModal,this.closePublishModal)},closeFinishModal:function(){this.$refs.finishForm.resetValid()},updateServerList:function(){var e=(this.page-1)*this.pageSize,t=this.page*this.pageSize;this.serverList=this.totalServerList.slice(e,t)},gotoPackage:function(){this.showPackage=!0,this.getPackageList(1)},getPackageList:function(e){var t=this;"number"!=typeof e&&(e=1);var a=this.serverList.filter((function(e){return e.isChecked}));if(a.length<=0)this.$tip.warning(this.$t("pub.dlg.a"));else{var o=this.$Loading.show(),s=a[0];this.getPatchList(s.application,s.server_name,e,this.packagePageSize).then((function(e){o.hide(),t.packageList=e.rows,t.packageTotalPage=Math.ceil(e.count/t.packagePageSize)})).catch((function(e){o.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))})),this.getPatchList(s.application,s.server_name,1,50).then((function(e){t.publishModal.model.patchList=e.rows}))}},changePackagePage:function(e){this.getPackageList(e)},deletePackage:function(e){var t=this;this.$confirm(this.$t("releasePackage.confirmDeleteTip"),this.$t("common.alert")).then((function(){t.$ajax.postJSON("/server/api/delete_patch_package",{id:e}).then((function(e){t.getPackageList(t.packagePage)})).catch((function(e){t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))}))},gotoHistory:function(){this.showHistory=!0,this.getHistoryList(1)},getHistoryList:function(e){var t=this;"number"!=typeof e&&(e=1);var a=this.$Loading.show(),o={application:this.serverList[0].application||"",server_name:this.serverList[0].server_name||"",from:this.startTime,to:this.endTime,page_size:this.historyPageSize,curr_page:e};this.historyPage=e,this.$ajax.getJSON("/server/api/task_list",o).then((function(e){a.hide(),t.totalHistoryList=e.rows||[],t.historyTotalPage=Math.ceil(e.count/t.historyPageSize)})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))},viewTask:function(e){var t=this;this.$ajax.getJSON("/server/api/task",{task_no:e}).then((function(e){t.taskModal.model=e,t.taskModal.show=!0}))},deleteTask:function(e){var t=this;this.$confirm(this.$t("historyList.delete")).then((function(){t.$ajax.getJSON("/server/api/del_task",{task_no:e}).then((function(e){t.getHistoryList(t.page)})).catch((function(e){t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))}))},changeHistoryPage:function(e){this.getHistoryList(e)},showUploadModal:function(){this.serverList.length<=0&&this.$tip.warning(this.$t("pub.dlg.a")),this.uploadModal.model={application:this.serverList[0].application||"",server_name:this.serverList[0].server_name||"",file:null,comment:""},this.uploadModal.show=!0},closeUploadModal:function(){this.uploadModal.show=!1,this.uploadModal.model=null,this.$refs.uploadForm.resetValid()},uploadFile:function(e){this.uploadModal.model.file=e},uploadPatchPackage:function(){var e=this;if(this.$refs.uploadForm.validate()){var t=this.$Loading.show(),a=new FormData;a.append("application",this.uploadModal.model.application),a.append("module_name",this.uploadModal.model.server_name),a.append("suse",this.uploadModal.model.file),a.append("comment",this.uploadModal.model.comment),a.append("task_id",(new Date).getTime()),this.$ajax.postForm("/server/api/upload_patch_package",a).then((function(){e.getPatchList(e.uploadModal.model.application,e.uploadModal.model.server_name,1,50).then((function(a){t.hide(),e.publishModal.model.patchList=a.rows,e.closeUploadModal()}))})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.message||a.err_msg))}))}},handleNoPublishedTime:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.$t("pub.dlg.unpublished");return"0000:00:00 00:00:00"===e?t:e},patchChange:function(){"patch"==this.patchType?this.publishModal.model.show=!0:(this.publishModal.model.show=!1,this.getCodeVersion())},getCodeVersion:function(){var e=this;this.$ajax.get("/server/api/get_tag_list",{application:this.publishModal.model.application,server_name:this.publishModal.model.server_name}).then((function(t){""==t.data?e.openPubConfModal():e.tagList=t.data})).catch((function(t){e.tagList=[],e.$tip.error("".concat(e.$t("common.error"),": ").concat(err.err_msg||err.message))}))},openPubConfModal:function(){var e=this;this.publishUrlConfModal.show=!0,this.$ajax.getJSON("/server/api/get_tag_conf",{application:this.publishModal.model.application,server_name:this.publishModal.model.server_name}).then((function(t){e.publishUrlConfModal.model.tag=t.path})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.err_msg||t.message))}))},saveCompilerUrl:function(){var e=this;if(this.$refs.compilerForm.validate()){var t=this.$Loading.show();this.$ajax.getJSON("/server/api/set_tag_conf",{path:this.publishUrlConfModal.model.tag,application:this.publishModal.model.application,server_name:this.publishModal.model.server_name}).then((function(a){t.hide(),e.$tip.success(e.$t("common.success")),e.publishUrlConfModal.show=!1,e.getCodeVersion()})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.err_msg||a.message))}))}},addCompileTask:function(){var e=this;this.$ajax.getJSON("/server/api/get_compile_conf").then((function(t){var a=t.getVersionList;if(a){var o=e.publishModal.model.serverList.map((function(e){return e.node_name})),s={application:e.publishModal.model.application,server_name:e.publishModal.model.server_name,node:o.join(";"),path:e.tagVersion.split("--")[0],version:e.tagVersion.split("--")[1],comment:e.publishModal.model.update_text||"",compileUrl:a},r=e.$Loading.show();e.$ajax.postJSON("/server/api/do_compile",s).then((function(t){r.hide(),e.compilerModal.show=!0;var a="string"===typeof t?t:t.data;e.getStatus(a)})).catch((function(t){r.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.err_msg||t.message))}))}else e.openPubConfModal()})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.err_msg||t.message))}))},taskStatus:function(e){this.getStatus(e)},getStatus:function(e){var t=this,a=function a(){var o=null;o&&clearTimeout(o),t.$ajax.getJSON("/server/api/compiler_task",{taskNo:e}).then((function(s){var r="array"===typeof s?s:s.data;if(r[0].status=t.statusConfig[r[0].state],1==r[0].state&&(o=setTimeout(a,2e3)),t.compilerModal.model?Object.assign(t.compilerModal.model,{progress:r}):t.compilerModal.model={progress:r},2==r[0].state){var n=t.$Loading({text:"回传发布包"});n.show(),t.compilerModal.show=!1;var l=function a(){t.$ajax.getJSON("/server/api/get_server_patch",{task_id:e}).then((function(e){0!==Object.keys(e).length?(n.hide(),t.publishModal.model.patch_id=e.id,t.publishModal.show=!1,t.savePublishServer()):setTimeout(a,2e3)})).catch((function(e){n.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))}))};setTimeout(l,2e3)}})).catch((function(e){t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))}))};a()}},mounted:function(){this.getServerList(),this.getCompileConf()},watch:{isCheckedAll:function(){var e=this.isCheckedAll;this.serverList.forEach((function(t){t.isChecked=e}))},page:function(){this.updateServerList()}}},R=F,V=(a("523f"),Object(b["a"])(R,q,O,!1,null,null,null)),U=V.exports,H=a("918a"),W=a("8d5c"),Y=a("107e"),G=a("a618"),Z=a("575d"),B=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page_operation"},[a("let-tabs",{attrs:{activekey:e.$route.path},on:{click:e.onTabClick}},[a("let-tab-pane",{attrs:{tab:e.$t("deployService.title.deploy"),tabkey:"/operation/deploy"}}),a("let-tab-pane",{attrs:{tab:e.$t("deployService.title.expand"),tabkey:"/operation/expand"}}),a("let-tab-pane",{attrs:{tab:e.$t("deployService.title.template"),tabkey:"/operation/templates"}}),a("let-tab-pane",{attrs:{tab:e.$t("deployService.title.nodes"),tabkey:"/operation/nodes"}}),a("let-tab-pane",{attrs:{tab:e.$t("deployService.title.check"),tabkey:"/operation/check"}})],1),a("router-view",{staticClass:"page_operation_children"})],1)},K=[],Q="/operation/deploy",X={name:"Oparetion",beforeRouteEnter:function(e,t,a){"/operation"===e.path?a(Q):a()},beforeRouteLeave:function(e,t,a){Q=t.path,a()},methods:{onTabClick:function(e){this.$router.replace(e)}}},ee=X,te=(a("ea8c"),Object(b["a"])(ee,B,K,!1,null,null,null)),ae=te.exports,oe=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page_operation_deploy"},[a("let-form",{directives:[{name:"show",rawName:"v-show",value:e.deployShow,expression:"deployShow"}],ref:"form",attrs:{inline:"","label-position":"top",itemWidth:"480px"},nativeOn:{submit:function(t){return t.preventDefault(),e.save(t)}}},[a("let-form-item",{attrs:{label:e.$t("deployService.form.app"),required:""}},[a("let-select",{attrs:{id:"inputApplication",size:"small",filterable:"",notFoundText:e.$t("deployService.form.appAdd")},on:{change:e.changeApplication},model:{value:e.model.application,callback:function(t){e.$set(e.model,"application",t)},expression:"model.application"}},e._l(e.model.applicationList,(function(t){return a("let-option",{key:t,attrs:{value:t}},[e._v(" "+e._s(t)+" ")])})),1)],1),a("let-form-item",{attrs:{label:e.$t("deployService.form.serviceName"),required:""}},[a("let-input",{attrs:{size:"small",placeholder:e.$t("deployService.form.serviceFormatTips"),required:"","required-tip":e.$t("deployService.form.serviceTips"),pattern:"^[a-zA-Z]([a-zA-Z0-9]+)?$","pattern-tip":e.$t("deployService.form.serviceFormatTips")},model:{value:e.model.server_name,callback:function(t){e.$set(e.model,"server_name",t)},expression:"model.server_name"}})],1),a("let-form-item",{attrs:{label:e.$t("deployService.form.serviceType"),required:""}},[a("let-select",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.form.serviceTypeTips")},model:{value:e.model.server_type,callback:function(t){e.$set(e.model,"server_type",t)},expression:"model.server_type"}},e._l(e.types,(function(t){return a("let-option",{key:t,attrs:{value:t}},[e._v(e._s(t))])})),1)],1),a("let-form-item",{attrs:{label:e.$t("deployService.form.template"),required:""}},[a("let-select",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.form.templateTips")},model:{value:e.model.template_name,callback:function(t){e.$set(e.model,"template_name",t)},expression:"model.template_name"}},e._l(e.templates,(function(t){return a("let-option",{key:t,attrs:{value:t}},[e._v(e._s(t))])})),1)],1),a("let-form-item",{attrs:{label:e.$t("serverList.table.th.ip"),required:""}},[a("let-select",{attrs:{size:"small",filterable:""},model:{value:e.model.node_name,callback:function(t){e.$set(e.model,"node_name",t)},expression:"model.node_name"}},e._l(e.model.nodeList,(function(t){return a("let-option",{key:t,attrs:{value:t}},[e._v(" "+e._s(t)+" ")])})),1)],1),a("let-form-item",{attrs:{label:"SET"}},[a("SetInputer",{attrs:{enabled:e.model.enable_set,name:e.model.set_name,area:e.model.set_area,group:e.model.set_group},on:{"update:enabled":function(t){return e.$set(e.model,"enable_set",t)},"update:name":function(t){return e.$set(e.model,"set_name",t)},"update:area":function(t){return e.$set(e.model,"set_area",t)},"update:group":function(t){return e.$set(e.model,"set_group",t)}}})],1),a("let-form-item",{directives:[{name:"show",rawName:"v-show",value:e.enableAuth,expression:"enableAuth"}],attrs:{label:e.$t("user.op")}},[a("let-input",{attrs:{size:"small",placeholder:e.$t("user.tips.sep")},model:{value:e.model.operator,callback:function(t){e.$set(e.model,"operator",t)},expression:"model.operator"}})],1),a("let-form-item",{directives:[{name:"show",rawName:"v-show",value:e.enableAuth,expression:"enableAuth"}],attrs:{label:e.$t("user.dev")}},[a("let-input",{attrs:{size:"small",placeholder:e.$t("user.tips.sep")},model:{value:e.model.developer,callback:function(t){e.$set(e.model,"developer",t)},expression:"model.developer"}})],1),a("let-table",{attrs:{data:e.model.adapters}},[a("let-table-column",{attrs:{title:"OBJ"},scopedSlots:e._u([{key:"head",fn:function(t){return[a("span",{staticClass:"required"},[e._v(e._s(t.column.title))])]}},{key:"default",fn:function(t){return[a("let-input",{attrs:{size:"small",placeholder:e.$t("deployService.form.placeholder"),required:"","required-tip":e.$t("deployService.form.objTips"),pattern:"^[a-zA-Z0-9]+$","pattern-tip":e.$t("deployService.form.placeholder")},model:{value:t.row.obj_name,callback:function(a){e.$set(t.row,"obj_name",a)},expression:"props.row.obj_name"}})]}}])}),a("let-table-column",{attrs:{title:e.$t("deployService.table.th.endpoint"),width:"200px"},scopedSlots:e._u([{key:"head",fn:function(t){return[a("span",{staticClass:"required"},[e._v(e._s(t.column.title))])]}},{key:"default",fn:function(t){return[a("let-input",{attrs:{size:"small",placeholder:"IP",required:"","required-tip":e.$t("deployService.table.tips.ip")},model:{value:t.row.bind_ip,callback:function(a){e.$set(t.row,"bind_ip",a)},expression:"props.row.bind_ip"}})]}}])}),a("let-table-column",{attrs:{title:e.$t("deployService.table.th.port"),width:"100px"},scopedSlots:e._u([{key:"head",fn:function(t){return[a("span",{staticClass:"required"},[e._v(e._s(t.column.title))])]}},{key:"default",fn:function(t){return[a("let-input",{attrs:{size:"small",type:"number",min:0,max:65535,placeholder:"0-65535",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:t.row.port,callback:function(a){e.$set(t.row,"port",a)},expression:"props.row.port"}})]}}])}),a("let-table-column",{attrs:{title:e.$t("deployService.form.portType"),width:"150px"},scopedSlots:e._u([{key:"head",fn:function(t){return[a("span",{staticClass:"required"},[e._v(e._s(t.column.title))])]}},{key:"default",fn:function(t){return[a("let-radio",{attrs:{label:"tcp"},model:{value:t.row.port_type,callback:function(a){e.$set(t.row,"port_type",a)},expression:"props.row.port_type"}},[e._v("TCP")]),a("let-radio",{attrs:{label:"udp"},model:{value:t.row.port_type,callback:function(a){e.$set(t.row,"port_type",a)},expression:"props.row.port_type"}},[e._v("UDP")])]}}])}),a("let-table-column",{attrs:{title:e.$t("deployService.table.th.protocol"),width:"180px"},scopedSlots:e._u([{key:"head",fn:function(t){return[a("span",{staticClass:"required"},[e._v(e._s(t.column.title))])]}},{key:"default",fn:function(t){return[a("let-radio",{attrs:{label:"tars"},model:{value:t.row.protocol,callback:function(a){e.$set(t.row,"protocol",a)},expression:"props.row.protocol"}},[e._v("TARS")]),a("let-radio",{attrs:{label:"not_tars"},model:{value:t.row.protocol,callback:function(a){e.$set(t.row,"protocol",a)},expression:"props.row.protocol"}},[e._v(e._s(e.$t("serverList.servant.notTARS")))])]}}])}),a("let-table-column",{attrs:{title:e.$t("deployService.table.th.threads"),width:"80px"},scopedSlots:e._u([{key:"head",fn:function(t){return[a("span",{staticClass:"required"},[e._v(e._s(t.column.title))])]}},{key:"default",fn:function(t){return[a("let-input",{attrs:{size:"small",type:"number",min:0,required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:t.row.thread_num,callback:function(a){e.$set(t.row,"thread_num",a)},expression:"props.row.thread_num"}})]}}])}),a("let-table-column",{attrs:{title:e.$t("serverList.table.servant.maxConnecttions"),width:"100px"},scopedSlots:e._u([{key:"head",fn:function(t){return[a("span",{staticClass:"required"},[e._v(e._s(t.column.title))])]}},{key:"default",fn:function(t){return[a("let-input",{attrs:{size:"small",type:"number",min:0,required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:t.row.max_connections,callback:function(a){e.$set(t.row,"max_connections",a)},expression:"props.row.max_connections"}})]}}])}),a("let-table-column",{attrs:{title:e.$t("serverList.table.servant.maxQueue"),width:"100px"},scopedSlots:e._u([{key:"head",fn:function(t){return[a("span",{staticClass:"required"},[e._v(e._s(t.column.title))])]}},{key:"default",fn:function(t){return[a("let-input",{attrs:{size:"small",type:"number",min:0,required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:t.row.queuecap,callback:function(a){e.$set(t.row,"queuecap",a)},expression:"props.row.queuecap"}})]}}])}),a("let-table-column",{attrs:{title:e.$t("serverList.table.servant.timeout"),width:"100px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-input",{attrs:{size:"small",type:"number",min:0},model:{value:t.row.queuetimeout,callback:function(a){e.$set(t.row,"queuetimeout",a)},expression:"props.row.queuetimeout"}})]}}])}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"100px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.addAdapter(t.row)}}},[e._v(e._s(e.$t("operate.add")))]),t.$index?a("let-table-operation",{staticClass:"danger",on:{click:function(a){return e.model.adapters.splice(t.$index,1)}}},[e._v(e._s(e.$t("operate.delete")))]):e._e()]}}])})],1),a("let-button",{attrs:{type:"button",theme:"sub-primary"},on:{click:function(t){return e.getAutoPort()}}},[e._v(e._s(e.$t("deployService.form.getPort")))]),e._v(" "),a("let-button",{attrs:{type:"submit",theme:"primary"}},[e._v(e._s(e.$t("common.submit")))])],1),a("let-modal",{staticClass:"more-cmd",staticStyle:{"text-align":"center"},attrs:{width:"700px",footShow:!1},on:{close:e.closeResultModal,"on-cancel":e.closeResultModal},model:{value:e.resultModal.show,callback:function(t){e.$set(e.resultModal,"show",t)},expression:"resultModal.show"}},[a("p",{staticClass:"result-text"},[e._v(e._s(e.$t("deployService.form.ret.success"))+e._s(e.$t("resource.installRstMsg")))]),a("let-table",{attrs:{data:e.resultModal.resultList,"empty-msg":e.$t("common.nodata"),"row-class-name":e.resultModal.rowClassName}},[a("let-table-column",{attrs:{title:"ip",prop:"ip"}}),a("let-table-column",{attrs:{title:e.$t("resource.installResult"),prop:"rst"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("p",{domProps:{textContent:e._s(t.row.rst?e.$t("common.success"):e.$t("common.error"))}})]}}])}),a("let-table-column",{attrs:{title:e.$t("common.message"),prop:"msg"}})],1)],1),a("div",{directives:[{name:"show",rawName:"v-show",value:e.deployModal.show,expression:"deployModal.show"}],staticStyle:{width:"400px",margin:"0 auto"}},[a("let-form",{ref:"deployForm",attrs:{itemWidth:"400px"}},[a("let-form-item",{attrs:{label:e.$t("nodes.node_name"),required:""}},[a("let-input",{attrs:{placeholder:e.$t("nodes.nodeNameTips"),required:"","required-tip":e.$t("nodes.nodeNameTips")},model:{value:e.deployModal.node_name,callback:function(t){e.$set(e.deployModal,"node_name",t)},expression:"deployModal.node_name"}})],1),a("let-form-item",{attrs:{label:e.$t("pub.dlg.releaseVersion")}},[a("let-select",{attrs:{required:"","required-tip":e.$t("pub.dlg.ab")},model:{value:e.deployModal.model.patch_id,callback:function(t){e.$set(e.deployModal.model,"patch_id",t)},expression:"deployModal.model.patch_id"}},e._l(e.deployModal.model.patchList,(function(t){return a("let-option",{key:t.id,attrs:{value:t.id}},[e._v(" "+e._s(t.id)+" | "+e._s(t.posttime)+" | "+e._s(t.comment)+" ")])})),1)],1)],1),a("div",{staticStyle:{width:"100%","text-align":"center"}},[a("let-tag",[e._v(e._s(e.$t("deployLog.info")))]),a("let-button",{staticStyle:{margin:"20px auto"},attrs:{type:"submit",theme:"primary"},on:{click:e.doDeployLog}},[e._v(e._s(e.$t("deployLog.install")))])],1)],1),a("PublishStatus",{ref:"publishStatus"})],1)},se=[],re=(a("498a"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"set_inputer"},[a("div",{staticClass:"set_inputer_item"},[a("let-input",{ref:"name",attrs:{size:"small",value:e.name,placeholder:e.$t("common.set.setName"),disabled:!e.enabled,required:e.enabled,"required-tip":e.$t("deployService.form.setNameFormatTips"),pattern:e.enabled?"^[a-z]+$":null,"pattern-tip":e.$t("deployService.form.setNameFormatTips")},on:{input:e.updaters.name}})],1),a("div",{staticClass:"set_inputer_item"},[a("let-input",{ref:"area",attrs:{size:"small",value:e.area,placeholder:e.$t("common.set.setArea"),disabled:!e.enabled,required:e.enabled,"required-tip":e.$t("deployService.form.setAreaTips"),pattern:e.enabled?"^[a-z]+$":null,"pattern-tip":e.$t("deployService.form.setAreaFormatTips")},on:{input:e.updaters.area}})],1),a("div",{staticClass:"set_inputer_item"},[a("let-input",{ref:"group",attrs:{size:"small",value:e.group,placeholder:e.$t("common.set.setGroup"),disabled:!e.enabled,required:e.enabled,"required-tip":e.$t("deployService.form.setGroupTips"),pattern:e.enabled?"^(\\d+|\\*)$":null,"pattern-tip":e.$t("deployService.form.setGroupFormatTips")},on:{input:e.updaters.group}})],1),a("let-checkbox",{staticClass:"set_inputer_switch",attrs:{value:e.enabled},on:{input:e.updaters.enabled,change:e.onEnabledChange}},[e._v(e._s(e.$t("serverList.table.th.enableSet"))+" ")])],1)}),ne=[],le=(a("a9e3"),{props:{enabled:Boolean,name:String,area:String,group:[Number,String]},created:function(){this.updaters={name:this.updater("name"),area:this.updater("area"),group:this.updater("group"),enabled:this.updater("enabled")}},methods:{updater:function(e){var t=this;return function(a){return t.$emit("update:".concat(e),a)}},onEnabledChange:function(){var e=this;this.$nextTick((function(){e.enabled||(e.updaters.name(""),e.$refs.name.resetValid(),e.updaters.area(""),e.$refs.area.resetValid(),e.updaters.group(""),e.$refs.group.resetValid())}))}}}),ie=le,ce=(a("c1df0"),Object(b["a"])(ie,re,ne,!1,null,null,null)),de=ce.exports,pe=["tars_cpp","tars_java","tars_php","tars_nodejs","not_tars","tars_go"],ue=["tars.tarsregistry","tars.tarsAdminRegistry","tars.tarspatch","tars.tarsnode","tars.tarsconfig","tars.tarsnotify","tars.tarsstat","tars.tarsquerystat","tars.tarsproperty","tars.tarsqueryproperty","tars.framework-db","tars.tarslog"],me=function(){return{applicationList:[],nodeList:[],application:"",server_name:"",server_type:pe[0],template_name:"",node_name:"",enable_set:!1,set_name:"",set_area:"",set_group:"",operator:"",developer:"",adapters:[{obj_name:"",bind_ip:"",port:"",port_type:"tcp",protocol:"tars",thread_num:5,max_connections:1e5,queuecap:5e4,queuetimeout:2e4}]}},he={name:"OperationDeploy",components:{SetInputer:de,PublishStatus:J},data:function(){return{types:pe,tars_templates:ue,all_templates:[],notars_templates:[],templates:[],model:me(),enableAuth:!1,deployShow:!1,deployModal:{show:!1,node_name:"",model:{patch_id:"",patchList:[],serverList:[]}},resultModal:{show:!1,resultList:[],rowClassName:function(e){return e&&e.row&&!e.row.rst?"err-row":""}}}},mounted:function(){var e=this;this.$ajax.getJSON("/server/api/is_enable_auth").then((function(t){e.enableAuth=t.enableAuth||!1})).catch((function(e){})),this.$ajax.getJSON("/server/api/application_list").then((function(t){e.model.applicationList=t})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))})),this.$ajax.getJSON("/server/api/node_list").then((function(t){console.log(t),e.model.nodeList=t})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))})),this.$ajax.getJSON("/server/api/template_name_list").then((function(t){e.templates=t,e.all_templates=t,e.notars_templates=[],e.all_templates.forEach((function(t){var a;for(a=0;a<e.tars_templates.length;a++)if(e.tars_templates[a]==t)return;e.notars_templates.push(t)})),e.model.template_name=t[0];var a=document.querySelector("#inputApplication .let-select__filter__input"),o=e;a.onblur=function(){o.changeApplication(this.value)}})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))})),this.$watch("model.node_name",(function(t,a){t!==a&&e.model.adapters.forEach((function(e){e.bind_ip=t}))})),this.checkDeployLog()},methods:{changeApplication:function(e){this.templates="tars"==e?this.tars_templates:this.notars_templates},addAdapter:function(e){this.model.adapters.push(Object.assign({},e))},deploy:function(){var e=this;this.$confirm(this.$t("deployService.form.deployServiceTip"),this.$t("common.alert")).then((function(){var t=e.$Loading.show();e.$ajax.postJSON("/server/api/deploy_server",e.model).then((function(a){t.hide(),a.tars_node_rst&&a.tars_node_rst.length?e.showResultModal(a.tars_node_rst):e.$tip.success(e.$t("deployService.form.ret.success")),e.model=me(),e.model.template_name=e.templates[0]})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.message||a.err_msg))}))}))},getAutoPort:function(){var e=this,t=this.$Loading.show(),a=this.model.adapters,o=[];a.forEach((function(e){o.push(e.bind_ip)})),this.$ajax.getJSON("/server/api/auto_port",{node_name:o.join(";")}).then((function(o){t.hide(),o.forEach((function(t,o){e.$set(a[o],"port",String(t.port||""))}))})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.message||a.err_msg))}))},save:function(){var e=this,t=document.querySelector("#inputApplication .let-select__filter__input").value.trim();if(""==this.model.application&&(this.model.application=t),this.$refs.form.validate()){var a=this.model,o=this.$Loading.show();this.$ajax.getJSON("/server/api/server_exist",{application:a.application,server_name:a.server_name,node_name:a.server_name}).then((function(t){o.hide(),t?e.$tip.error(e.$t("deployService.form.nameTips")):e.deploy()})).catch((function(t){o.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))}},showResultModal:function(e){this.resultModal.resultList=e,this.resultModal.show=!0},closeResultModal:function(){this.resultModal.show=!1,this.resultModal.resultList=[]},checkDeployLog:function(){var e=this;this.$ajax.getJSON("/server/api/need_deploy_log").then((function(t){e.deployModal.show=t.need,e.deployShow=!t.need,t.need&&e.showDeployLog()})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))},getPatchList:function(e,t,a,o){return this.$ajax.getJSON("/server/api/server_patch_list",{application:e,module_name:t,curr_page:a,page_size:o})},showDeployLog:function(){var e=this,t="tars",a="tarslog";this.deployModal.model={application:t,server_name:a,patch_id:"",patchList:[]},this.getPatchList(t,a,1,10).then((function(t){e.deployModal.model.patchList=t.rows}))},doDeployLog:function(){var e=this;this.$refs.deployForm.validate()&&this.$ajax.getJSON("/server/api/expand_deploy_log",{node_name:this.deployModal.node_name}).then((function(t){e.deployModal.model.serverList=t.server,e.$refs.publishStatus.savePublishServer(e.deployModal,e.onCancel)})).catch((function(t){e.$tip.error("".concat(e.$t("deployLog.failed"),": ").concat(t.err_msg||t.message))}))},onCancel:function(){this.checkDeployLog()}}},fe=he,ve=(a("1eed"),Object(b["a"])(fe,oe,se,!1,null,null,null)),be=ve.exports,_e=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page_operation_expand"},[a("let-form",{ref:"configForm",attrs:{inline:"","label-position":"top",itemWidth:"480px"},nativeOn:{submit:function(t){return t.preventDefault(),e.previewExpand(t)}}},[a("let-form-item",{attrs:{label:e.$t("deployService.form.app"),itemWidth:"240px",required:""}},[a("let-select",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty")},on:{change:function(t){return e.changeSelect("application")}},model:{value:e.model.application,callback:function(t){e.$set(e.model,"application",t)},expression:"model.application"}},e._l(e.applications,(function(t){return a("let-option",{key:t,attrs:{value:t}},[e._v(" "+e._s(t)+" ")])})),1)],1),a("let-form-item",{attrs:{label:e.$t("serverList.table.th.service"),itemWidth:"240px",required:""}},[a("let-select",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty")},on:{change:function(t){return e.changeSelect("server_name")}},model:{value:e.model.server_name,callback:function(t){e.$set(e.model,"server_name",t)},expression:"model.server_name"}},e._l(e.serverNames,(function(t){return a("let-option",{key:t,attrs:{value:t}},[e._v(e._s(t))])})),1)],1),a("let-form-item",{attrs:{label:"Set",itemWidth:"240px",required:""}},[a("let-select",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty")},on:{change:function(t){return e.changeSelect("set")}},model:{value:e.model.set,callback:function(t){e.$set(e.model,"set",t)},expression:"model.set"}},e._l(e.sets,(function(t){return a("let-option",{key:t,attrs:{value:t||-1}},[e._v(" "+e._s(t||e.$t("serviceExpand.form.disableSet"))+" ")])})),1)],1),a("let-form-item",{attrs:{label:e.$t("serverList.table.th.ip"),itemWidth:"240px",required:""}},[a("let-select",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:e.model.node_name,callback:function(t){e.$set(e.model,"node_name",t)},expression:"model.node_name"}},e._l(e.nodeNames,(function(t){return a("let-option",{key:t,attrs:{value:t}},[e._v(e._s(t))])})),1)],1),a("let-form-item",{attrs:{label:e.$t("serviceExpand.form.tarIP"),itemWidth:"100%",required:""}},[a("let-input",{attrs:{type:"textarea",rows:3,placeholder:e.$t("serviceExpand.form.placeholder"),required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:e.expandIpStr,callback:function(t){e.expandIpStr=t},expression:"expandIpStr"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.table.th.enableSet")}},[a("SetInputer",{attrs:{enabled:e.model.enable_set,name:e.model.set_name,area:e.model.set_area,group:e.model.set_group},on:{"update:enabled":function(t){return e.$set(e.model,"enable_set",t)},"update:name":function(t){return e.$set(e.model,"set_name",t)},"update:area":function(t){return e.$set(e.model,"set_area",t)},"update:group":function(t){return e.$set(e.model,"set_group",t)}}})],1),a("let-form-item",{attrs:{label:e.$t("serviceExpand.form.nodeConfig"),itemWidth:"100%"}},[a("let-checkbox",{model:{value:e.model.copy_node_config,callback:function(t){e.$set(e.model,"copy_node_config",t)},expression:"model.copy_node_config"}},[e._v(" "+e._s(e.$t("serviceExpand.form.copyNodeConfig"))+" ")])],1),a("let-button",{attrs:{type:"sumbit",theme:"primary"}},[e._v(e._s(e.$t("serviceExpand.form.preExpand")))])],1),a("let-form",{directives:[{name:"show",rawName:"v-show",value:e.previewItems.length>0,expression:"previewItems.length > 0"}],ref:"expandForm",staticClass:"mt40",attrs:{inline:""},nativeOn:{submit:function(t){return t.preventDefault(),e.expand(t)}}},[a("let-table",{ref:"table",attrs:{data:e.previewItems,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{scopedSlots:e._u([{key:"head",fn:function(t){return[a("let-checkbox",{model:{value:e.isCheckedAll,callback:function(t){e.isCheckedAll=t},expression:"isCheckedAll"}})]}},{key:"default",fn:function(t){return[t.row.status==e.$t("serviceExpand.form.noExpand")?a("let-checkbox",{model:{value:t.row.isChecked,callback:function(a){e.$set(t.row,"isChecked",a)},expression:"scope.row.isChecked"}}):e._e()]}}])}),a("let-table-column",{attrs:{title:e.$t("historyList.dlg.th.c2"),prop:"application"}}),a("let-table-column",{attrs:{title:e.$t("historyList.dlg.th.c3"),prop:"server_name"}}),a("let-table-column",{attrs:{title:"Set",prop:"set"}}),a("let-table-column",{attrs:{title:e.$t("serverList.servant.objName"),prop:"obj_name"}}),a("let-table-column",{attrs:{title:e.$t("historyList.dlg.th.c4"),prop:"node_name"}}),a("let-table-column",{attrs:{title:e.$t("deployService.table.th.endpoint")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-input",{model:{value:t.row.bind_ip,callback:function(a){e.$set(t.row,"bind_ip",a)},expression:"scope.row.bind_ip"}})]}}])}),a("let-table-column",{attrs:{title:e.$t("deployService.table.th.port")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-input",{model:{value:t.row.port,callback:function(a){e.$set(t.row,"port",a)},expression:"scope.row.port"}})]}}])}),a("let-table-column",{attrs:{title:e.$t("deployService.form.template"),prop:"template_name"}}),a("let-table-column",{attrs:{title:e.$t("historyList.dlg.th.c8"),prop:"status"}})],1),a("let-button",{attrs:{type:"button",theme:"sub-primary"},on:{click:function(t){return e.getAutoPort()}}},[e._v(e._s(e.$t("deployService.form.getPort"))+" ")]),a("let-button",{attrs:{type:"sumbit",theme:"primary"}},[e._v(e._s(e.$t("deployService.title.expand")))])],1),a("let-modal",{staticClass:"more-cmd",attrs:{width:"700px",footShow:!1},on:{close:e.closeResultModal,"on-cancel":e.closeResultModal},model:{value:e.resultModal.show,callback:function(t){e.$set(e.resultModal,"show",t)},expression:"resultModal.show"}},[a("p",{staticClass:"result-text"},[e._v(e._s(e.$t("serviceExpand.form.errTips.success"))+e._s(e.$t("resource.installRstMsg")))]),a("let-table",{attrs:{data:e.resultModal.resultList,"empty-msg":e.$t("common.nodata"),"row-class-name":e.resultModal.rowClassName}},[a("let-table-column",{attrs:{title:"ip",prop:"ip"}}),a("let-table-column",{attrs:{title:e.$t("resource.installResult"),prop:"rst"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("p",{domProps:{textContent:e._s(t.row.rst?e.$t("common.success"):e.$t("common.error"))}})]}}])}),a("let-table-column",{attrs:{title:e.$t("common.message"),prop:"msg"}})],1)],1)],1)},ge=[],$e=(a("c975"),"((\\d{1,2}|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d{1,2}|1\\d\\d|2[0-4]\\d|25[0-5])"),we=function(){return{application:"",server_name:"",set:"",node_name:"",expand_nodes:[],enable_set:!1,set_name:"",set_area:"",set_group:"",copy_node_config:!1}},ye={name:"OperationExpand",components:{SetInputer:de},data:function(){return{model:we(),applications:[],serverNames:[],sets:[],nodeNames:[],expandIpStr:"",previewItems:[],ipReg:"^".concat($e,"$"),isCheckedAll:!1,resultModal:{show:!1,resultList:[],rowClassName:function(e){return e&&e.row&&!e.row.rst?"err-row":""}}}},mounted:function(){var e=this;this.getCascadeSelectServer({level:1},this.$t("common.error")).then((function(t){e.applications=t}))},methods:{changeSelect:function(e){var t=this;switch(e){case"application":this.model.server_name="",this.serverNames=[],this.model.application&&this.getCascadeSelectServer({level:2,application:this.model.application},this.$t("common.error")).then((function(e){t.serverNames=e}));break;case"server_name":this.model.set="",this.sets=[],this.model.server_name&&this.getCascadeSelectServer({level:3,application:this.model.application,server_name:this.model.server_name},this.$t("common.error")).then((function(e){t.sets=e}));break;case"set":if(this.model.node_name="",this.model.nodeName=[],this.model.set){var a=-1===parseInt(this.model.set,10)?"":this.model.set;this.getCascadeSelectServer({level:4,application:this.model.application,server_name:this.model.server_name,set:a},this.$t("common.error")).then((function(e){t.nodeNames=e}))}break;default:break}},getCascadeSelectServer:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.$t("common.error");return this.$ajax.getJSON("/server/api/cascade_select_server",e).then((function(e){return e})).catch((function(e){t.$tip.error("".concat(a,": ").concat(e.message||e.err_msg))}))},indexOf:function(e,t){for(var a=0;a<e.length;a++)if(e[a]==t)return a;return-1},previewExpand:function(){var e=this;if(this.$refs.configForm.validate()){var t=Object.assign({},this.model);t.set=-1===parseInt(t.set,10)?"":t.set,t.expand_nodes=this.expandIpStr.trim().split(/[,;\n]/);var a=this.indexOf(t.expand_nodes,this.model.node_name);if(-1!=a)return void this.$tip.error("".concat(this.$t("serviceExpand.exists")));t.expand_nodes=t.expand_nodes.filter((function(e){return""!=e.trim()}));var o=this.$Loading.show();this.$ajax.postJSON("/server/api/expand_server_preview",t).then((function(t){o.hide();var a=t||[];a.forEach((function(e){e.isChecked=!1})),e.isCheckedAll=!1,e.previewItems=a})).catch((function(t){o.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))}},getAutoPort:function(){var e=this,t=this.previewItems.filter((function(t){return t.status===e.$t("serviceExpand.form.noExpand")&&t.isChecked}));if(0!=t.length){var a=this.$Loading.show(),o=[];t.forEach((function(e){o.push(e.bind_ip)})),this.$ajax.getJSON("/server/api/auto_port",{node_name:o.join(";")}).then((function(o){a.hide(),o.forEach((function(a,o){e.$set(t[o],"port",String(a.port||""))}))})).catch((function(t){a.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))}else this.$tip.error(this.$t("serviceExpand.form.errTips.nodeCheck"))},expand:function(){var e=this;if(this.$refs.expandForm.validate()){var t=this.previewItems.filter((function(t){return t.status===e.$t("serviceExpand.form.noExpand")&&t.isChecked}));if(t.length>0){var a=[];t.forEach((function(e){a.push({bind_ip:e.bind_ip,node_name:e.node_name,obj_name:e.obj_name,port:e.port,set:e.set})}));var o={application:this.model.application,server_name:this.model.server_name,set:-1===parseInt(this.model.set,10)?"":this.model.set,node_name:this.model.node_name,copy_node_config:this.model.copy_node_config,expand_preview_servers:a},s=this.$Loading.show();this.$ajax.postJSON("/server/api/expand_server",o).then((function(t){s.hide(),t.tars_node_rst&&t.tars_node_rst.length?e.showResultModal(t.tars_node_rst):e.$tip.success(e.$t("serviceExpand.form.errTips.success"))})).catch((function(t){s.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))}else this.$tip.error(this.$t("serviceExpand.form.errTips.noneNodes"))}},showResultModal:function(e){this.resultModal.resultList=e,this.resultModal.show=!0},closeResultModal:function(){this.resultModal.show=!1,this.resultModal.resultList=[]}},watch:{isCheckedAll:function(){var e=this.isCheckedAll;this.previewItems.forEach((function(t){t.isChecked=e}))}}},ke=ye,xe=(a("2541"),Object(b["a"])(ke,_e,ge,!1,null,null,null)),Se=xe.exports,Me=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page_operation_templates"},[a("let-button",{staticStyle:{float:"right"},attrs:{size:"small",theme:"primary"},on:{click:e.addItem}},[e._v(e._s(e.$t("template.btn.addTempate")))]),a("let-form",{attrs:{inline:"",itemWidth:"200px"},nativeOn:{submit:function(t){return t.preventDefault(),e.search(t)}}},[a("let-form-item",{attrs:{label:e.$t("deployService.form.template")}},[a("let-input",{attrs:{size:"small"},model:{value:e.query.template_name,callback:function(t){e.$set(e.query,"template_name",t)},expression:"query.template_name"}})],1),a("let-form-item",{attrs:{label:e.$t("template.search.parentTemplate")}},[a("let-input",{attrs:{size:"small"},model:{value:e.query.parents_name,callback:function(t){e.$set(e.query,"parents_name",t)},expression:"query.parents_name"}})],1),a("let-form-item",[a("let-button",{attrs:{size:"small",type:"submit",theme:"primary"}},[e._v(e._s(e.$t("operate.search")))])],1)],1),a("let-table",{ref:"table",attrs:{data:e.items,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("deployService.form.template"),prop:"template_name",width:"25%"}}),a("let-table-column",{attrs:{title:e.$t("template.search.parentTemplate"),prop:"parents_name",width:"25%"}}),a("let-table-column",{attrs:{title:e.$t("cfg.btn.lastUpdate"),prop:"posttime"}}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"300px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.mergeItem(t.row)}}},[e._v(e._s(e.$t("operate.merge")))]),a("let-table-operation",{on:{click:function(a){return e.viewItem(t.row)}}},[e._v(e._s(e.$t("operate.view")))]),a("let-table-operation",{on:{click:function(a){return e.editItem(t.row)}}},[e._v(e._s(e.$t("operate.update")))]),a("let-table-operation",{on:{click:function(a){return e.removeItem(t.row)}}},[e._v(e._s(e.$t("operate.delete")))])]}}])})],1),a("let-modal",{attrs:{title:e.$t("template.view.title"),width:"800px"},model:{value:e.viewModal.show,callback:function(t){e.$set(e.viewModal,"show",t)},expression:"viewModal.show"}},[e.viewModal.model?a("pre",[e._v(e._s(e.viewModal.model.profile))]):e._e(),a("div",{attrs:{slot:"foot"},slot:"foot"})]),a("let-modal",{attrs:{title:e.detailModal.isNew?this.$t("template.add.title"):this.$t("template.update.title"),width:"800px"},on:{"on-confirm":e.saveItem,"on-cancel":e.closeDetailModal},model:{value:e.detailModal.show,callback:function(t){e.$set(e.detailModal,"show",t)},expression:"detailModal.show"}},[e.detailModal.model?a("let-form",{ref:"detailForm",attrs:{itemWidth:"700px"}},[a("let-form-item",{attrs:{label:e.$t("deployService.form.template"),required:""}},[a("let-input",{attrs:{size:"small",placeholder:e.$t("template.add.templateFormatTips"),required:"","required-tip":e.$t("template.add.templateNameTips"),pattern:"^[a-zA-Z]([.a-zA-Z0-9]+)?$","pattern-tip":e.$t("template.add.templateFormatTips")},model:{value:e.detailModal.model.template_name,callback:function(t){e.$set(e.detailModal.model,"template_name",t)},expression:"detailModal.model.template_name"}})],1),a("let-form-item",{attrs:{label:e.$t("template.search.parentTemplate"),required:""}},[a("let-select",{attrs:{size:"small",placeholder:e.$t("pub.dlg.defaultValue"),required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:e.detailModal.model.parents_name,callback:function(t){e.$set(e.detailModal.model,"parents_name",t)},expression:"detailModal.model.parents_name"}},[a("let-option",{attrs:{value:""}},[e._v(e._s(e.$t("pub.dlg.defaultValue")))]),e._l(e.items,(function(t){return a("let-option",{key:t.id,attrs:{value:t.template_name}},[e._v(e._s(t.template_name))])}))],2)],1),a("let-form-item",{attrs:{label:e.$t("template.form.content"),required:""}},[a("let-input",{attrs:{type:"textarea",rows:10,size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:e.detailModal.model.profile,callback:function(t){e.$set(e.detailModal.model,"profile",t)},expression:"detailModal.model.profile"}})],1)],1):e._e()],1)],1)},Le=[],je={name:"OperationTemplates",data:function(){return{query:{template_name:"",parents_name:""},items:[],viewModal:{show:!1,model:null},detailModal:{show:!1,model:null,isNew:!1}}},mounted:function(){this.fetchData()},methods:{fetchData:function(){var e=this,t=this.$refs.table.$loading.show();return this.$ajax.getJSON("/server/api/query_profile_template",this.query).then((function(a){t.hide(),e.items=a})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.message||a.err_msg))}))},search:function(){this.fetchData()},closeDetailModal:function(){this.$refs.detailForm.resetValid(),this.detailModal.show=!1,this.detailModal.model=null},addItem:function(){this.detailModal.model={},this.detailModal.show=!0,this.detailModal.isNew=!0},viewItem:function(e){this.viewModal.model=e,this.viewModal.show=!0},editItem:function(e){this.detailModal.model=e,this.detailModal.show=!0,this.detailModal.isNew=!1},mergeItem:function(e){var t=this,a=this.$Loading.show();this.$ajax.getJSON("/server/api/get_merge_profile_template",{template_name:e.template_name}).then((function(o){a.hide(),e.profile=o.template,t.viewModal.model=e,t.viewModal.show=!0})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))},saveItem:function(){var e=this;if(this.$refs.detailForm.validate()){var t=this.detailModal.model,a=t.id?"/server/api/update_profile_template":"/server/api/add_profile_template",o=this.$Loading.show();this.$ajax.postJSON(a,t).then((function(){o.hide(),e.$tip.success(e.$t("common.success")),e.closeDetailModal(),e.fetchData()})).catch((function(t){o.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))}},removeItem:function(e){var t=this;this.$confirm(this.$t("template.delete.confirmTips"),this.$t("common.alert")).then((function(){var a=t.$Loading.show();t.$ajax.getJSON("/server/api/delete_profile_template",{id:e.id}).then((function(){a.hide(),t.fetchData().then((function(){t.$tip.success(t.$t("common.success"))}))})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))})).catch((function(){}))}}},Ce=je,Te=(a("4dec"),Object(b["a"])(Ce,Me,Le,!1,null,null,null)),Ne=Te.exports,Pe=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page_operation_templates"},[a("let-button",{staticStyle:{float:"right"},attrs:{size:"small",theme:"primary"},on:{click:e.addItem}},[e._v(e._s(e.$t("nodes.btn.addNode")))]),a("let-form",{attrs:{inline:"",itemWidth:"200px"},nativeOn:{submit:function(t){return t.preventDefault(),e.search(t)}}},[a("let-form-item",{attrs:{label:e.$t("nodes.node_name")}},[a("let-input",{attrs:{size:"small"},model:{value:e.query.node_name,callback:function(t){e.$set(e.query,"node_name",t)},expression:"query.node_name"}})],1),a("let-form-item",[a("let-button",{attrs:{size:"small",type:"submit",theme:"primary"}},[e._v(e._s(e.$t("operate.search")))])],1)],1),a("let-table",{ref:"nodeListLoading",attrs:{data:e.nodeList,stripe:"","empty-msg":e.$t("common.nodata"),"row-class-name":e.tableRowClassName}},[a("let-table-column",{attrs:{title:e.$t("nodeList.table.th.node_name"),prop:"node_name"}}),a("let-table-column",{attrs:{title:e.$t("nodeList.table.th.present_state"),prop:"present_state"}}),a("let-table-column",{attrs:{title:e.$t("common.time"),prop:"last_reg_time"}}),a("let-table-column",{attrs:{title:e.$t("nodeList.table.th.last_heartbeat"),prop:"last_heartbeat"}}),a("let-table-column",{attrs:{title:e.$t("nodeList.table.th.tars_version"),prop:"tars_version"}}),a("let-table-column",{attrs:{title:e.$t("nodeList.table.th.load_avg5"),prop:"load_avg5"}}),a("let-table-column",{attrs:{title:e.$t("nodeList.table.th.check")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.checkNode(t.row.node_name)}}},[e._v(e._s(e.$t("nodeList.table.th.check")))])]}}])})],1),a("let-pagination",{staticStyle:{"margin-bottom":"32px"},attrs:{page:e.pageNum,total:e.total},on:{change:e.gotoPage}}),a("let-modal",{attrs:{title:this.$t("connectNodeList.title"),width:"750px",footShow:!1,showClose:!1},model:{value:e.connectModal.show,callback:function(t){e.$set(e.connectModal,"show",t)},expression:"connectModal.show"}},[a("let-table",{ref:"connectNodeListLoading",staticStyle:{"margin-top":"20px"},attrs:{data:e.connectNodeList,stripe:"","empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{type:"expand",width:"40px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"install_step"},[a("let-steps",{attrs:{current:t.row.step||0}},[a("let-step",{attrs:{title:e.$t("connectNodeList.step1")}}),a("let-step",{attrs:{title:e.$t("connectNodeList.step2")}}),a("let-step",{attrs:{title:e.$t("connectNodeList.step3")}}),a("let-step",{attrs:{title:e.$t("connectNodeList.step4")}}),a("let-step",{attrs:{title:e.$t("connectNodeList.step5")}})],1),"fail"==t.row.installState&&1==t.row.step?a("p",{staticClass:"fail_txt"},[e._v("Error: please check file /usr/local/app/web/files/tarsnode.tgz")]):e._e(),"fail"==t.row.installState&&2==t.row.step?a("p",{staticClass:"fail_txt"},[e._v("Error: please ensure the ssh service is enabled, and the ip/port/user/password config is right")]):e._e(),"fail"==t.row.installState&&3==t.row.step?a("p",{staticClass:"fail_txt"},[e._v("Error: please install wget on the node")]):e._e(),"fail"==t.row.installState&&4==t.row.step?a("p",{staticClass:"fail_txt"},[e._v("Error: please ensure the registry is available")]):e._e(),"fail"==t.row.installState&&5==t.row.step?a("p",{staticClass:"fail_txt"},[e._v("Error: some unknown error, please check log")]):e._e()],1)]}}])}),a("let-table-column",{attrs:{title:e.$t("connectNodeList.table.th.node_name"),prop:"ip"}}),a("let-table-column",{attrs:{title:e.$t("connectNodeList.table.th.connect"),prop:"connectInfo"}}),a("let-table-column",{attrs:{title:e.$t("connectNodeList.table.th.exists"),prop:"existsInfo"}}),a("let-table-column",{attrs:{title:e.$t("connectNodeList.table.th.install")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{class:{success_txt:"success"==t.row.installState,fail_txt:"fail"==t.row.installState}},[e._v(e._s(t.row.installInfo))])]}}])})],1),a("let-button",{attrs:{theme:"primary",disabled:e.executeConnect},on:{click:e.connectNode}},[e._v(e._s(e.btnConnectText))]),a("let-button",{attrs:{theme:"primary",disabled:e.executeInstall},on:{click:e.installNode}},[e._v(e._s(e.btnInstallText))]),a("let-button",{staticStyle:{float:"right"},attrs:{theme:"primary"},on:{click:e.closeConnectModal}},[e._v(e._s(e.$t("connectNodeList.btnClose")))])],1),a("let-modal",{attrs:{title:this.$t("nodes.add.title"),width:"500px"},on:{"on-confirm":e.showConnectNode,"on-cancel":e.closeDetailModal},model:{value:e.detailModal.show,callback:function(t){e.$set(e.detailModal,"show",t)},expression:"detailModal.show"}},[e.detailModal.model?a("let-form",{ref:"detailForm",attrs:{itemWidth:"450px"}},[a("let-form-item",{attrs:{label:e.$t("nodes.node_name"),required:""}},[a("let-input",{attrs:{type:"textarea",rows:3,placeholder:e.$t("nodes.nodeNameTips"),required:"","required-tip":e.$t("nodes.nodeNameTips")},model:{value:e.detailModal.model.node_name,callback:function(t){e.$set(e.detailModal.model,"node_name",t)},expression:"detailModal.model.node_name"}})],1),a("let-form-item",{attrs:{label:e.$t("nodes.user"),required:""}},[a("let-input",{attrs:{size:"small",disabled:""},model:{value:e.detailModal.model.user,callback:function(t){e.$set(e.detailModal.model,"user",t)},expression:"detailModal.model.user"}})],1),a("let-form-item",{attrs:{label:e.$t("nodes.port"),required:""}},[a("let-input",{attrs:{size:"small",placeholder:e.$t("nodes.portTips"),required:"","required-tip":e.$t("nodes.portTips"),pattern:"^[^\\s]+$","pattern-tip":e.$t("nodes.portTips")},model:{value:e.detailModal.model.port,callback:function(t){e.$set(e.detailModal.model,"port",t)},expression:"detailModal.model.port"}})],1),a("let-form-item",{attrs:{label:e.$t("nodes.password")}},[a("let-input",{attrs:{size:"small"},model:{value:e.detailModal.model.password,callback:function(t){e.$set(e.detailModal.model,"password",t)},expression:"detailModal.model.password"}})],1),a("let-form-item",{attrs:{label:e.$t("nodes.runuser"),required:""}},[a("let-input",{attrs:{size:"small",required:"","required-tip":e.$t("nodes.runuserTips"),pattern:"^[^\\s]+$","pattern-tip":e.$t("nodes.runuserTips")},model:{value:e.detailModal.model.runuser,callback:function(t){e.$set(e.detailModal.model,"runuser",t)},expression:"detailModal.model.runuser"}})],1)],1):e._e()],1)],1)},qe=[],Oe=a("c1df"),ze=a.n(Oe),De={name:"OperationNodes",data:function(){return{query:{node_name:""},nodeList:[],pageNum:1,pageSize:20,total:1,executeInstall:!1,executeConnect:!1,btnConnectText:"",btnInstallText:"",isCheckedAll:!1,connectNodeList:[],connectModal:{show:!1},detailModal:{show:!1,model:{user:"root",password:"",port:"22",runuser:"tars"}}}},mounted:function(){this.getNodeList(1)},methods:{checkNode:function(e){var t=this,a=this.$refs.nodeListLoading.$loading.show();this.$ajax.getJSON("/server/api/check_tars_node",{node_name:e}).then((function(e){a.hide(),t.$tip.success("".concat(t.$t("nodeList.checkNode"),": ").concat(e))})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))}))},tableRowClassName:function(e){var t=e.row;e.rowIndex;return"active"===t.present_state?"red-row":""},getNodeList:function(e){var t=this,a=this.$refs.nodeListLoading.$loading.show();e||(e=this.pageNum||1),this.$ajax.getJSON("/server/api/list_tars_node",{node_name:this.query.node_name,page_size:this.pageSize,curr_page:e}).then((function(o){a.hide(),t.pageNum=e,t.total=Math.ceil(o.count/t.pageSize),t.nodeList=o.rows,t.nodeList.forEach((function(e){e.last_heartbeat=ze()(e.last_heartbeat).format("YYYY-MM-DD HH:mm:ss"),e.last_reg_time=ze()(e.last_reg_time).format("YYYY-MM-DD HH:mm:ss")}))})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))}))},gotoPage:function(e){this.getNodeList(e)},search:function(){this.getNodeList(1)},closeDetailModal:function(){this.$refs.detailForm.resetValid(),this.detailModal.show=!1},closeConnectModal:function(){this.executeConnect||this.executeInstall?alert(this.$t("connectNodeList.execute")):(this.btnConnectText=this.$t("connectNodeList.btnConnect"),this.btnInstallText=this.$t("connectNodeList.btnInstall"),this.connectModal.show=!1)},addItem:function(){this.detailModal.show=!0},showConnectNode:function(){var e=this;if(this.$refs.detailForm.validate()){this.btnConnectText=this.$t("connectNodeList.btnConnect"),this.btnInstallText=this.$t("connectNodeList.btnInstall"),this.connectNodeList=[];var t=this.detailModal.model;t.node_name.split(/[,;\n]/).forEach((function(t){if(""!==t.trim()){var a={ip:t,connect:!1,connectInfo:"",exists:!1,existsInfo:"",step:0,installState:"",installInfo:""};e.connectNodeList.push(a)}})),this.connectModal.show=!0}},connectNode:function(e){var t=this;if(this.executeInstall)alert(this.$t("connectNodeList.executeInstall"));else if(0!=this.connectNodeList.length){this.btnConnectText=this.$t("connectNodeList.install.connect"),this.executeConnect=!0;var a=this.connectNodeList.length;this.connectNodeList.forEach((function(e){var o=Object.assign({},t.detailModal.model);o.node_name=e.ip,e.installState="",e.connectInfo="",e.existsInfo="",e.installInfo=t.$t("connectNodeList.install.connect"),t.$ajax.postJSON("/server/api/connect_tars_node",o).then((function(o){e.connectInfo=o.connectInfo,e.existsInfo=o.existsInfo,e.installInfo=o.installInfo,e.connect=o.connect,0==--a&&(t.btnConnectText=t.$t("connectNodeList.btnConnect"),t.executeConnect=!1)})).catch((function(o){t.$tip.error("".concat(t.$t("common.error"),": ").concat(o.message||o.err_msg)),e.installInfo=t.$t("common.error"),0==--a&&(t.btnConnectText=t.$t("connectNodeList.btnConnect"),t.executeConnect=!1)}))}))}},installNode:function(e){var t=this;if(this.executeConnect)alert(this.$t("connectNodeList.executeConnect"));else{var a=[];this.connectNodeList.forEach((function(e){a.push(e.ip),e.installState=""}));var o=this.detailModal.model,s=Object.assign({},o);s.node_name=a.join(";"),this.btnInstallText=this.$t("connectNodeList.btnInstalling"),this.executeInstall=!1,this.$ajax.postJSON("/server/api/install_tars_nodes",s).then((function(e){e.forEach((function(e){var a=t.connectNodeList.filter((function(t){return t.ip==e.ip}));a.length>0&&(a[0].installInfo=e.msg,a[0].installState=e.installState,a[0].step=e.step),e.rst||t.$tip.error(e.ip+":"+e.msg)})),t.getNodeList(1),t.btnInstallText=t.$t("connectNodeList.btnInstalled"),t.executeInstall=!1})).catch((function(e){t.btnInstallText=t.$t("connectNodeList.btnInstalled"),t.executeInstall=!1,t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))}}}},Ee=De,Ie=(a("0745"),Object(b["a"])(Ee,Pe,qe,!1,null,"5200c58e",null)),Ae=Ie.exports,Je=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page_operation_templates",staticStyle:{"text-align":"center"}},[a("let-button",{attrs:{size:"small",theme:"primary"},on:{click:e.checkFramework}},[e._v(e._s(e.$t("nodes.btn.check")))]),a("let-button",{staticStyle:{float:"right"},attrs:{theme:"info"},on:{click:e.openShowProblem}},[e._v("有问题怎么办?")]),a("br"),a("br"),a("let-table",{ref:"checkLoading",attrs:{data:e.servers,stripe:"","row-class-name":e.tableRowClassName,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("checkTable.table.th.server_name"),prop:"serverName"}}),a("let-table-column",{attrs:{title:e.$t("checkTable.table.th.node_name"),prop:"nodeName"}}),a("let-table-column",{attrs:{title:e.$t("checkTable.table.th.obj_name"),prop:"objName"}}),a("let-table-column",{attrs:{title:e.$t("checkTable.table.th.status"),prop:"status"}})],1),a("let-modal",{attrs:{title:e.$t("checkTable.problemDialog.title"),width:"600px"},model:{value:e.showProblem,callback:function(t){e.showProblem=t},expression:"showProblem"}},[a("div",[a("br"),a("p",[e._v(e._s(e.$t("checkTable.problemDialog.info")))]),a("br"),a("p",[e._v(e._s(e.$t("checkTable.problemDialog.restartFramework")))]),a("p",[e._v(e._s(e.$t("checkTable.problemDialog.stopFramework")))]),a("p",[e._v(e._s(e.$t("checkTable.problemDialog.restartServer")))])])])],1)},Fe=[],Re={name:"OperationCheck",data:function(){return{showProblem:!1,servers:[]}},mounted:function(){},methods:{openShowProblem:function(){this.showProblem=!0},tableRowClassName:function(e){var t=e.row;e.rowIndex;return 1===t.check?"":2===t.check?"checking-row":0===t.check?"success-row":-1===t.check?"warning-row":""},checkFramework:function(){var e=this,t=this.$refs.checkLoading.$loading.show();this.$ajax.getJSON("/server/api/get_framework_list").then((function(a){t.hide();for(var o=0;o<a.servers.length;o++)a.servers[o].check=1,a.servers[o].status="waiting";e.servers=a.servers;var s=e;for(o=0;o<s.servers.length;o++)(function(e){setTimeout((function(){s.checkServer(e)}),100*e)})(o)})).catch((function(a){t.hide(),e.$Notice({title:e.$t("checkTable.adminRegistryFailed"),message:e.$t("checkTable.restartAdminRegistry"),type:"error",duration:0})}))},checkServer:function(e){var t=this,a=this.servers[e];a.check=2,a.status="checking",this.$ajax.postJSON("/server/api/check_framework_server",{server:a}).then((function(e){a.check=0,a.status="succ"})).catch((function(e){a.check=-1,a.status=t.$t("checkTable.failed")}))}}},Ve=Re,Ue=(a("9b56"),Object(b["a"])(Ve,Je,Fe,!1,null,"5abcb66e",null)),He=Ue.exports;o["default"].use(S["a"]);var We=new S["a"]({routes:[{path:"/server",name:"Server",component:N,children:[{path:":treeid/manage",component:P["a"]},{path:":treeid/publish",component:U},{path:":treeid/config",component:H["a"]},{path:":treeid/server-monitor",component:W["a"]},{path:":treeid/property-monitor",component:Y["a"]},{path:":treeid/interface-debuger",component:Z["a"]},{path:":treeid/user-manage",component:G["a"]}]},{path:"/operation",name:"Operation",component:ae,redirect:"/operation/deploy",children:[{path:"deploy",component:be},{path:"expand",component:Se},{path:"templates",component:Ne},{path:"nodes",component:Ae},{path:"check",component:He}]},{path:"*",redirect:"/server"}],scrollBehavior:function(e,t,a){return{x:0,y:0}}});a("9c65");o["default"].config.productionTip=!1,h["b"].call(void 0).then((function(){new o["default"]({i18n:h["a"],el:"#app",router:We,components:{App:x},template:"<App/>"})}))},5793:function(e,t,a){},"734f":function(e,t,a){},"9b56":function(e,t,a){"use strict";var o=a("1a1a"),s=a.n(o);s.a},"9c65":function(e,t,a){},"9ce0":function(e,t,a){"use strict";var o=a("f71f"),s=a.n(o);s.a},a5d2:function(e,t,a){"use strict";var o=a("169f"),s=a.n(o);s.a},a8f5:function(e,t,a){"use strict";var o=a("734f"),s=a.n(o);s.a},c1df0:function(e,t,a){"use strict";var o=a("ea4d"),s=a.n(o);s.a},ca5f:function(e,t,a){},cbf2:function(e,t,a){},ea4d:function(e,t,a){},ea8c:function(e,t,a){"use strict";var o=a("cbf2"),s=a.n(o);s.a},f71f:function(e,t,a){},fc15:function(e,t,a){}});