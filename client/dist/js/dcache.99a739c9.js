(function(e){function t(t){for(var r,n,l=t[0],i=t[1],c=t[2],u=0,m=[];u<l.length;u++)n=l[u],Object.prototype.hasOwnProperty.call(o,n)&&o[n]&&m.push(o[n][0]),o[n]=0;for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r]);d&&d(t);while(m.length)m.shift()();return s.push.apply(s,c||[]),a()}function a(){for(var e,t=0;t<s.length;t++){for(var a=s[t],r=!0,l=1;l<a.length;l++){var i=a[l];0!==o[i]&&(r=!1)}r&&(s.splice(t--,1),e=n(n.s=a[0]))}return e}var r={},o={dcache:0},s=[];function n(t){if(r[t])return r[t].exports;var a=r[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=r,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(a,r,function(t){return e[t]}.bind(null,r));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/";var l=window["webpackJsonp"]=window["webpackJsonp"]||[],i=l.push.bind(l);l.push=t,l=l.slice();for(var c=0;c<l.length;c++)t(l[c]);var d=i;s.push([1,"chunk-vendors","chunk-common"]),a()})({"018f":function(e,t,a){"use strict";var r=a("d8c6"),o=a.n(r);o.a},"0207":function(e,t,a){"use strict";var r=a("9e5a"),o=a.n(r);o.a},"04bd":function(e,t,a){"use strict";var r=a("2982"),o=a.n(r);o.a},"0e15":function(e,t,a){"use strict";var r=a("44bd"),o=a.n(r);o.a},"0e33":function(e,t,a){},1:function(e,t,a){e.exports=a("2f8b")},1439:function(e,t,a){},1467:function(e,t,a){},1481:function(e,t,a){"use strict";var r=a("f7a5"),o=a.n(r);o.a},"197e":function(e,t,a){"use strict";var r=a("0e33"),o=a.n(r);o.a},"1dcc":function(e,t,a){},2982:function(e,t,a){},"2f8b":function(e,t,a){"use strict";a.r(t);a("e260"),a("e6cf"),a("cca6"),a("a79d");var r=a("a026"),o=(a("42a1"),a("b3f5")),s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"app"}},[a("app-dcache-header"),a("keep-alive",[a("router-view",{staticClass:"main-width"})],1),a("app-footer",{staticClass:"app_index__footer"})],1)},n=[],l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app_index__header"},[a("div",{staticClass:"main-width"},[a("h1",{staticClass:"hidden"},[e._v("TARS")]),e._m(0),a("let-tabs",{staticClass:"tabs",attrs:{center:!0,activekey:e.$route.matched[0]?e.$route.matched[0].path:"/server"},on:{click:e.clickTab}},[a("let-tab-pane",{attrs:{tab:e.$t("header.tab.tab1"),tabkey:"/server",icon:e.serverIcon}}),a("let-tab-pane",{attrs:{tab:e.$t("header.dcache.tab2"),tabkey:"/operation",icon:e.opaIcon}}),a("let-tab-pane",{attrs:{tab:e.$t("header.tab.tab3"),tabkey:"/releasePackage",icon:e.releaseIcon}}),a("let-tab-pane",{attrs:{tab:e.$t("header.tab.tab4"),tabkey:"/config",icon:e.cacheIcon}}),a("let-tab-pane",{attrs:{tab:e.$t("header.tab.tab5"),tabkey:"/operationManage",icon:e.operatorIcon}})],1),a("div",{staticClass:"language-wrap"},[a("let-select",{attrs:{clearable:!1},on:{change:e.changeLocale},model:{value:e.locale,callback:function(t){e.locale=t},expression:"locale"}},[e._l(e.localeMessages,(function(t){return[a("let-option",{attrs:{value:t.localeCode}},[e._v(e._s(t.localeName))])]}))],2)],1),a("div",{staticClass:"user-wrap"},[a("p",{staticClass:"user-info",on:{click:function(t){e.userOptOpen=!e.userOptOpen}}},[a("span",{staticClass:"name toe"},[e._v(e._s(e.uid)+" ")]),a("i",{directives:[{name:"show",rawName:"v-show",value:e.enableLogin,expression:"enableLogin"}],staticClass:"let-icon let-icon-caret-down",class:{up:e.userOptOpen}}),a("transition",{attrs:{name:"fade"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:e.enableLogin&&e.userOptOpen,expression:"enableLogin && userOptOpen"}],staticClass:"user-pop-wrap"},[a("a",{attrs:{href:"/logout"}},[e._v(e._s(e.$t("header.logout")))])])])],1)])],1)])},i=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"logo-wrap"},[a("a",{attrs:{href:"/"}},[a("img",{staticClass:"logo",attrs:{src:"/static/img/tars-logo.png"}})]),a("a",{staticClass:"active",attrs:{href:"/dcache.html"}},[a("img",{staticClass:"logo",attrs:{alt:"dcache",src:"/static/img/dcache-logo.png"}})])])}],c=(a("ac1f"),a("5319"),a("1817")),d=a.n(c),u=a("1ca6"),m=a.n(u),p=a("4d18"),h=a.n(p),f=a("cc08"),v=a.n(f),g=a("3e1a"),_=a.n(g),b=a("f51c"),$={data:function(){return{serverIcon:d.a,opaIcon:m.a,releaseIcon:h.a,cacheIcon:v.a,operatorIcon:_.a,locale:this.$cookie.get("locale")||"cn",uid:"--",userOptOpen:!1,enableLogin:!1,localeMessages:b["c"]}},methods:{clickTab:function(e){this.$router.replace(e)},getLoginUid:function(){var e=this;this.$ajax.getJSON("/server/api/get_login_uid").then((function(t){t&&t.uid?e.uid=t.uid:e.uid="***"})).catch((function(t){e.$tip.error("获取用户登录信息: ".concat(t.err_msg||t.message))}))},changeLocale:function(){this.$cookie.set("locale",this.locale,{expires:"1Y"}),location.reload()},checkEnableLogin:function(){var e=this;this.$ajax.getJSON("/server/api/is_enable_login").then((function(t){e.enableLogin=t.enableLogin||!1})).catch((function(e){}))}},mounted:function(){this.getLoginUid(),this.checkEnableLogin()}},y=$,k=(a("cd6a"),a("2877")),w=Object(k["a"])(y,l,i,!1,null,null,null),M=w.exports,x=a("559f"),S={name:"App",components:{AppDcacheHeader:M,AppFooter:x["a"]}},C=S,N=(a("f76f"),Object(k["a"])(C,s,n,!1,null,null,null)),L=N.exports,D=a("8c4f"),O=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"page_server"},[e.treeData&&e.treeData.length?r("let-tree",{staticClass:"left-tree",attrs:{data:e.treeData,activeKey:e.$route.params.treeid},on:{"on-select":e.selectTree}}):e._e(),e.treeData&&!e.treeData.length?r("div",{staticClass:"left-tree"},[r("p",{staticClass:"loading"},[e._v(e._s(e.$t("common.noService")))])]):e._e(),e.treeData?e._e():r("div",{ref:"treeLoading",staticClass:"left-tree"},[!1===e.treeData?r("div",{staticClass:"loading"},[r("p",[e._v(e._s(e.treeErrMsg))]),r("a",{attrs:{href:"javascript:;"},on:{click:e.getTreeData}},[e._v(e._s(e.$t("common.reTry")))])]):e._e()]),this.$route.params.treeid?r("div",{staticClass:"right-view"},[r("let-tabs",{attrs:{activekey:e.$route.path},on:{click:e.clickTab}},[6!==e.serverData.level?r("let-tab-pane",{attrs:{tabkey:e.base+"/manage/"+e.serverType,tab:e.$t("header.tab.tab1")}}):e._e(),6===e.serverData.level?r("let-tab-pane",{attrs:{tabkey:e.base+"/cache",tab:e.$t("header.tab.tab1")}}):e._e(),5===e.serverData.level&&"dcache"!==e.serverType?r("let-tab-pane",{attrs:{tabkey:e.base+"/publish/"+e.serverType,tab:e.$t("index.rightView.tab.patch")}}):e._e(),5!==e.serverData.level&&4!==e.serverData.level&&1!==e.serverData.level||"dcache"===e.serverType?e._e():r("let-tab-pane",{attrs:{tabkey:e.base+"/config/"+e.serverType,tab:5===e.serverData.level?e.$t("index.rightView.tab.serviceConfig"):4===e.serverData.level?e.$t("index.rightView.tab.setConfig"):1===e.serverData.level?e.$t("index.rightView.tab.appConfig"):""}}),5===e.serverData.level?r("let-tab-pane",{attrs:{tabkey:e.base+"/server-monitor/"+e.serverType,tab:e.$t("index.rightView.tab.statMonitor")}}):e._e(),5===e.serverData.level&&"dcache"!==this.$route.params.serverType?r("let-tab-pane",{attrs:{tabkey:e.base+"/property-monitor/"+e.serverType,tab:e.$t("index.rightView.tab.propertyMonitor")}}):e._e(),5===e.serverData.level&&e.enableAuth?r("let-tab-pane",{attrs:{tabkey:e.base+"/user-manage/"+e.serverType,tab:e.$t("index.rightView.tab.privileage")}}):e._e(),6===e.serverData.level?r("let-tab-pane",{attrs:{tabkey:e.base+"/moduleCache",tab:e.$t("cache.config.configuration")}}):e._e(),6===e.serverData.level?r("let-tab-pane",{attrs:{tabkey:e.base+"/propertyMonitor",tab:e.$t("index.rightView.tab.propertyMonitor")}}):e._e()],1),r("router-view",{key:e.$route.params.treeid,ref:"childView",staticClass:"page_server_child"})],1):r("div",{staticClass:"right-view"},[r("div",{staticClass:"empty",staticStyle:{width:"300px"}},[r("img",{staticClass:"package",attrs:{src:a("4824")}}),r("p",{staticClass:"title"},[e._v(e._s(e.$t("index.rightView.title")))]),r("p",{staticClass:"notice",domProps:{innerHTML:e._s(e.$t("index.rightView.tips"))}}),r("p",{staticClass:"notice"},[e._v("https://github.com/TarsCloud/DCache")])])])],1)},I=[],T=(a("99af"),a("4160"),a("c975"),a("b0c0"),a("1276"),a("159b"),{name:"Server",data:function(){return{treeErrMsg:"加载失败",treeData:null,enableAuth:!1,serverData:{level:5,application:"",server_name:"",set_name:"",set_area:"",set_group:"",module_name:""}}},computed:{base:function(){return"/server/".concat(this.$route.params.treeid)},serverType:function(){return this.$route.params.serverType}},watch:{"$route.params.treeid":function(e){console.log("$route.params.treeid$route.params.treeid"),this.serverData=this.getServerData()},$route:function(e,t){"/server"===e.path&&this.getTreeData()}},methods:{selectTree:function(e,t){if(console.log(t),t.children&&t.children.length)this.$set(t,"expand",!t.expand),t.moduleName&&this.$router.push("/server/1".concat(t.pid.substr(1),".6").concat(t.moduleName,"/cache"));else{var a=t.serverType;!a&&(a="tars"),this.$router.push("/server/".concat(e,"/manage/").concat(a))}},handleData:function(e,t){var a=this;e&&e.length&&e.forEach((function(e){e.label=e.name,e.nodeKey=e.id,t&&(e.iconClass="tree-icon",e.expand=!0),e.children&&e.children.length&&a.handleData(e.children)}))},getTreeData:function(){var e=this;this.treeData=null,this.$nextTick((function(){var t=e.$loading.show({target:e.$refs.treeLoading});e.$ajax.getJSON("/server/api/dtree").then((function(a){t.hide(),e.treeData=a,e.handleData(e.treeData,!0)})).catch((function(a){t.hide(),console.error(a),e.treeErrMsg=a.err_msg||a.message||"加载失败",e.treeData=!1}))}))},getServerData:function(){if(!this.$route.params.treeid)return{};var e=this.$route.params.treeid.split("."),t={level:5,application:"",server_name:"",set_name:"",set_area:"",set_group:""};return e.forEach((function(e){console.log("item",e);var a=+e.substr(0,1),r=e.substr(1);switch(a){case 1:t.application=r;break;case 2:t.set_name=r;break;case 3:t.set_area=r;break;case 4:t.set_group=r;break;case 5:t.server_name=r;break;case 6:t.module_name=r;break;default:break}t.level=a})),t},clickTab:function(e){var t=this.isServerManage(e),a=this.isServerManage(this.$route.path),r=t&&a?{path:e,query:{time:Date.now()}}:{path:e,query:{}};this.$router.push(Object.assign({},this.$route,r))},isServerManage:function(e){return e.indexOf("/server")>-1&&(e.indexOf("/manage")>-1||e.indexOf("/cache")>-1)},isTrueTreeLevel:function(){var e=this.$route.path.split("/"),t=e[e.length-1],a=!1;5===this.serverData.level||"publish"!==t&&"server-monitor"!==t&&"property-monitor"!==t&&"user-manage"!==t||(a=!0),5!==this.serverData.level&&4!==this.serverData.level&&1!==this.serverData.level&&"config"===t&&(a=!0),a&&this.$router.replace("manage")}},created:function(){this.serverData=this.getServerData(),this.isTrueTreeLevel()},mounted:function(){this.getTreeData(),window.dcacheIndex=this}}),R=T,j=(a("42b8"),Object(k["a"])(R,O,I,!1,null,null,null)),P=j.exports,A=(a("e84a"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page_server_manage"},[e.serverList?a("let-table",{ref:"serverListLoading",attrs:{data:e.serverList,title:e.$t("serverList.title.serverList"),"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("serverList.table.th.service"),prop:"server_name"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.ip"),prop:"node_name",width:"140px"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.enableSet")},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.enable_set?a("p",{staticStyle:{"max-width":"200px"}},[e._v(" "+e._s(e.$t("common.set.setName"))+"："+e._s(t.row.set_name)),a("br"),e._v(" "+e._s(e.$t("common.set.setArea"))+"："+e._s(t.row.set_area)),a("br"),e._v(" "+e._s(e.$t("common.set.setGroup"))+"："+e._s(t.row.set_group)+" ")]):a("span",[e._v(e._s(e.$t("common.disable")))])]}}],null,!1,2963707083)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.configStatus"),width:"90px"},scopedSlots:e._u([{key:"default",fn:function(e){return[a("span",{class:"active"===e.row.setting_state?"status-active":"status-off"})]}}],null,!1,3224184510)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.currStatus"),width:"65px"},scopedSlots:e._u([{key:"default",fn:function(e){return[a("span",{class:"active"===e.row.present_state?"status-active":"activating"===e.row.present_state?"status-activating":"status-off"})]}}],null,!1,4116932289)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.processID"),prop:"process_id",width:"80px"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.version"),prop:"patch_version",width:"68px"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.time")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticStyle:{"word-break":"break-word"}},[e._v(e._s(e.handleNoPublishedTime(t.row.patch_time)))])]}}],null,!1,3144837894)}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"260px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.configServer(t.row.id)}}},[e._v(e._s(e.$t("operate.update")))]),"proxy"===e.serverType||"router"===e.serverType?a("let-table-operation",{on:{click:function(a){return e.openExpandModal(t.row)}}},[e._v(e._s(e.$t("dcache.expand")))]):e._e(),a("let-table-operation",{on:{click:function(a){return e.restartServer(t.row.id)}}},[e._v(e._s(e.$t("operate.restart")))]),a("let-table-operation",{staticClass:"danger",on:{click:function(a){return e.stopServer(t.row.id)}}},[e._v(e._s(e.$t("operate.stop")))]),a("let-table-operation",{on:{click:function(a){return e.manageServant(t.row)}}},[e._v(e._s(e.$t("operate.servant")))]),a("let-table-operation",{on:{click:function(a){return e.showMoreCmd(t.row)}}},[e._v(e._s(e.$t("operate.more")))])]}}],null,!1,2581452621)})],1):e._e(),e.serverNotifyList&&e.showOthers?a("let-table",{ref:"serverNotifyListLoading",attrs:{data:e.serverNotifyList,title:e.$t("serverList.title.serverStatus"),"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("common.time"),prop:"notifytime"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.serviceID"),prop:"server_id"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.threadID"),prop:"thread_id"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.result"),prop:"result"}})],1):e._e(),a("let-pagination",{staticStyle:{"margin-bottom":"32px"},attrs:{page:e.pageNum,total:e.total},on:{change:e.gotoPage}}),a("let-modal",{attrs:{title:e.$t("serviceExpand.title"),width:"800px",footShow:!(!e.expandModal.model||!e.expandModal.model.server_name)},on:{"on-confirm":e.expandService,close:e.closeExpandModal,"on-cancel":e.closeExpandModal},model:{value:e.expandModal.show,callback:function(t){e.$set(e.expandModal,"show",t)},expression:"expandModal.show"}},[e.expandModal.model&&e.expandModal.model.server_name?a("let-form",{ref:"expandForm",staticClass:"two-columns",attrs:{itemWidth:"360px",columns:2}},[a("let-form-item",{attrs:{label:e.$t("common.service")}},[e._v(e._s(e.expandModal.model.server_name))]),a("let-form-item",{attrs:{label:e.$t("common.ip")}},[e._v(e._s(e.expandModal.model.node_name))]),a("let-form-item",{attrs:{label:e.$t("serviceExpand.form.tarIP"),itemWidth:"100%",required:""}},[a("let-input",{attrs:{type:"textarea",rows:3,placeholder:e.$t("serviceExpand.form.placeholder"),required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:e.expandModal.expandIpStr,callback:function(t){e.$set(e.expandModal,"expandIpStr",t)},expression:"expandModal.expandIpStr"}})],1),a("let-form-item",{attrs:{label:e.$t("serviceExpand.form.nodeConfig"),itemWidth:"100%"}},[a("let-checkbox",{model:{value:e.expandModal.model.copy_node_config,callback:function(t){e.$set(e.expandModal.model,"copy_node_config",t)},expression:"expandModal.model.copy_node_config"}},[e._v(" "+e._s(e.$t("serviceExpand.form.copyNodeConfig"))+" ")])],1)],1):e._e()],1),a("let-modal",{attrs:{title:e.$t("serverList.dlg.title.editService"),width:"800px",footShow:!(!e.configModal.model||!e.configModal.model.server_name)},on:{"on-confirm":e.saveConfig,close:e.closeConfigModal,"on-cancel":e.closeConfigModal},model:{value:e.configModal.show,callback:function(t){e.$set(e.configModal,"show",t)},expression:"configModal.show"}},[e.configModal.model&&e.configModal.model.server_name?a("let-form",{ref:"configForm",staticClass:"two-columns",attrs:{itemWidth:"360px",columns:2}},[a("let-form-item",{attrs:{label:e.$t("common.service")}},[e._v(e._s(e.configModal.model.server_name))]),a("let-form-item",{attrs:{label:e.$t("common.ip")}},[e._v(e._s(e.configModal.model.node_name))]),a("let-form-item",{attrs:{label:e.$t("serverList.dlg.isBackup"),required:""}},[a("let-radio-group",{attrs:{size:"small",data:[{value:!0,text:e.$t("common.yes")},{value:!1,text:e.$t("common.no")}]},model:{value:e.configModal.model.bak_flag,callback:function(t){e.$set(e.configModal.model,"bak_flag",t)},expression:"configModal.model.bak_flag"}})],1),a("let-form-item",{attrs:{label:e.$t("common.template"),required:""}},[e.configModal.model.templates&&e.configModal.model.templates.length?a("let-select",{attrs:{size:"small",required:""},model:{value:e.configModal.model.template_name,callback:function(t){e.$set(e.configModal.model,"template_name",t)},expression:"configModal.model.template_name"}},e._l(e.configModal.model.templates,(function(t){return a("let-option",{key:t,attrs:{value:t}},[e._v(e._s(t))])})),1):a("span",[e._v(e._s(e.configModal.model.template_name))])],1),a("let-form-item",{attrs:{label:e.$t("serverList.dlg.serviceType"),required:""}},[a("let-select",{attrs:{size:"small",required:""},model:{value:e.configModal.model.server_type,callback:function(t){e.$set(e.configModal.model,"server_type",t)},expression:"configModal.model.server_type"}},e._l(e.serverTypes,(function(t){return a("let-option",{key:t,attrs:{value:t}},[e._v(e._s(t))])})),1)],1),a("let-form-item",{attrs:{label:e.$t("serverList.table.th.enableSet"),required:""}},[a("let-radio-group",{attrs:{size:"small",data:[{value:!0,text:e.$t("common.enable")},{value:!1,text:e.$t("common.disable")}]},model:{value:e.configModal.model.enable_set,callback:function(t){e.$set(e.configModal.model,"enable_set",t)},expression:"configModal.model.enable_set"}})],1),e.configModal.model.enable_set?a("let-form-item",{attrs:{label:e.$t("common.set.setName"),required:""}},[a("let-input",{attrs:{size:"small",placeholder:e.$t("serverList.dlg.errMsg.setName"),required:"",pattern:"^[a-z]+$","pattern-tip":e.$t("serverList.dlg.errMsg.setName")},model:{value:e.configModal.model.set_name,callback:function(t){e.$set(e.configModal.model,"set_name",t)},expression:"configModal.model.set_name"}})],1):e._e(),e.configModal.model.enable_set?a("let-form-item",{attrs:{label:e.$t("common.set.setArea"),required:""}},[a("let-input",{attrs:{size:"small",placeholder:e.$t("serverList.dlg.errMsg.setArea"),required:"",pattern:"^[a-z]+$","pattern-tip":e.$t("serverList.dlg.errMsg.setArea")},model:{value:e.configModal.model.set_area,callback:function(t){e.$set(e.configModal.model,"set_area",t)},expression:"configModal.model.set_area"}})],1):e._e(),e.configModal.model.enable_set?a("let-form-item",{attrs:{label:e.$t("common.set.setGroup"),required:""}},[a("let-input",{attrs:{size:"small",placeholder:e.$t("serverList.dlg.errMsg.setGroup"),required:"",pattern:"^[0-9\\*]+$","pattern-tip":e.$t("serverList.dlg.errMsg.setGroup")},model:{value:e.configModal.model.set_group,callback:function(t){e.$set(e.configModal.model,"set_group",t)},expression:"configModal.model.set_group"}})],1):e._e(),a("let-form-item",{attrs:{label:e.$t("serverList.dlg.asyncThread"),required:""}},[a("let-input",{attrs:{size:"small",placeholder:e.$t("serverList.dlg.placeholder.thread"),required:"",pattern:"tars_nodejs"===e.configModal.model.server_type?"^[1-9][0-9]*$":"^([3-9]|[1-9][0-9]+)$","pattern-tip":"$t('serverList.dlg.placeholder.thread')"},model:{value:e.configModal.model.async_thread_num,callback:function(t){e.$set(e.configModal.model,"async_thread_num",t)},expression:"configModal.model.async_thread_num"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.dlg.defaultPath")}},[a("let-input",{attrs:{size:"small"},model:{value:e.configModal.model.base_path,callback:function(t){e.$set(e.configModal.model,"base_path",t)},expression:"configModal.model.base_path"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.dlg.exePath")}},[a("let-input",{attrs:{size:"small"},model:{value:e.configModal.model.exe_path,callback:function(t){e.$set(e.configModal.model,"exe_path",t)},expression:"configModal.model.exe_path"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.dlg.startScript")}},[a("let-input",{attrs:{size:"small"},model:{value:e.configModal.model.start_script_path,callback:function(t){e.$set(e.configModal.model,"start_script_path",t)},expression:"configModal.model.start_script_path"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.dlg.stopScript")}},[a("let-input",{attrs:{size:"small"},model:{value:e.configModal.model.stop_script_path,callback:function(t){e.$set(e.configModal.model,"stop_script_path",t)},expression:"configModal.model.stop_script_path"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.dlg.monitorScript"),itemWidth:"724px"}},[a("let-input",{attrs:{size:"small"},model:{value:e.configModal.model.monitor_script_path,callback:function(t){e.$set(e.configModal.model,"monitor_script_path",t)},expression:"configModal.model.monitor_script_path"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.dlg.privateTemplate"),labelWidth:"150px",itemWidth:"724px"}},[a("let-input",{attrs:{size:"large",type:"textarea",rows:4},model:{value:e.configModal.model.profile,callback:function(t){e.$set(e.configModal.model,"profile",t)},expression:"configModal.model.profile"}})],1)],1):a("div",{ref:"configFormLoading",staticClass:"loading-placeholder"})],1),a("let-modal",{attrs:{title:e.$t("serverList.table.servant.title"),width:"1200px",footShow:!1},on:{close:e.closeServantModal},model:{value:e.servantModal.show,callback:function(t){e.$set(e.servantModal,"show",t)},expression:"servantModal.show"}},[a("let-button",{staticClass:"tbm16",attrs:{size:"small",theme:"primary"},on:{click:function(t){return e.configServant()}}},[e._v(e._s(e.$t("operate.add"))+" Servant")]),e.servantModal.model?a("let-table",{attrs:{data:e.servantModal.model,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("operate.servant"),prop:"servant"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.servant.adress"),prop:"endpoint"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.servant.thread"),prop:"thread_num"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.servant.maxConnecttions"),prop:"max_connections"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.servant.maxQueue"),prop:"queuecap"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.servant.timeout"),prop:"queuetimeout"}}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"90px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.configServant(t.row.id)}}},[e._v(e._s(e.$t("operate.update")))]),a("let-table-operation",{staticClass:"danger",on:{click:function(a){return e.deleteServant(t.row.id)}}},[e._v(e._s(e.$t("operate.delete")))])]}}],null,!1,271550836)})],1):a("div",{ref:"servantModalLoading",staticClass:"loading-placeholder"})],1),a("let-modal",{attrs:{title:e.servantDetailModal.isNew?e.$t("operate.title.add")+" Servant":e.$t("operate.title.update")+" Servant",width:"800px",footShow:!!e.servantDetailModal.model},on:{"on-confirm":e.saveServantDetail,close:e.closeServantDetailModal,"on-cancel":e.closeServantDetailModal},model:{value:e.servantDetailModal.show,callback:function(t){e.$set(e.servantDetailModal,"show",t)},expression:"servantDetailModal.show"}},[e.servantDetailModal.model?a("let-form",{ref:"servantDetailForm",staticClass:"two-columns",attrs:{itemWidth:"360px",columns:2}},[a("let-form-item",{attrs:{label:e.$t("serverList.servant.appService"),itemWidth:"724px"}},[a("span",[e._v(e._s(e.servantDetailModal.model.application)+"·"+e._s(e.servantDetailModal.model.server_name))])]),a("let-form-item",{attrs:{label:e.$t("serverList.servant.objName"),required:""}},[a("let-input",{attrs:{size:"small",placeholder:e.$t("serverList.servant.c"),required:"",pattern:"^[A-Za-z]+$","pattern-tip":e.$t("serverList.servant.obj")},model:{value:e.servantDetailModal.model.obj_name,callback:function(t){e.$set(e.servantDetailModal.model,"obj_name",t)},expression:"servantDetailModal.model.obj_name"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.servant.numOfThread"),required:""}},[a("let-input",{attrs:{size:"small",placeholder:e.$t("serverList.servant.thread"),required:"",pattern:"^[1-9][0-9]*$","pattern-tip":e.$t("serverList.servant.thread")},model:{value:e.servantDetailModal.model.thread_num,callback:function(t){e.$set(e.servantDetailModal.model,"thread_num",t)},expression:"servantDetailModal.model.thread_num"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.table.servant.adress"),required:"",itemWidth:"724px"}},[a("let-input",{ref:"endpoint",attrs:{size:"small",placeholder:"tcp -h 127.0.0.1 -t 60000 -p 12000",required:"",extraTip:e.isEndpointValid?"":e.$t("serverList.servant.error")},model:{value:e.servantDetailModal.model.endpoint,callback:function(t){e.$set(e.servantDetailModal.model,"endpoint",t)},expression:"servantDetailModal.model.endpoint"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.servant.maxConnecttions"),labelWidth:"150px"}},[a("let-input",{attrs:{size:"small"},model:{value:e.servantDetailModal.model.max_connections,callback:function(t){e.$set(e.servantDetailModal.model,"max_connections",t)},expression:"servantDetailModal.model.max_connections"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.servant.lengthOfQueue"),labelWidth:"150px"}},[a("let-input",{attrs:{size:"small"},model:{value:e.servantDetailModal.model.queuecap,callback:function(t){e.$set(e.servantDetailModal.model,"queuecap",t)},expression:"servantDetailModal.model.queuecap"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.servant.queueTimeout"),labelWidth:"150px"}},[a("let-input",{attrs:{size:"small"},model:{value:e.servantDetailModal.model.queuetimeout,callback:function(t){e.$set(e.servantDetailModal.model,"queuetimeout",t)},expression:"servantDetailModal.model.queuetimeout"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.servant.allowIP")}},[a("let-input",{attrs:{size:"small"},model:{value:e.servantDetailModal.model.allow_ip,callback:function(t){e.$set(e.servantDetailModal.model,"allow_ip",t)},expression:"servantDetailModal.model.allow_ip"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.servant.protocol"),required:""}},[a("let-radio-group",{attrs:{size:"small",data:[{value:"tars",text:"TARS"},{value:"not_tars",text:e.$t("serverList.servant.notTARS")}]},model:{value:e.servantDetailModal.model.protocol,callback:function(t){e.$set(e.servantDetailModal.model,"protocol",t)},expression:"servantDetailModal.model.protocol"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.servant.treatmentGroup"),labelWidth:"150px"}},[a("let-input",{attrs:{size:"small"},model:{value:e.servantDetailModal.model.handlegroup,callback:function(t){e.$set(e.servantDetailModal.model,"handlegroup",t)},expression:"servantDetailModal.model.handlegroup"}})],1)],1):e._e()],1),a("let-modal",{staticClass:"more-cmd",attrs:{title:e.$t("operate.title.more"),width:"700px"},on:{"on-confirm":e.invokeMoreCmd,close:e.closeMoreCmdModal,"on-cancel":e.closeMoreCmdModal},model:{value:e.moreCmdModal.show,callback:function(t){e.$set(e.moreCmdModal,"show",t)},expression:"moreCmdModal.show"}},[e.moreCmdModal.model?a("let-form",{ref:"moreCmdForm"},[a("let-form-item",{attrs:{itemWidth:"100%"}},[a("let-radio",{attrs:{label:"setloglevel"},model:{value:e.moreCmdModal.model.selected,callback:function(t){e.$set(e.moreCmdModal.model,"selected",t)},expression:"moreCmdModal.model.selected"}},[e._v(e._s(e.$t("serverList.servant.logLevel")))]),a("let-select",{attrs:{size:"small",disabled:"setloglevel"!==e.moreCmdModal.model.selected},model:{value:e.moreCmdModal.model.setloglevel,callback:function(t){e.$set(e.moreCmdModal.model,"setloglevel",t)},expression:"moreCmdModal.model.setloglevel"}},e._l(e.logLevels,(function(t){return a("let-option",{key:t,attrs:{value:t}},[e._v(e._s(t))])})),1)],1),a("let-form-item",{attrs:{itemWidth:"100%"}},[a("let-radio",{attrs:{label:"loadconfig"},model:{value:e.moreCmdModal.model.selected,callback:function(t){e.$set(e.moreCmdModal.model,"selected",t)},expression:"moreCmdModal.model.selected"}},[e._v(e._s(e.$t("serverList.servant.pushFile")))]),a("let-select",{attrs:{size:"small",placeholder:e.moreCmdModal.model.configs&&e.moreCmdModal.model.configs.length?e.$t("pub.dlg.defaultValue"):e.$t("pub.dlg.noConfFile"),disabled:!(e.moreCmdModal.model.configs&&e.moreCmdModal.model.configs.length)||"loadconfig"!==e.moreCmdModal.model.selected,required:"loadconfig"===e.moreCmdModal.model.selected},model:{value:e.moreCmdModal.model.loadconfig,callback:function(t){e.$set(e.moreCmdModal.model,"loadconfig",t)},expression:"moreCmdModal.model.loadconfig"}},e._l(e.moreCmdModal.model.configs,(function(t){return a("let-option",{key:t.filename,attrs:{value:t.filename}},[e._v(e._s(t.filename))])})),1)],1),a("let-form-item",{attrs:{itemWidth:"100%"}},[a("let-radio",{attrs:{label:"command"},model:{value:e.moreCmdModal.model.selected,callback:function(t){e.$set(e.moreCmdModal.model,"selected",t)},expression:"moreCmdModal.model.selected"}},[e._v(e._s(e.$t("serverList.servant.sendCommand")))]),a("let-input",{attrs:{size:"small",disabled:"command"!==e.moreCmdModal.model.selected,required:"command"===e.moreCmdModal.model.selected},model:{value:e.moreCmdModal.model.command,callback:function(t){e.$set(e.moreCmdModal.model,"command",t)},expression:"moreCmdModal.model.command"}})],1),a("let-form-item",{attrs:{itemWidth:"100%"}},[a("let-radio",{attrs:{label:"connection"},model:{value:e.moreCmdModal.model.selected,callback:function(t){e.$set(e.moreCmdModal.model,"selected",t)},expression:"moreCmdModal.model.selected"}},[e._v(e._s(e.$t("serverList.servant.serviceLink")))])],1),"dcache"!==e.serverType?a("let-form-item",{attrs:{itemWidth:"100%"}},[a("let-radio",{staticClass:"danger",attrs:{label:"undeploy_tars"},model:{value:e.moreCmdModal.model.selected,callback:function(t){e.$set(e.moreCmdModal.model,"selected",t)},expression:"moreCmdModal.model.selected"}},[e._v(e._s(e.$t("operate.undeploy"))+" "+e._s(e.$t("common.service")))])],1):e._e()],1):e._e()],1)],1)}),q=[],z=(a("4de4"),a("7db0"),a("a15b"),a("d81d"),a("d3b7"),a("25f0"),a("498a"),a("15fd")),E=a("5530"),G=(a("96cf"),a("1da1")),V=a("bc3a"),W=a.n(V),F=a("4328"),U=a.n(F),J=W.a.create({baseURL:"/pages/server/api",timeout:25e3,transformRequest:[function(e,t){return"multipart/form-data"===t["Content-Type"]?e:"application/json"===t["Content-Type"]?JSON.stringify(e):U.a.stringify(e)}]});J.interceptors.request.use((function(e){return e}),(function(e){throw new Error(e)})),J.interceptors.response.use((function(e){var t=e.data;if(200===t.ret_code)return t.data;throw new Error(t.err_msg)}),(function(e){throw new Error(e)}));var Z=J;function B(e){var t=e.servers,a=e.appName,r=e.moduleName,o=e.status,s=void 0===o?"1":o,n=e.cache_version,l=e.srcGroupName,i=void 0===l?[]:l,c=e.dstGroupName,d=void 0===c?[]:c;return Z({method:"post",url:"/cache/expandModule",data:{appName:a,moduleName:r,servers:t,status:s,cache_version:n,srcGroupName:i,dstGroupName:d}})}function Y(e){var t=e.servers,a=e.appName,r=e.moduleName,o=e.cache_version,s=e.srcGroupName,n=e.dstGroupName,l=e.transferData;return Z({method:"post",url:"/cache/transferDCache",data:{servers:t,appName:a,moduleName:r,cache_version:o,srcGroupName:s,dstGroupName:n,transferData:l}})}function K(e){var t=e.appName,a=e.moduleName,r=e.srcGroupName,o=e.dstGroupName,s=e.transferData;return Z({method:"post",url:"/cache/transferDCacheGroup",data:{appName:t,moduleName:a,srcGroupName:r,dstGroupName:o,transferData:s},headers:{"Content-Type":"application/json"}})}function Q(e){var t=e.releaseId;return Z({method:"get",url:"/cache/getReleaseProgress",params:{releaseId:t}})}function H(e){var t=e.releaseId;return Z({method:"get",url:"/task",params:{task_no:t}})}function X(e){var t=e.type,a=void 0===t?"1":t;return Z({method:"get",url:"/cache/getRouterChange",params:{type:a}})}function ee(e){var t=e.appName,a=e.moduleName,r=e.type,o=e.srcGroupName;return Z({method:"get",url:"/cache/hasOperation",params:{appName:t,moduleName:a,type:r,srcGroupName:o}})}function te(e){var t=e.appName,a=void 0===t?"":t,r=e.moduleName,o=void 0===r?"":r,s=e.type,n=void 0===s?"1":s,l=e.srcGroupName,i=void 0===l?[]:l,c=e.dstGroupName,d=void 0===c?[]:c;return Z({method:"post",url:"/cache/stopTransfer",data:{appName:a,moduleName:o,type:n,srcGroupName:i,dstGroupName:d}})}function ae(e){var t=e.appName,a=void 0===t?"":t,r=e.moduleName,o=void 0===r?"":r,s=e.type,n=void 0===s?"1":s,l=e.srcGroupName,i=void 0===l?[]:l,c=e.dstGroupName,d=void 0===c?[]:c;return Z({method:"post",url:"/cache/restartTransfer",data:{appName:a,moduleName:o,type:n,srcGroupName:i,dstGroupName:d}})}function re(e){var t=e.appName,a=void 0===t?"":t,r=e.moduleName,o=void 0===r?"":r,s=e.type,n=void 0===s?"1":s,l=e.srcGroupName,i=void 0===l?[]:l,c=e.dstGroupName,d=void 0===c?[]:c;return Z({method:"post",url:"/cache/deleteTransfer",data:{appName:a,moduleName:o,type:n,srcGroupName:i,dstGroupName:d}})}function oe(e){var t=e.appName,a=void 0===t?"":t,r=e.moduleName,o=void 0===r?"":r,s=e.srcGroupName,n=void 0===s?[]:s;return Z({method:"post",url:"/cache/reduceDcache",data:{appName:a,moduleName:o,srcGroupName:n}})}function se(e){var t=e.appName,a=void 0===t?"":t,r=e.moduleName,o=void 0===r?"":r,s=e.groupName,n=void 0===s?"":s;return Z({method:"post",url:"/cache/switchServer",data:{appName:a,moduleName:o,groupName:n}})}function ne(e){var t=e.appName,a=void 0===t?"":t,r=e.moduleName,o=void 0===r?"":r,s=e.groupName,n=void 0===s?"":s;return Z({method:"get",url:"/cache/getSwitchInfo",params:{appName:a,moduleName:o,groupName:n}})}function le(e){var t=e.appName,a=e.moduleName,r=e.groupName,o=e.mirrorIdc,s=e.dbFlag,n=e.enableErase;return Z({method:"post",url:"/cache/recoverMirrorStatus",data:{appName:t,moduleName:a,groupName:r,mirrorIdc:o,dbFlag:s,enableErase:n}})}function ie(e){var t=e.unType,a=e.appName,r=e.moduleName,o=e.serverNames;return Z({method:"post",url:"/cache/uninstall4DCache",data:{unType:t,appName:a,moduleName:r,serverNames:o}})}function ce(e){var t=e.appName,a=e.moduleName;return Z({method:"get",url:"/cache/getCacheServerList",params:{appName:t,moduleName:a}})}function de(e){var t=e.appName,a=e.moduleName;return Z({method:"get",url:"/cache/getModuleConfig",params:{appName:t,moduleName:a}})}function ue(){return Z({method:"get",url:"/cache/getConfig"})}function me(e){var t=e.applyId;return Z({method:"get",url:"/cache/install_and_publish",params:{applyId:t}})}function pe(e){var t=e.thedate,a=e.predate,r=e.startshowtime,o=e.endshowtime,s=e.moduleName,n=e.serverName;return Z({method:"get",url:"/cache/queryProperptyData",params:{thedate:t,predate:a,startshowtime:r,endshowtime:o,moduleName:s,serverName:n}})}function he(e){var t=e.application,a=void 0===t?"DCache":t,r=e.moduleName,o=void 0===r?"DCacheServerGroup":r,s=e.currPage,n=void 0===s?1:s,l=e.pageSize,i=void 0===l?5:l,c=e.cacheVersion;return Z({method:"get",url:"/server_patch_list",params:{application:a,module_name:o,curr_page:n,page_size:i,package_type:c}})}function fe(e){var t=e.serial,a=void 0!==t&&t,r=e.items,o=void 0===r?[{server_id:"",command:"patch_tars",parameters:{patch_id:0,bak_flag:"",group_name:""}}]:r;return Z({method:"post",url:"/add_task",data:{serial:a,items:o},headers:{"Content-Type":"application/json"}})}function ve(e){var t=e.moduleId;return Z({method:"get",url:"/get_module_config_info",params:{moduleId:t}})}function ge(){return Z({method:"get",url:"/template_name_list",params:{}})}function _e(){return Z({method:"get",url:"/get_region_list"})}function be(e){var t=e.application,a=void 0===t?"":t,r=e.server_name,o=void 0===r?"":r,s=e.set,n=void 0===s?"":s,l=e.node_name,i=void 0===l?"":l,c=e.expand_nodes,d=void 0===c?[""]:c,u=e.enable_set,m=void 0!==u&&u,p=e.set_name,h=void 0===p?"":p,f=e.set_area,v=void 0===f?"":f,g=e.set_group,_=void 0===g?"":g,b=e.copy_node_config,$=void 0!==b&&b;return Z({method:"post",url:"/expand_server_preview",data:{application:a,server_name:o,set:n,node_name:i,expand_nodes:d,enable_set:m,set_name:h,set_area:v,set_group:_,copy_node_config:$},headers:{"Content-Type":"application/json"}})}function $e(e){var t=e.node_name;return Z({method:"get",url:"/auto_port",params:{node_name:t}})}function ye(e){var t=e.application,a=void 0===t?"":t,r=e.server_name,o=void 0===r?"":r,s=e.set,n=void 0===s?"":s,l=e.node_name,i=void 0===l?"":l,c=e.copy_node_config,d=void 0!==c&&c,u=e.expand_preview_servers,m=void 0===u?[{bind_ip:"",node_name:"",obj_name:"",port:"",set:""}]:u;return Z({method:"post",url:"/expand_server",data:{application:a,server_name:o,set:n,node_name:i,copy_node_config:d,expand_preview_servers:m},headers:{"Content-Type":"application/json"}})}var ke=function(){return{application:"DCache",server_name:"",set:"",node_name:"",expand_nodes:[],enable_set:!1,set_name:"",set_area:"",set_group:"",copy_node_config:!1}},we={name:"ServerManage",data:function(){return{serverType:this.$route.params.serverType||"tars",serverData:{level:5,application:"",server_name:"",set_name:"",set_area:"",set_group:""},serverList:[],serverNotifyList:[],pageNum:1,pageSize:20,total:1,serverTypes:["tars_cpp","tars_java","tars_php","tars_nodejs","not_tars","tars_go"],configModal:{show:!1,model:null},servantModal:{show:!1,model:null,currentServer:null},servantDetailModal:{show:!1,isNew:!0,model:null},logLevels:["NONE","DEBUG","INFO","WARN","ERROR"],moreCmdModal:{show:!1,model:null,currentServer:null},expandModal:{show:!1,model:ke(),expandIpStr:""},failCount:0}},computed:{showOthers:function(){return 5===this.serverData.level},isEndpointValid:function(){return!(!this.servantDetailModal.model||!this.servantDetailModal.model.endpoint)&&this.checkServantEndpoint(this.servantDetailModal.model.endpoint)}},watch:{$route:function(e,t){this.getServerList(),this.getServerNotifyList(1)}},methods:{getServerList:function(){var e=this,t=this.$refs.serverListLoading.$loading.show();this.$ajax.getJSON("/server/api/server_list",{tree_node_id:this.$route.params.treeid}).then(function(){var a=Object(G["a"])(regeneratorRuntime.mark((function a(r){var o,s,n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(t.hide(),e.serverList=r,"dcache"!==e.serverType){a.next=17;break}if(o=e.serverList.length,!(o>0)){a.next=6;break}return a.abrupt("return",!1);case 6:return a.prev=6,a.next=9,e.$ajax.postJSON("/server/api/cache/removeServer",{server_name:e.$route.params.treeid.split(".")[1].substr(1)});case 9:e.$parent.getTreeData(),a.next=15;break;case 12:a.prev=12,a.t0=a["catch"](6),console.error(a.t0);case 15:a.next=45;break;case 17:if("proxy"!==e.serverType){a.next=32;break}if(s=e.serverList.length,!(s>0)){a.next=21;break}return a.abrupt("return",!1);case 21:return a.prev=21,a.next=24,e.$ajax.postJSON("/server/api/cache/removeProxy",{server_name:e.$route.params.treeid.split(".")[1].substr(1)});case 24:e.$parent.getTreeData(),a.next=30;break;case 27:a.prev=27,a.t1=a["catch"](21),console.error(a.t1);case 30:a.next=45;break;case 32:if("router"!==e.serverType){a.next=45;break}if(n=e.serverList.length,!(n>0)){a.next=36;break}return a.abrupt("return",!1);case 36:return a.prev=36,a.next=39,e.$ajax.postJSON("/server/api/cache/removeRouter",{server_name:e.$route.params.treeid.split(".")[1].substr(1)});case 39:e.$parent.getTreeData(),a.next=45;break;case 42:a.prev=42,a.t2=a["catch"](36),console.error(a.t2);case 45:case"end":return a.stop()}}),a,null,[[6,12],[21,27],[36,42]])})));return function(e){return a.apply(this,arguments)}}()).catch((function(a){t.hide(),e.$confirm(a.err_msg||a.message||e.$t("serverList.msg.fail"),e.$t("common.alert")).then((function(){e.getServerList()}))}))},getServerNotifyList:function(e){var t=this;if(this.showOthers){var a=this.$refs.serverNotifyListLoading.$loading.show();this.$ajax.getJSON("/server/api/server_notify_list",{tree_node_id:this.$route.params.treeid,page_size:this.pageSize,curr_page:e}).then((function(r){a.hide(),t.pageNum=e,t.total=Math.ceil(r.count/t.pageSize),t.serverNotifyList=r.rows})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("serverList.restart.failed"),": ").concat(e.err_msg||e.message))}))}},gotoPage:function(e){this.getServerNotifyList(e)},getTemplateList:function(){var e=this;this.$ajax.getJSON("/server/api/template_name_list").then((function(t){e.configModal.model?e.configModal.model.templates=t:e.configModal.model={templates:t}})).catch((function(t){e.$tip.error("".concat(e.$t("serverList.restart.failed"),": ").concat(t.err_msg||t.message))}))},getServerConfig:function(e){var t=this,a=this.$loading.show({target:this.$refs.configFormLoading});this.$ajax.getJSON("/server/api/server",{id:e}).then((function(e){a.hide(),t.configModal.model?t.configModal.model=Object.assign({},t.configModal.model,e):(e.templates=[],t.configModal.model=e)})).catch((function(e){a.hide(),t.closeConfigModal(),t.$tip.error("".concat(t.$t("serverList.restart.failed"),": ").concat(e.err_msg||e.message))}))},configServer:function(e){this.configModal.show=!0,this.getTemplateList(),this.getServerConfig(e)},saveConfig:function(){var e=this;if(this.$refs.configForm.validate()){var t=this.$Loading.show();this.$ajax.postJSON("/server/api/update_server",Object(E["a"])({isBak:this.configModal.model.bak_flag},this.configModal.model)).then((function(a){t.hide(),e.serverList=e.serverList.map((function(e){return e.id===a.id?a:e})),e.closeConfigModal(),e.$tip.success(e.$t("serverList.restart.success"))})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("serverList.restart.failed"),": ").concat(a.message||a.err_msg))}))}},closeConfigModal:function(){this.$refs.configForm&&this.$refs.configForm.resetValid(),this.configModal.show=!1,this.configModal.model=null},checkTaskStatus:function(e,t){var a=this;return new Promise((function(r,o){a.$ajax.getJSON("/server/api/task",{task_no:e}).then((function(t){1===t.status||0===t.status?setTimeout((function(){r(a.checkTaskStatus(e))}),3e3):2===t.status?r("taskid: ".concat(t.task_no)):o(new Error("taskid: ".concat(t.task_no)))})).catch((function(s){t?o(new Error(s.err_msg||s.message||a.$t("common.networkErr"))):setTimeout((function(){r(a.checkTaskStatus(e,!0))}),3e3)}))}))},addTask:function(e,t,a){var r=this,o=this.$Loading.show();return this.$ajax.postJSON("/server/api/add_task",{serial:!0,items:[{server_id:e,command:t}]}).then((function(e){return r.checkTaskStatus(e).then((function(e){o.hide(),r.getServerList(),r.$tip.success({title:a.success,message:e})})).catch((function(e){throw e}))})).catch((function(e){o.hide(),r.getServerList(),r.$tip.error({title:a.error,message:e.err_msg||e.message||r.$t("common.networkErr")})}))},restartServer:function(e){this.addTask(e,"restart",{success:this.$t("serverList.restart.success"),error:this.$t("serverList.restart.failed")})},stopServer:function(e){var t=this;this.$confirm(this.$t("serverList.stopService.msg.stopService"),this.$t("common.alert")).then((function(){t.addTask(e,"stop",{success:t.$t("serverList.restart.success"),error:t.$t("serverList.restart.failed")})}))},undeployServer:function(e){var t=this;return Object(G["a"])(regeneratorRuntime.mark((function a(){var r,o;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:r=e.id,o=e.server_name,Object(z["a"])(e,["id","server_name"]),t.$confirm(t.$t("serverList.dlg.msg.undeploy"),t.$t("common.alert")).then(Object(G["a"])(regeneratorRuntime.mark((function e(){var a,s,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a=t.serverList,s=t.serverType,!(["proxy","router"].indexOf(s)>-1&&1===a.length)){e.next=15;break}return e.next=4,t.$ajax.getJSON("/server/api/cache/hasModule",{serverType:s,serverName:o});case 4:if(n=e.sent,!n){e.next=7;break}return e.abrupt("return",t.$tip.warning(t.$t("pub.dlg.hasModule")));case 7:return e.prev=7,e.next=10,t.$confirm(t.$t("pub.dlg.cantUseApply"));case 10:e.next=15;break;case 12:return e.prev=12,e.t0=e["catch"](7),e.abrupt("return",!1);case 15:return e.prev=15,e.next=18,t.addTask(r,"undeploy_tars",{success:t.$t("serverList.restart.success"),error:t.$t("serverList.restart.failed")});case 18:e.next=22;break;case 20:e.prev=20,e.t1=e["catch"](15);case 22:return e.prev=22,t.closeMoreCmdModal(),e.finish(22);case 25:case"end":return e.stop()}}),e,null,[[7,12],[15,20,22,25]])}))));case 2:case"end":return a.stop()}}),a)})))()},manageServant:function(e){var t=this;this.servantModal.show=!0;var a=this.$loading.show({target:this.$refs.servantModalLoading});this.$ajax.getJSON("/server/api/adapter_conf_list",{id:e.id}).then((function(r){a.hide(),t.servantModal.model=r,t.servantModal.currentServer=e})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("serverList.restart.failed"),": ").concat(e.err_msg||e.message))}))},closeServantModal:function(){this.servantModal.show=!1,this.servantModal.model=null,this.servantModal.currentServer=null},configServant:function(e){if(this.servantDetailModal.model={application:this.servantModal.currentServer.application,server_name:this.servantModal.currentServer.server_name,obj_name:"",node_name:"",endpoint:"",servant:"",thread_num:"",max_connections:"200000",queuecap:"10000",queuetimeout:"60000",allow_ip:"",protocol:"not_tars",handlegroup:""},this.servantDetailModal.isNew=!0,e){var t=this.servantModal.model.find((function(t){return t.id===e}));t.obj_name=t.servant.split(".")[2],this.servantDetailModal.model=Object.assign({},this.servantDetailModal.model,t),this.servantDetailModal.isNew=!1}this.servantDetailModal.show=!0},closeServantDetailModal:function(){this.$refs.servantDetailForm&&this.$refs.servantDetailForm.resetValid(),this.servantDetailModal.show=!1,this.servantDetailModal.model=null},checkServantEndpoint:function(e){var t=e.split(/\s-/),a=/^tcp|udp$/i,r=/^h\s(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/i,o=/^t\s([1-9]|[1-9]\d+)$/i,s=/^p\s\d{4,5}$/i,n=!0;if(a.test(t[0])){for(var l=0,i=1;i<t.length;i++)if(r&&r.test(t[i])&&(l++,this.servantDetailModal.model.node_name=t[i].split(/\s/)[1],r=null),o&&o.test(t[i])&&(l++,o=null),s&&s.test(t[i])){var c=t[i].substring(2);c<0||c>65535||l++,s=null}n=3===l}else n=!1;return n},saveServantDetail:function(){var e=this;if(this.$refs.servantDetailForm.validate()){var t=this.$Loading.show();if(this.servantDetailModal.isNew){var a=this.servantDetailModal.model;a.servant=[a.application,a.server_name,a.obj_name].join("."),this.$ajax.postJSON("/server/api/add_adapter_conf",a).then((function(a){t.hide(),e.servantModal.model.unshift(a),e.$tip.success(e.$t("common.success")),e.closeServantDetailModal()})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.err_msg||a.message))}))}else this.servantDetailModal.model.servant=this.servantDetailModal.model.application+"."+this.servantDetailModal.model.server_name+"."+this.servantDetailModal.model.obj_name,this.$ajax.postJSON("/server/api/update_adapter_conf",this.servantDetailModal.model).then((function(a){t.hide(),e.servantModal.model=e.servantModal.model.map((function(e){return e.id===a.id?a:e})),e.$tip.success(e.$t("common.success")),e.closeServantDetailModal()})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.err_msg||a.message))}))}},deleteServant:function(e){var t=this;this.$confirm(this.$t("serverList.servant.a"),this.$t("common.alert")).then((function(){var a=t.$Loading.show();t.$ajax.getJSON("/server/api/delete_adapter_conf",{id:e}).then((function(r){a.hide(),t.servantModal.model=t.servantModal.model.map((function(t){if(t.id!==e)return t})).filter((function(e){return e})),t.$tip.success(t.$t("common.success"))})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))}))}))},showMoreCmd:function(e){var t=this;this.moreCmdModal.model={selected:"setloglevel",setloglevel:"NONE",loadconfig:"",command:"",configs:null},this.moreCmdModal.unwatch=this.$watch("moreCmdModal.model.selected",(function(){t.$refs.moreCmdForm&&t.$refs.moreCmdForm.resetValid()})),this.moreCmdModal.show=!0,this.moreCmdModal.currentServer=e,this.$ajax.getJSON("/server/api/config_file_list",{level:5,application:e.application,server_name:e.server_name}).then((function(e){t.moreCmdModal.model&&(t.moreCmdModal.model.configs=e)})).catch((function(e){t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))}))},sendCommand:function(e,t,a){var r=this,o=this.$Loading.show();this.$ajax.getJSON("/server/api/send_command",{server_ids:e,command:t}).then((function(e){o.hide();var t=e[0].err_msg.replace(/\n/g,"<br>");if(0!==e[0].ret_code)throw new Error(t);var s={title:r.$t("common.success"),message:t};a&&(s.duration=0),r.$tip.success(s)})).catch((function(e){o.hide(),r.$tip.error({title:r.$t("common.error"),message:e.err_msg||e.message})}))},invokeMoreCmd:function(){var e=this.moreCmdModal.model,t=this.moreCmdModal.currentServer;"undeploy_tars"===e.selected?this.undeployServer(t):"setloglevel"===e.selected?this.sendCommand(t.id,"tars.setloglevel ".concat(e.setloglevel)):"loadconfig"===e.selected&&this.$refs.moreCmdForm.validate()?this.sendCommand(t.id,"tars.loadconfig ".concat(e.loadconfig)):"command"===e.selected&&this.$refs.moreCmdForm.validate()?this.sendCommand(t.id,e.command):"connection"===e.selected&&this.sendCommand(t.id,"tars.connection",!0)},closeMoreCmdModal:function(){this.$refs.moreCmdForm&&this.$refs.moreCmdForm.resetValid(),this.moreCmdModal.unwatch&&this.moreCmdModal.unwatch(),this.moreCmdModal.show=!1,this.moreCmdModal.model=null},handleNoPublishedTime:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.$t("pub.dlg.unpublished");return"0000:00:00 00:00:00"===e?t:e},openExpandModal:function(e){var t=e.server_name,a=e.node_name;this.expandModal.show=!0,this.expandModal.model.server_name=t,this.expandModal.model.node_name=a},expandService:function(){var e=this;return Object(G["a"])(regeneratorRuntime.mark((function t(){var a,r,o,s,n,l,i,c,d,u,m,p,h;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.$refs.expandForm.validate()){t.next=45;break}return a=Object.assign({},e.expandModal.model),a.expand_nodes=e.expandModal.expandIpStr.trim().split(/[,;\n]/),r=e.$Loading.show(),t.prev=4,t.next=7,be(a);case 7:if(o=t.sent,o){t.next=10;break}throw new Error(e.$t("serviceExpand.form.errTips.noneNodes"));case 10:return s=o.filter((function(t){return t.status===e.$t("serviceExpand.form.noExpand")})),n=[],l=[],s.forEach((function(e){l.push(e.bind_ip)})),t.next=16,$e({node_name:l.join(";")});case 16:return i=t.sent,i.forEach((function(t,a){e.$set(s[a],"port",String(t.port||""))})),s.forEach((function(e){n.push({bind_ip:e.bind_ip,node_name:e.node_name,obj_name:e.obj_name,port:e.port,set:e.set})})),c={application:a.application,server_name:a.server_name,set:a.set,node_name:a.node_name,copy_node_config:a.copy_node_config,expand_preview_servers:n},t.next=22,ye(c);case 22:return d=t.sent,u=d.server_conf,m={serial:!1,items:[]},p=e.serverType,h="","router"===p?h="RouterServer":"proxy"===p?h="ProxyServer":"dcache"===p&&(h="DCacheServerGroup"),u.forEach((function(e){m.items.push({server_id:e.id.toString(),command:"patch_tars",parameters:{patch_id:e.patch_version,bak_flag:e.bak_flag,update_text:"",group_name:h}})})),t.next=31,fe(m);case 31:t.sent,e.$tip.success(e.$t("serviceExpand.form.errTips.success")),e.closeExpandModal(),e.getServerList(),e.getServerNotifyList(1),t.next=42;break;case 38:t.prev=38,t.t0=t["catch"](4),console.error(t.t0),e.$tip.error(t.t0);case 42:return t.prev=42,r.hide(),t.finish(42);case 45:case"end":return t.stop()}}),t,null,[[4,38,42,45]])})))()},closeExpandModal:function(){this.$refs.expandForm&&this.$refs.expandForm.resetValid(),this.expandModal.show=!1,this.expandModal.model=ke(),this.expandModal.expandIpStr=""}},created:function(){this.serverData=this.$parent.getServerData(),window.manage=this},mounted:function(){this.getServerList(),this.getServerNotifyList(1)}},Me=we,xe=(a("a8af"),Object(k["a"])(Me,A,q,!1,null,null,null)),Se=xe.exports,Ce=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page_server_manage"},[e.serverList?a("let-table",{ref:"serverListLoading",attrs:{data:e.serverList,title:e.$t("serverList.title.serverList"),"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{scopedSlots:e._u([{key:"head",fn:function(t){return[a("let-checkbox",{attrs:{value:e.isCheckedAll,change:e.checkedAllChange},model:{value:e.isCheckedAll,callback:function(t){e.isCheckedAll=t},expression:"isCheckedAll"}})]}},{key:"default",fn:function(t){return[a("let-checkbox",{attrs:{value:t.row.id},model:{value:t.row.isChecked,callback:function(a){e.$set(t.row,"isChecked",a)},expression:"scope.row.isChecked"}})]}}],null,!1,2423312602)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.group"),prop:"group_name"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row.group_name;return[e._v(e._s(/.*?(\d+)$/.exec(a)[1]))]}}],null,!1,1174827465)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.service"),prop:"server_name"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.ip"),prop:"node_name",width:"125px"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.zb"),width:"45px"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row.server_type;return["M"===r?a("span",[e._v(e._s(e.$t("cache.mainEngine")))]):"S"===r?a("span",[e._v(e._s(e.$t("cache.standByEngine")))]):"I"===r?a("span",[e._v(e._s(e.$t("cache.mirror")))]):e._e()]}}],null,!1,888927167)}),a("let-table-column",{attrs:{title:e.$t("dcache.operationManage.routerPageNo"),prop:"routerPageNo",width:"65px"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.configStatus"),width:"65px"},scopedSlots:e._u([{key:"default",fn:function(e){return[a("span",{class:"active"===e.row.setting_state?"status-active":"status-off"})]}}],null,!1,3224184510)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.currStatus"),width:"65px"},scopedSlots:e._u([{key:"default",fn:function(e){return[a("span",{class:"active"===e.row.present_state?"status-active":"activating"===e.row.present_state?"status-activating":"status-off"})]}}],null,!1,4116932289)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.processID"),prop:"process_id",width:"65px"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.version"),prop:"patch_version",width:"45px"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.time")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticStyle:{"white-space":"nowrap"}},[e._v(e._s(e.handleNoPublishedTime(t.row.patch_time)))])]}}],null,!1,453975453)}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"260px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.configServer(t.row.id)}}},[e._v(e._s(e.$t("operate.update")))]),a("let-table-operation",{on:{click:function(a){return e.restartServer(t.row.id)}}},[e._v(e._s(e.$t("operate.restart")))]),a("let-table-operation",{staticClass:"danger",on:{click:function(a){return e.stopServer(t.row.id)}}},[e._v(e._s(e.$t("operate.stop"))+" ")]),a("let-table-operation",{on:{click:function(a){return e.manageServant(t.row)}}},[e._v(e._s(e.$t("operate.servant")))]),a("let-table-operation",{on:{click:function(a){return e.showMoreCmd(t.row)}}},[e._v(e._s(e.$t("operate.more")))])]}}],null,!1,2833555573)}),a("template",{slot:"operations"},[a("let-button",{attrs:{theme:"primary"},on:{click:e.expandHandler}},[e._v(e._s(e.$t("dcache.expand")))]),a("let-button",{attrs:{theme:"primary",disabled:!e.hasCheckedServer},on:{click:e.shrinkageHandler}},[e._v(e._s(e.$t("dcache.Shrinkage"))+" ")]),a("let-button",{attrs:{theme:"primary",disabled:!e.hasCheckedServer},on:{click:e.serverMigrationHandler}},[e._v(" "+e._s(e.$t("dcache.serverMigration"))+" ")]),e.serverList.length?a("non-server-migration",{attrs:{disabled:!e.hasCheckedServer,"expand-servers":e.serverList}}):e._e(),a("let-button",{attrs:{theme:"primary",disabled:!e.hasCheckedServer},on:{click:e.switchHandler}},[e._v(e._s(e.$t("dcache.switch"))+" ")]),a("offline",{attrs:{disabled:!e.hasCheckedServer,"server-list":e.serverList},on:{"success-fn":e.getServerList}}),a("batch-publish",{attrs:{disabled:!e.hasCheckedServer,"checked-servers":e.checkedServers},on:{"success-fn":e.getServerList}}),a("batch-operation",{attrs:{disabled:!e.hasCheckedServer,"checked-servers":e.checkedServers,type:"restart"},on:{"success-fn":e.getServerList}}),a("batch-operation",{attrs:{disabled:!e.hasCheckedServer,"checked-servers":e.checkedServers,type:"stop"},on:{"success-fn":e.getServerList}})],1)],2):e._e(),e.serverNotifyList&&e.showOthers?a("let-table",{ref:"serverNotifyListLoading",attrs:{data:e.serverNotifyList,title:e.$t("serverList.title.serverStatus"),"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("common.time"),prop:"notifytime"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.serviceID"),prop:"server_id"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.threadID"),prop:"thread_id"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.result"),prop:"result"}})],1):e._e(),a("let-modal",{attrs:{title:e.$t("serverList.dlg.title.editService"),width:"800px",footShow:!(!e.configModal.model||!e.configModal.model.server_name)},on:{"on-confirm":e.saveConfig,close:e.closeConfigModal,"on-cancel":e.closeConfigModal},model:{value:e.configModal.show,callback:function(t){e.$set(e.configModal,"show",t)},expression:"configModal.show"}},[e.configModal.model&&e.configModal.model.server_name?a("let-form",{ref:"configForm",staticClass:"two-columns",attrs:{itemWidth:"360px",columns:2}},[a("let-form-item",{attrs:{label:e.$t("common.service")}},[e._v(e._s(e.configModal.model.server_name))]),a("let-form-item",{attrs:{label:e.$t("common.ip")}},[e._v(e._s(e.configModal.model.node_name))]),a("let-form-item",{attrs:{label:e.$t("serverList.dlg.isBackup"),required:""}},[a("let-radio-group",{attrs:{size:"small",data:[{value:!0,text:e.$t("common.yes")},{value:!1,text:e.$t("common.no")}]},model:{value:e.configModal.model.bak_flag,callback:function(t){e.$set(e.configModal.model,"bak_flag",t)},expression:"configModal.model.bak_flag"}})],1),a("let-form-item",{attrs:{label:e.$t("common.template"),required:""}},[e.configModal.model.templates&&e.configModal.model.templates.length?a("let-select",{attrs:{size:"small",required:""},model:{value:e.configModal.model.template_name,callback:function(t){e.$set(e.configModal.model,"template_name",t)},expression:"configModal.model.template_name"}},e._l(e.configModal.model.templates,(function(t){return a("let-option",{key:t,attrs:{value:t}},[e._v(e._s(t))])})),1):a("span",[e._v(e._s(e.configModal.model.template_name))])],1),a("let-form-item",{attrs:{label:e.$t("serverList.dlg.serviceType"),required:""}},[a("let-select",{attrs:{size:"small",required:""},model:{value:e.configModal.model.server_type,callback:function(t){e.$set(e.configModal.model,"server_type",t)},expression:"configModal.model.server_type"}},e._l(e.serverTypes,(function(t){return a("let-option",{key:t,attrs:{value:t}},[e._v(e._s(t))])})),1)],1),a("let-form-item",{attrs:{label:e.$t("serverList.table.th.enableSet"),required:""}},[a("let-radio-group",{attrs:{size:"small",data:[{value:!0,text:e.$t("common.enable")},{value:!1,text:e.$t("common.disable")}]},model:{value:e.configModal.model.enable_set,callback:function(t){e.$set(e.configModal.model,"enable_set",t)},expression:"configModal.model.enable_set"}})],1),e.configModal.model.enable_set?a("let-form-item",{attrs:{label:e.$t("common.set.setName"),required:""}},[a("let-input",{attrs:{size:"small",placeholder:e.$t("serverList.dlg.errMsg.setName"),required:"",pattern:"^[a-z]+$","pattern-tip":e.$t("serverList.dlg.errMsg.setName")},model:{value:e.configModal.model.set_name,callback:function(t){e.$set(e.configModal.model,"set_name",t)},expression:"configModal.model.set_name"}})],1):e._e(),e.configModal.model.enable_set?a("let-form-item",{attrs:{label:e.$t("common.set.setArea"),required:""}},[a("let-input",{attrs:{size:"small",placeholder:e.$t("serverList.dlg.errMsg.setArea"),required:"",pattern:"^[a-z]+$","pattern-tip":e.$t("serverList.dlg.errMsg.setArea")},model:{value:e.configModal.model.set_area,callback:function(t){e.$set(e.configModal.model,"set_area",t)},expression:"configModal.model.set_area"}})],1):e._e(),e.configModal.model.enable_set?a("let-form-item",{attrs:{label:e.$t("common.set.setGroup"),required:""}},[a("let-input",{attrs:{size:"small",placeholder:e.$t("serverList.dlg.errMsg.setGroup"),required:"",pattern:"^[0-9\\*]+$","pattern-tip":e.$t("serverList.dlg.errMsg.setGroup")},model:{value:e.configModal.model.set_group,callback:function(t){e.$set(e.configModal.model,"set_group",t)},expression:"configModal.model.set_group"}})],1):e._e(),a("let-form-item",{attrs:{label:e.$t("serverList.dlg.asyncThread"),required:""}},[a("let-input",{attrs:{size:"small",placeholder:e.$t("serverList.dlg.placeholder.thread"),required:"",pattern:"tars_nodejs"===e.configModal.model.server_type?"^[1-9][0-9]*$":"^([3-9]|[1-9][0-9]+)$","pattern-tip":"$t('serverList.dlg.placeholder.thread')"},model:{value:e.configModal.model.async_thread_num,callback:function(t){e.$set(e.configModal.model,"async_thread_num",t)},expression:"configModal.model.async_thread_num"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.dlg.defaultPath")}},[a("let-input",{attrs:{size:"small"},model:{value:e.configModal.model.base_path,callback:function(t){e.$set(e.configModal.model,"base_path",t)},expression:"configModal.model.base_path"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.dlg.exePath")}},[a("let-input",{attrs:{size:"small"},model:{value:e.configModal.model.exe_path,callback:function(t){e.$set(e.configModal.model,"exe_path",t)},expression:"configModal.model.exe_path"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.dlg.startScript")}},[a("let-input",{attrs:{size:"small"},model:{value:e.configModal.model.start_script_path,callback:function(t){e.$set(e.configModal.model,"start_script_path",t)},expression:"configModal.model.start_script_path"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.dlg.stopScript")}},[a("let-input",{attrs:{size:"small"},model:{value:e.configModal.model.stop_script_path,callback:function(t){e.$set(e.configModal.model,"stop_script_path",t)},expression:"configModal.model.stop_script_path"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.dlg.monitorScript"),itemWidth:"724px"}},[a("let-input",{attrs:{size:"small"},model:{value:e.configModal.model.monitor_script_path,callback:function(t){e.$set(e.configModal.model,"monitor_script_path",t)},expression:"configModal.model.monitor_script_path"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.dlg.privateTemplate"),labelWidth:"150px",itemWidth:"724px"}},[a("let-input",{attrs:{size:"large",type:"textarea",rows:4},model:{value:e.configModal.model.profile,callback:function(t){e.$set(e.configModal.model,"profile",t)},expression:"configModal.model.profile"}})],1)],1):a("div",{ref:"configFormLoading",staticClass:"loading-placeholder"})],1),a("let-modal",{attrs:{title:e.$t("serverList.table.servant.title"),width:"1200px",footShow:!1},on:{close:e.closeServantModal},model:{value:e.servantModal.show,callback:function(t){e.$set(e.servantModal,"show",t)},expression:"servantModal.show"}},[a("let-button",{staticClass:"tbm16",attrs:{size:"small",theme:"primary"},on:{click:function(t){return e.configServant()}}},[e._v(e._s(e.$t("operate.add"))+" Servant ")]),e.servantModal.model?a("let-table",{attrs:{data:e.servantModal.model,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("operate.servant"),prop:"servant"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.servant.adress"),prop:"endpoint"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.servant.thread"),prop:"thread_num"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.servant.maxConnecttions"),prop:"max_connections"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.servant.maxQueue"),prop:"queuecap"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.servant.timeout"),prop:"queuetimeout"}}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"90px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.configServant(t.row.id)}}},[e._v(e._s(e.$t("operate.update")))]),a("let-table-operation",{staticClass:"danger",on:{click:function(a){return e.deleteServant(t.row.id)}}},[e._v(e._s(e.$t("operate.delete"))+" ")])]}}],null,!1,291375903)})],1):a("div",{ref:"servantModalLoading",staticClass:"loading-placeholder"})],1),a("let-modal",{attrs:{title:e.servantDetailModal.isNew?e.$t("operate.title.add")+" Servant":e.$t("operate.title.update")+" Servant",width:"800px",footShow:!!e.servantDetailModal.model},on:{"on-confirm":e.saveServantDetail,close:e.closeServantDetailModal,"on-cancel":e.closeServantDetailModal},model:{value:e.servantDetailModal.show,callback:function(t){e.$set(e.servantDetailModal,"show",t)},expression:"servantDetailModal.show"}},[e.servantDetailModal.model?a("let-form",{ref:"servantDetailForm",staticClass:"two-columns",attrs:{itemWidth:"360px",columns:2}},[a("let-form-item",{attrs:{label:e.$t("serverList.servant.appService"),itemWidth:"724px"}},[a("span",[e._v(e._s(e.servantDetailModal.model.application)+"·"+e._s(e.servantDetailModal.model.server_name))])]),a("let-form-item",{attrs:{label:e.$t("serverList.servant.objName"),required:""}},[a("let-input",{attrs:{size:"small",placeholder:e.$t("serverList.servant.c"),required:"",pattern:"^[A-Za-z]+$","pattern-tip":e.$t("serverList.servant.obj")},model:{value:e.servantDetailModal.model.obj_name,callback:function(t){e.$set(e.servantDetailModal.model,"obj_name",t)},expression:"servantDetailModal.model.obj_name"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.servant.numOfThread"),required:""}},[a("let-input",{attrs:{size:"small",placeholder:e.$t("serverList.servant.thread"),required:"",pattern:"^[1-9][0-9]*$","pattern-tip":e.$t("serverList.servant.thread")},model:{value:e.servantDetailModal.model.thread_num,callback:function(t){e.$set(e.servantDetailModal.model,"thread_num",t)},expression:"servantDetailModal.model.thread_num"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.table.servant.adress"),required:"",itemWidth:"724px"}},[a("let-input",{ref:"endpoint",attrs:{size:"small",placeholder:"tcp -h 127.0.0.1 -t 60000 -p 12000",required:"",extraTip:e.isEndpointValid?"":e.$t("serverList.servant.error")},model:{value:e.servantDetailModal.model.endpoint,callback:function(t){e.$set(e.servantDetailModal.model,"endpoint",t)},expression:"servantDetailModal.model.endpoint"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.servant.maxConnecttions"),labelWidth:"150px"}},[a("let-input",{attrs:{size:"small"},model:{value:e.servantDetailModal.model.max_connections,callback:function(t){e.$set(e.servantDetailModal.model,"max_connections",t)},expression:"servantDetailModal.model.max_connections"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.servant.lengthOfQueue"),labelWidth:"150px"}},[a("let-input",{attrs:{size:"small"},model:{value:e.servantDetailModal.model.queuecap,callback:function(t){e.$set(e.servantDetailModal.model,"queuecap",t)},expression:"servantDetailModal.model.queuecap"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.servant.queueTimeout"),labelWidth:"150px"}},[a("let-input",{attrs:{size:"small"},model:{value:e.servantDetailModal.model.queuetimeout,callback:function(t){e.$set(e.servantDetailModal.model,"queuetimeout",t)},expression:"servantDetailModal.model.queuetimeout"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.servant.allowIP")}},[a("let-input",{attrs:{size:"small"},model:{value:e.servantDetailModal.model.allow_ip,callback:function(t){e.$set(e.servantDetailModal.model,"allow_ip",t)},expression:"servantDetailModal.model.allow_ip"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.servant.protocol"),required:""}},[a("let-radio-group",{attrs:{size:"small",data:[{value:"tars",text:"TARS"},{value:"not_tars",text:e.$t("serverList.servant.notTARS")}]},model:{value:e.servantDetailModal.model.protocol,callback:function(t){e.$set(e.servantDetailModal.model,"protocol",t)},expression:"servantDetailModal.model.protocol"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.servant.treatmentGroup"),labelWidth:"150px"}},[a("let-input",{attrs:{size:"small"},model:{value:e.servantDetailModal.model.handlegroup,callback:function(t){e.$set(e.servantDetailModal.model,"handlegroup",t)},expression:"servantDetailModal.model.handlegroup"}})],1)],1):e._e()],1),a("let-modal",{staticClass:"more-cmd",attrs:{title:e.$t("operate.title.more"),width:"700px"},on:{"on-confirm":e.invokeMoreCmd,close:e.closeMoreCmdModal,"on-cancel":e.closeMoreCmdModal},model:{value:e.moreCmdModal.show,callback:function(t){e.$set(e.moreCmdModal,"show",t)},expression:"moreCmdModal.show"}},[e.moreCmdModal.model?a("let-form",{ref:"moreCmdForm"},[a("let-form-item",{attrs:{itemWidth:"100%"}},[a("let-radio",{attrs:{label:"setloglevel"},model:{value:e.moreCmdModal.model.selected,callback:function(t){e.$set(e.moreCmdModal.model,"selected",t)},expression:"moreCmdModal.model.selected"}},[e._v(e._s(e.$t("serverList.servant.logLevel"))+" ")]),a("let-select",{attrs:{size:"small",disabled:"setloglevel"!==e.moreCmdModal.model.selected},model:{value:e.moreCmdModal.model.setloglevel,callback:function(t){e.$set(e.moreCmdModal.model,"setloglevel",t)},expression:"moreCmdModal.model.setloglevel"}},e._l(e.logLevels,(function(t){return a("let-option",{key:t,attrs:{value:t}},[e._v(e._s(t))])})),1)],1),a("let-form-item",{attrs:{itemWidth:"100%"}},[a("let-radio",{attrs:{label:"loadconfig"},model:{value:e.moreCmdModal.model.selected,callback:function(t){e.$set(e.moreCmdModal.model,"selected",t)},expression:"moreCmdModal.model.selected"}},[e._v(e._s(e.$t("serverList.servant.pushFile"))+" ")]),a("let-select",{attrs:{size:"small",placeholder:e.moreCmdModal.model.configs&&e.moreCmdModal.model.configs.length?e.$t("pub.dlg.defaultValue"):e.$t("pub.dlg.noConfFile"),disabled:!(e.moreCmdModal.model.configs&&e.moreCmdModal.model.configs.length)||"loadconfig"!==e.moreCmdModal.model.selected,required:"loadconfig"===e.moreCmdModal.model.selected},model:{value:e.moreCmdModal.model.loadconfig,callback:function(t){e.$set(e.moreCmdModal.model,"loadconfig",t)},expression:"moreCmdModal.model.loadconfig"}},e._l(e.moreCmdModal.model.configs,(function(t){return a("let-option",{key:t.filename,attrs:{value:t.filename}},[e._v(e._s(t.filename)+" ")])})),1)],1),a("let-form-item",{attrs:{itemWidth:"100%"}},[a("let-radio",{attrs:{label:"command"},model:{value:e.moreCmdModal.model.selected,callback:function(t){e.$set(e.moreCmdModal.model,"selected",t)},expression:"moreCmdModal.model.selected"}},[e._v(e._s(e.$t("serverList.servant.sendCommand"))+" ")]),a("let-input",{attrs:{size:"small",disabled:"command"!==e.moreCmdModal.model.selected,required:"command"===e.moreCmdModal.model.selected},model:{value:e.moreCmdModal.model.command,callback:function(t){e.$set(e.moreCmdModal.model,"command",t)},expression:"moreCmdModal.model.command"}})],1),a("let-form-item",{attrs:{itemWidth:"100%"}},[a("let-radio",{attrs:{label:"connection"},model:{value:e.moreCmdModal.model.selected,callback:function(t){e.$set(e.moreCmdModal.model,"selected",t)},expression:"moreCmdModal.model.selected"}},[e._v(e._s(e.$t("serverList.servant.serviceLink"))+" ")])],1)],1):e._e()],1),a("let-modal",{attrs:{footShow:!1,closeOnClickBackdrop:!1,width:"1000px",title:e.$t("dcache.expand")},model:{value:e.expandShow,callback:function(t){e.expandShow=t},expression:"expandShow"}},[e.expandShow?a("Expand",{attrs:{"expand-servers":e.lastGroupServers},on:{close:e.expandCloseHandler}}):e._e()],1),a("let-modal",{attrs:{footShow:!1,closeOnClickBackdrop:!1,width:"1000px",title:e.$t("dcache.serverMigration")},model:{value:e.serverMigrationShow,callback:function(t){e.serverMigrationShow=t},expression:"serverMigrationShow"}},[e.serverMigrationShow?a("server-migration",{attrs:{"check-src-group-name":e.checkSrcGroupName,"expand-servers":e.lastGroupServers},on:{close:e.serverMigrationCloseHandler}}):e._e()],1)],1)},Ne=[],Le=(a("a630"),a("6062"),a("3ca3"),a("ddb0"),a("2ef0")),De=a.n(Le),Oe=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"container"},[a("let-form",{ref:"detailForm",attrs:{inline:""}},[a("let-form-group",{attrs:{inline:"","label-position":"top"}},[a("let-table",{ref:"table",attrs:{data:e.servers,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("module.name"),prop:"module_name"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.module_name)+" ")]}}])}),a("let-table-column",{attrs:{title:e.$t("module.serverGroup"),prop:"group_name"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.group_name)+" ")]}}])}),a("let-table-column",{attrs:{title:e.$t("service.serverName"),prop:"server_name"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.server_name)+" ")]}}])}),a("let-table-column",{attrs:{title:e.$t("service.serverIp"),prop:"server_ip"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-input",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:t.row.server_ip,callback:function(a){e.$set(t.row,"server_ip",a)},expression:"scope.row.server_ip"}})]}}])}),a("let-table-column",{attrs:{title:e.$t("module.deployArea"),prop:"area",width:"80px"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.area)+" ")]}}])}),a("let-table-column",{attrs:{title:e.$t("deployService.form.serviceType"),width:"80px"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row.server_type;return["M"===r?a("span",[e._v(e._s(e.$t("cache.mainEngine")))]):"S"===r?a("span",[e._v(e._s(e.$t("cache.standByEngine")))]):"I"===r?a("span",[e._v(e._s(e.$t("cache.mirror")))]):e._e()]}}])}),a("let-table-column",{attrs:{title:e.$t("module.memorySize"),prop:"memory"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.memory)+" ")]}}])}),a("let-table-column",{attrs:{title:e.$t("module.shmKey"),prop:"shmKey"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-input",{attrs:{size:"small",placeholder:e.$t("module.shmKeyRule"),required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:t.row.shmKey,callback:function(a){e.$set(t.row,"shmKey",a)},expression:"scope.row.shmKey"}})]}}])})],1)],1),a("div",[a("let-button",{attrs:{size:"small",theme:"primary"},on:{click:e.submitServerConfig}},[e._v(e._s(e.$t("common.submit")))]),a("div",{staticClass:"alignRight"},[a("let-button",{attrs:{size:"small",theme:"primary"},on:{click:e.addNewGroup}},[e._v(e._s(e.$t("serviceExpand.newGroup")))]),a("let-button",{attrs:{size:"small",theme:"danger",disabled:this.servers.length===this.expandServers.length},on:{click:e.deleteGroup}},[e._v(e._s(e.$t("serviceExpand.removeGroup")))])],1)],1)],1)],1)},Ie=[],Te=(a("fb6a"),a("a434"),{data:function(){return{servers:[],transferData:!0,migrationMethods:[{value:!0,text:this.$t("dcache.migrationMethod1")},{value:!1,text:this.$t("dcache.migrationMethod2")}]}},props:{expandServers:{required:!0,type:Array}},computed:{appName:function(){return this.expandServers[0].app_name},moduleName:function(){return this.expandServers[0].module_name},cache_version:function(){return this.expandServers[0].cache_version},srcGroupName:function(){return this.expandServers[0].group_name},dstGroupName:function(){return this.servers[0].group_name}},methods:{getServers:function(){this.servers=this.newGroup(this.expandServers)},addNewGroup:function(){var e=this.servers;this.servers=e.concat(this.newGroup(e.slice(e.length-this.expandServers.length)))},deleteGroup:function(){this.servers.splice(this.servers.length-this.expandServers.length,this.expandServers.length)},newGroup:function(e){return e.map((function(e,t){var a=e.group_name,r=e.server_name;a=a.replace(/^(.*?)(\d+)$/,(function(){return arguments[1]+(+arguments[2]+1)})),r=r.replace(/^(.*?)(\d+)-\d+$/,(function(){return arguments[1]+(+arguments[2]+1)+"-"+(t+1)}));var o=e.server_type;return Object(E["a"])({},e,{group_name:a,server_name:r,server_ip:"",shmKey:"",server_type:o})}))}}}),Re={mixins:[Te],data:function(){return{}},methods:{submitServerConfig:function(){var e=this;return Object(G["a"])(regeneratorRuntime.mark((function t(){var a,r,o,s,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.$refs.detailForm.validate()){t.next=15;break}return a=e.servers,r=e.appName,o=e.moduleName,s=e.cache_version,e.dstGroupName,t.prev=2,t.next=5,B({servers:a,appName:r,moduleName:o,cache_version:s,srcGroupName:[]});case 5:n=t.sent,n.releaseId,e.$tip.success(e.$t("dcache.operationManage.hasExpand")),e.$emit("close"),t.next=15;break;case 11:t.prev=11,t.t0=t["catch"](2),console.error(t.t0),e.$tip.error(t.t0.message);case 15:case"end":return t.stop()}}),t,null,[[2,11]])})))()}},created:function(){this.getServers()}},je=Re,Pe=(a("f3e0"),Object(k["a"])(je,Oe,Ie,!1,null,null,null)),Ae=Pe.exports,qe=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"container"},[a("let-form",{ref:"detailForm",attrs:{inline:""}},[a("let-form-item",{attrs:{required:"",label:e.$t("dcache.migrationMethod")}},[a("let-radio-group",{attrs:{data:e.migrationMethods},model:{value:e.transferData,callback:function(t){e.transferData=t},expression:"transferData"}})],1),a("let-form-group",{attrs:{inline:"","label-position":"top"}},[a("let-table",{ref:"table",attrs:{data:e.servers,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("module.name"),prop:"module_name"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.module_name)+" ")]}}])}),a("let-table-column",{attrs:{title:e.$t("module.serverGroup"),prop:"group_name"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.group_name)+" ")]}}])}),a("let-table-column",{attrs:{title:e.$t("service.serverName"),prop:"server_name"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.server_name)+" ")]}}])}),a("let-table-column",{attrs:{title:e.$t("service.serverIp"),prop:"server_ip"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-input",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:t.row.server_ip,callback:function(a){e.$set(t.row,"server_ip",a)},expression:"scope.row.server_ip"}})]}}])}),a("let-table-column",{attrs:{title:e.$t("module.deployArea"),prop:"area"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.area)+" ")]}}])}),a("let-table-column",{attrs:{title:e.$t("deployService.form.serviceType"),width:"80px"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row.server_type;return["M"===r?a("span",[e._v(e._s(e.$t("cache.mainEngine")))]):"S"===r?a("span",[e._v(e._s(e.$t("cache.standByEngine")))]):"I"===r?a("span",[e._v(e._s(e.$t("cache.mirror")))]):e._e()]}}])}),a("let-table-column",{attrs:{title:e.$t("module.memorySize"),prop:"memory"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.memory)+" ")]}}])}),a("let-table-column",{attrs:{title:e.$t("module.shmKey"),prop:"shmKey"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-input",{attrs:{size:"small",placeholder:e.$t("module.shmKeyRule"),required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:t.row.shmKey,callback:function(a){e.$set(t.row,"shmKey",a)},expression:"scope.row.shmKey"}})]}}])})],1)],1),a("div",[a("let-button",{attrs:{size:"small",theme:"primary"},on:{click:e.submitServerConfig}},[e._v(e._s(e.$t("common.submit")))])],1)],1)],1)},ze=[],Ee={mixins:[Te],props:{checkSrcGroupName:{required:!0,type:String}},data:function(){return{}},methods:{submitServerConfig:function(){var e=this;return Object(G["a"])(regeneratorRuntime.mark((function t(){var a,r,o,s,n,l,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.$refs.detailForm.validate()){t.next=13;break}return a=e.servers,r=e.appName,o=e.moduleName,s=e.cache_version,n=e.dstGroupName,l=e.transferData,i=e.checkSrcGroupName,t.prev=2,t.next=5,Y({servers:a,appName:r,moduleName:o,cache_version:s,srcGroupName:i,dstGroupName:n,transferData:l});case 5:e.$tip.success(e.$t("dcache.operationManage.hasServerMigration")),e.$emit("close"),t.next=13;break;case 9:t.prev=9,t.t0=t["catch"](2),console.error(t.t0),e.$tip.error(t.t0.message);case 13:case"end":return t.stop()}}),t,null,[[2,9]])})))()}},created:function(){this.getServers()}},Ge=Ee,Ve=Object(k["a"])(Ge,qe,ze,!1,null,null,null),We=Ve.exports,Fe=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticStyle:{display:"inline"}},[a("let-button",{attrs:{theme:"primary",disabled:e.disabled},on:{click:e.init}},[e._v(e._s(e.$t("dcache.nonServerMigration")))]),a("let-modal",{attrs:{footShow:!1,closeOnClickBackdrop:!0,width:"1000px",title:e.$t("dcache.nonServerMigration")},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[e.show?a("let-form",{ref:"detailForm",staticClass:"non-server-migration",attrs:{labelPosition:"right"}},[a("let-form-item",{attrs:{required:"",label:e.$t("dcache.operationManage.appName")+"："}},[e._v(" "+e._s(e.appName)+" ")]),a("let-form-item",{attrs:{required:"",label:e.$t("dcache.operationManage.moduleName")+"："}},[e._v(" "+e._s(e.moduleName)+" ")]),a("let-form-item",{attrs:{required:"",label:e.$t("dcache.operationManage.srcGroupName")+"："}},[e._v(" "+e._s(e.srcGroupName)+" ")]),a("let-form-item",{attrs:{itemWidth:"100%",required:"",label:e.$t("dcache.operationManage.dstGroupName")+"："}},[a("let-select",{attrs:{required:"",size:"small"},model:{value:e.groupName,callback:function(t){e.groupName=t},expression:"groupName"}},e._l(e.dstGroupNames,(function(t){return a("let-option",{key:t,attrs:{value:t}},[e._v(e._s(t))])})),1)],1),a("let-form-item",{attrs:{required:"",label:e.$t("dcache.migrationMethod")+"："}},[a("let-radio-group",{staticStyle:{width:"300px"},attrs:{data:e.migrationMethods},model:{value:e.transferData,callback:function(t){e.transferData=t},expression:"transferData"}})],1),a("div",[a("let-button",{attrs:{size:"small",theme:"primary"},on:{click:e.submitServerConfig}},[e._v(e._s(e.$t("common.submit")))])],1)],1):e._e()],1)],1)},Ue=[],Je={mixins:[Te],props:{disabled:Boolean,expandServers:{required:!1,type:Array}},data:function(){return{show:!1,groupName:"",dstGroupNames:[]}},computed:{srcGroupName:function(){var e=this.expandServers.find((function(e){return e.isChecked}));return e.group_name}},methods:{init:function(){var e=this;return Object(G["a"])(regeneratorRuntime.mark((function t(){var a,r,o,s,n,l,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,e.groupName="",a=e.expandServers.map((function(e){return e.group_name})),a=Array.from(new Set(a)),1!==a.length){t.next=6;break}return t.abrupt("return",e.$tip.error(e.$t("dcache.onlyOneServiceGroup")));case 6:if(r=e.expandServers.filter((function(e){return e.isChecked})),o=r.map((function(e){return e.group_name})),o=Array.from(new Set(o)),!(o.length>1)){t.next=11;break}return t.abrupt("return",e.$tip.error(e.$t("dcache.oneGroup")));case 11:return e.dstGroupNames=a.filter((function(e){return e!==o[0]})),s=e.appName,n=e.moduleName,l=e.srcGroupName,t.next=15,ee({appName:s,moduleName:n,srcGroupName:l});case 15:if(i=t.sent,!i){t.next=18;break}throw new Error(e.$t("dcache.hasMigrationOperation"));case 18:e.show=!0,t.next=25;break;case 21:t.prev=21,t.t0=t["catch"](0),console.error(t.t0),e.$tip.error(t.t0.message);case 25:case"end":return t.stop()}}),t,null,[[0,21]])})))()},submitServerConfig:function(){var e=this;return Object(G["a"])(regeneratorRuntime.mark((function t(){var a,r,o,s,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.$refs.detailForm.validate()){t.next=13;break}return t.prev=1,a=e.appName,r=e.moduleName,o=e.srcGroupName,s=e.groupName,n=e.transferData,t.next=5,K({appName:a,moduleName:r,srcGroupName:o,dstGroupName:s,transferData:n});case 5:t.sent,e.$tip.success(e.$t("dcache.operationManage.hasnonServerMigration")),t.next=13;break;case 9:t.prev=9,t.t0=t["catch"](1),console.error(t.t0),e.$tip.error(t.t0.message);case 13:case"end":return t.stop()}}),t,null,[[1,9]])})))()}}},Ze=Je,Be=(a("8c1c"),Object(k["a"])(Ze,Fe,Ue,!1,null,null,null)),Ye=Be.exports,Ke=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"batch-publish",staticStyle:{display:"inline"}},[a("let-button",{attrs:{theme:"primary",disabled:e.disabled},on:{click:e.init}},[e._v(e._s(e.$t("dcache.batchPublish")))]),a("let-modal",{attrs:{footShow:!1,closeOnClickBackdrop:!0,width:"1000px",title:e.$t("dcache.batchPublish")},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[a("let-form",[a("let-form-item",{attrs:{label:e.$t("service.serverName")}},e._l(e.checkedServers,(function(t){return a("p",[e._v(e._s(t.server_name))])})),0)],1),a("let-table",{attrs:{data:e.versionList,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-radio",{attrs:{label:t.row.id},model:{value:e.publishId,callback:function(t){e.publishId=t},expression:"publishId"}})]}}])}),a("let-table-column",{attrs:{title:"ID",prop:"id"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.id)+" "),a("span",{staticStyle:{color:"green",display:"inline-block",width:"1em",height:"1em"},attrs:{title:e.$t("releasePackage.default")}},[1==t.row.default_version?a("icon",{attrs:{name:"default"}}):e._e()],1)]}}])}),a("let-table-column",{attrs:{title:e.$t("releasePackage.moduleName"),prop:"server"}}),a("let-table-column",{attrs:{title:e.$t("releasePackage.cacheType")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(1===t.row.package_type?"KVcache":"MKVcache"))])]}}])}),a("let-table-column",{attrs:{title:e.$t("serverList.servant.comment"),prop:"comment"}}),a("let-table-column",{attrs:{title:e.$t("releasePackage.uploadTime"),prop:"posttime"}}),a("let-pagination",{attrs:{slot:"pagination",align:"right",total:e.publishModal.totalPatchPage,page:e.publishModal.currPage},on:{change:e.patchChangePage},slot:"pagination"},[e._v(" abc ")]),a("template",{slot:"operations"},[a("let-button",{attrs:{disabled:!e.publishId,theme:"primary"},on:{click:e.publish}},[e._v(e._s(e.$t("apply.publish")))])],1)],2)],1),a("let-modal",{attrs:{footShow:!1,closeOnClickBackdrop:!0,width:"1000px",title:e.$t("dcache.batchPublish")},model:{value:e.releaseIng,callback:function(t){e.releaseIng=t},expression:"releaseIng"}},[e.releaseId&&e.releaseIng?a("tars-release-progress",{attrs:{"release-id":e.releaseId},on:{"close-fn":this.getServerList}}):e._e()],1)],1)},Qe=[],He=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"progressTable"},[a("let-table",{ref:"ProgressTable",attrs:{data:e.items,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("service.serverName"),prop:"server_name",width:"30%"}}),a("let-table-column",{attrs:{title:e.$t("service.serverIp"),prop:"node_name",width:"30%"}}),a("let-table-column",{attrs:{title:e.$t("common.status")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-tag",{attrs:{theme:2==t.row.status?"success":3==t.row.status?"danger":"",checked:""}},[e._v(" "+e._s(e.statusConfig[t.row.status]+(2!=t.row.status&&3!=t.row.status?"...":""))+" ")])]}}])})],1),a("p",{ref:"progressTip"},[e._v(e._s(e.$t(e.success?"dcache.executeSuccess":"dcache.execute")))])],1)},Xe=[],et=(a("caad"),a("a9e3"),{props:{releaseId:{type:[Number,String],required:!0}},data:function(){return{items:[],timer:"",progressTip:"",success:!1,statusConfig:{0:this.$t("serverList.restart.notStart"),1:this.$t("serverList.restart.running"),2:this.$t("serverList.restart.success"),3:this.$t("serverList.restart.failed"),4:this.$t("serverList.restart.cancel"),5:this.$t("serverList.restart.parial")}}},methods:{getProgress:function(){var e=this;return Object(G["a"])(regeneratorRuntime.mark((function t(){var a,r,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,H({releaseId:e.releaseId});case 3:a=t.sent,r=a.items,a.serial,a.status,a.task_no,e.items=r,o=!0,r.forEach((function(e){return[2,3].includes(e.status)?"":o=!1})),o?(e.timer&&window.clearTimeout(e.timer),e.success=!0,e.$emit("done-fn")):e.timer=window.setTimeout(e.getProgress,1e3),t.next=19;break;case 14:t.prev=14,t.t0=t["catch"](0),e.success=!0,console.error(t.t0),e.$tip.error(t.t0.message);case 19:case"end":return t.stop()}}),t,null,[[0,14]])})))()}},created:function(){this.getProgress()},destroyed:function(){this.timer&&window.clearTimeout(this.timer),this.$emit("close-fn")}}),tt=et,at=(a("018f"),Object(k["a"])(tt,He,Xe,!1,null,"2dd804f4",null)),rt=at.exports,ot={components:{tarsReleaseProgress:rt},mixins:[Te],props:{disabled:Boolean,expandServers:{required:!1,type:Array},checkedServers:{required:!1,type:Array}},computed:{cacheVersion:function(){return this.checkedServers.length?this.checkedServers[0].cache_version:1}},data:function(){return{versionList:[],releaseId:null,show:!1,publishId:null,publishModal:{moduleName:"DCacheServerGroup",application:"DCache",totalPatchPage:0,pageSize:5,currPage:1},releaseIng:!1}},methods:{init:function(){this.show=!0,this.releaseId=null,this.releaseIng=!1,this.publishId=null,this.getVersionList()},patchChangePage:function(e){this.publishModal.currPage=e,this.getVersionList()},getVersionList:function(){var e=this;return Object(G["a"])(regeneratorRuntime.mark((function t(){var a,r,o,s,n,l,i,c,d;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.cacheVersion,r=e.publishModal,o=r.moduleName,s=r.application,n=r.currPage,l=r.pageSize,t.next=4,he({moduleName:o,application:s,currPage:n,pageSize:l,cacheVersion:a});case 4:i=t.sent,c=i.count,d=i.rows,e.publishModal.totalPatchPage=Math.ceil(c/l),e.versionList=d;case 9:case"end":return t.stop()}}),t)})))()},publish:function(){var e=this;return Object(G["a"])(regeneratorRuntime.mark((function t(){var a,r,o,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=[],r=e.publishId,o=e.checkedServers,o.forEach((function(e){a.push({server_id:e.id.toString(),command:"patch_tars",parameters:{patch_id:r,bak_flag:e.bak_flag,update_text:"batch publish cache servers",group_name:"DCacheServerGroup"}})})),console.log(a),t.next=6,fe({items:a});case 6:s=t.sent,e.releaseIng=!0,e.releaseId=s;case 9:case"end":return t.stop()}}),t)})))()},getServerList:function(){this.show=!1,this.$emit("success-fn")}}},st=ot,nt=(a("ddc1"),Object(k["a"])(st,Ke,Qe,!1,null,null,null)),lt=nt.exports,it=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"batch-publish",staticStyle:{display:"inline"}},[a("let-button",{attrs:{theme:"primary",disabled:e.disabled},on:{click:e.init}},[e._v(e._s(e.$t("dcache.batch."+e.type)))]),a("let-modal",{attrs:{closeOnClickBackdrop:!0,width:"1000px",title:e.$t("dcache.batch."+e.type)},on:{"on-confirm":e.confirm},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[a("let-form",[a("let-form-item",{attrs:{label:e.$t("service.serverName")}},e._l(e.checkedServers,(function(t){return a("p",[e._v(e._s(t.server_name))])})),0)],1)],1),a("let-modal",{attrs:{footShow:!1,closeOnClickBackdrop:!0,width:"1000px",title:e.$t("dcache.batch."+e.type)},model:{value:e.releaseIng,callback:function(t){e.releaseIng=t},expression:"releaseIng"}},[e.releaseId&&e.releaseIng?a("tars-release-progress",{attrs:{"release-id":e.releaseId},on:{"close-fn":this.getServerList}}):e._e()],1)],1)},ct=[],dt={components:{tarsReleaseProgress:rt},mixins:[Te],props:{disabled:Boolean,expandServers:{required:!1,type:Array},checkedServers:{required:!1,type:Array},type:String},data:function(){return{versionList:[],releaseId:null,show:!1,publishModal:{moduleName:"DCacheServerGroup",application:"DCache",totalPatchPage:0,pageSize:5,currPage:1},releaseIng:!1}},methods:{init:function(){this.show=!0,this.releaseId=null,this.releaseIng=!1},confirm:function(){var e=this;return Object(G["a"])(regeneratorRuntime.mark((function t(){var a,r,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=[],r=e.checkedServers,r.forEach((function(t){a.push({server_id:t.id.toString(),command:e.type})})),t.next=5,fe({items:a});case 5:o=t.sent,e.releaseIng=!0,e.releaseId=o;case 8:case"end":return t.stop()}}),t)})))()},getServerList:function(){this.show=!1,this.$emit("success-fn")}}},ut=dt,mt=Object(k["a"])(ut,it,ct,!1,null,null,null),pt=mt.exports,ht=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticStyle:{display:"inline"}},[a("let-button",{attrs:{theme:"primary",disabled:e.disabled},on:{click:e.init}},[e._v(e._s(e.$t("dcache.offline")))]),a("let-modal",{attrs:{footShow:!1,closeOnClickBackdrop:!0,width:"1000px",title:e.$t("dcache.offline")},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[a("p",{staticStyle:{color:"red"}},[e._v(e._s(e.hasRouterPageNo?e.$t("dcache.hasRouterPageNo"):"")+e._s(e.canOffline?"":e.$t("dcache.cantOffline")))]),a("let-table",{ref:"table",attrs:{data:e.offlineServers,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("module.name"),prop:"module_name"}}),a("let-table-column",{attrs:{title:e.$t("service.serverName"),prop:"server_name"}}),a("let-table-column",{attrs:{title:e.$t("service.serverIp"),prop:"node_name"}}),a("let-table-column",{attrs:{title:e.$t("dcache.operationManage.routerPageNo"),prop:"routerPageNo"}})],1),a("let-button",{attrs:{disabled:!e.canOffline,size:"small",theme:"primary"},on:{click:e.sureOffline}},[e._v(" "+e._s(e.$t("dcache.sureOffline"))+" ")])],1)],1)},ft=[],vt={props:{disabled:Boolean,serverList:Array},data:function(){return{show:!1,offlineServers:[],tip:"",unType:0,canOffline:!1}},computed:{checkedServers:function(){return this.serverList.filter((function(e){return!0===e.isChecked}))},hasRouterPageNo:function(){return!!this.checkedServers.find((function(e){return 0!==e.routerPageNo}))},appName:function(){return this.checkedServers[0]&&this.checkedServers[0].app_name},moduleName:function(){return this.checkedServers[0]&&this.checkedServers[0].module_name},hostServers:function(){return this.checkedServers.filter((function(e){return"M"===e.server_type}))},backupServers:function(){return this.checkedServers.filter((function(e){return"S"===e.server_type}))},allBackupServers:function(){return this.serverList.filter((function(e){return"S"===e.server_type}))},mirrorServers:function(){return this.checkedServers.filter((function(e){return"I"===e.server_type}))},allMirrorServers:function(){return this.serverList.filter((function(e){return"I"===e.server_type}))},allBackupMirrorServers:function(){return this.serverList.filter((function(e){return"M"!==e.server_type}))}},methods:{init:function(){var e=this;return Object(G["a"])(regeneratorRuntime.mark((function t(){var a,r,o,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,e.offlineServers=[],e.unType=0,e.canOffline=!1,e.$t,e.hostServers,e.backupServers,e.allBackupServers,e.mirrorServers,e.allMirrorServers,e.allBackupMirrorServers,a=e.appName,r=e.moduleName,t.next=7,ee({appName:a,moduleName:r});case 7:if(o=t.sent,!o){t.next=10;break}throw new Error(e.$t("dcache.hasMigrationOperation"));case 10:e.offlineServers=e.checkedServers,s=e.getActiveServers(),s.length||(e.canOffline=!0),e.show=!0,t.next=20;break;case 16:t.prev=16,t.t0=t["catch"](0),console.error(t.t0),e.$tip.error(t.t0.message);case 20:case"end":return t.stop()}}),t,null,[[0,16]])})))()},getActiveServers:function(){return this.offlineServers.filter((function(e){return"active"===e.present_state||"active"===e.setting_state}))},sureOffline:function(){var e=this;return Object(G["a"])(regeneratorRuntime.mark((function t(){var a,r,o,s,n,l,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.offlineServers,r=e.unType,o=a.map((function(e){return"DCache.".concat(e.server_name)})),s=a[0].app_name,n=a[0].module_name,l={unType:r,appName:s,moduleName:n,serverNames:o},i=e.$Loading({text:"loading..."}),i.show(),t.prev=7,t.next=10,ie(l);case 10:t.sent,e.$tip.success("下线成功!"),e.show=!1,e.$emit("success-fn"),t.next=19;break;case 16:t.prev=16,t.t0=t["catch"](7),e.$tip.error(t.t0.message);case 19:return t.prev=19,i.hide(),t.finish(19);case 22:case"end":return t.stop()}}),t,null,[[7,16,19,22]])})))()}}},gt=vt,_t=Object(k["a"])(gt,ht,ft,!1,null,null,null),bt=_t.exports,$t={components:{Expand:Ae,ServerMigration:We,nonServerMigration:Ye,offline:bt,batchPublish:lt,batchOperation:pt},name:"ServerManage",data:function(){return{expandShow:!1,serverMigrationShow:!1,nonServerMigrationShow:!1,lastGroupServers:[],isCheckedAll:!1,serverData:{level:5,application:"",server_name:"",set_name:"",set_area:"",set_group:""},serverList:[],serverNotifyList:[],pageNum:1,pageSize:20,total:1,serverTypes:["tars_cpp","tars_java","tars_php","tars_nodejs","not_tars","tars_go"],configModal:{show:!1,model:null},servantModal:{show:!1,model:null,currentServer:null},servantDetailModal:{show:!1,isNew:!0,model:null},logLevels:["NONE","DEBUG","INFO","WARN","ERROR"],moreCmdModal:{show:!1,model:null,currentServer:null},failCount:0}},computed:{showOthers:function(){return 5===this.serverData.level},isEndpointValid:function(){return!(!this.servantDetailModal.model||!this.servantDetailModal.model.endpoint)&&this.checkServantEndpoint(this.servantDetailModal.model.endpoint)},hasCheckedServer:function(){return 0!==this.serverList.filter((function(e){return!0===e.isChecked})).length},checkedServers:function(){return this.serverList.filter((function(e){return!0===e.isChecked}))},checkSrcGroupName:function(){return this.checkedServers[0]&&this.checkedServers[0].group_name}},watch:{isCheckedAll:function(){var e=this.isCheckedAll;this.serverList.forEach((function(t){t.isChecked=e}))},$route:function(e,t){this.getServerList(),this.getServerNotifyList(1)}},methods:{expandCloseHandler:function(){this.expandShow=!1,this.getServerList()},serverMigrationCloseHandler:function(){this.serverMigrationShow=!1,this.getServerList()},expandHandler:function(){var e=this;return Object(G["a"])(regeneratorRuntime.mark((function t(){var a,r,o,s,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,a=e.checkPatchVersion(),a){t.next=4;break}throw new Error(e.$t("dcache.noTheSamePatchVersion"));case 4:return r=e.serverList[0],o=r.app_name,s=r.module_name,t.next=8,ee({appName:o,moduleName:s});case 8:if(n=t.sent,!n){t.next=11;break}throw new Error(e.$t("dcache.hasExpandOperation"));case 11:e.lastGroupServers=e.getLastGroupServers(),e.expandShow=!0,t.next=19;break;case 15:t.prev=15,t.t0=t["catch"](0),console.error(t.t0),e.$tip.error(t.t0.message);case 19:case"end":return t.stop()}}),t,null,[[0,15]])})))()},shrinkageHandler:function(){var e=this;return Object(G["a"])(regeneratorRuntime.mark((function t(){var a,r,o,s,n,l,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,a=e.serverList[0],r=a.app_name,o=a.module_name,t.next=5,ee({appName:r,moduleName:o});case 5:if(s=t.sent,!s){t.next=8;break}throw new Error(e.$t("dcache.hasShrinkageOperation"));case 8:if(n=e.serverList.map((function(e){return e.group_name})),n=Array.from(new Set(n)),l=e.serverList.filter((function(e){return e.isChecked})),i=l.map((function(e){return e.group_name})),i=Array.from(new Set(i)),n.toString()!==i.toString()){t.next=15;break}throw new Error(e.$t("dcache.leaveOneServiceGroup"));case 15:return t.next=17,e.$confirm(e.$t("dcache.operationManage.ensureShrinkage"));case 17:return t.next=19,oe({appName:r,moduleName:o,srcGroupName:i});case 19:e.$tip.success(e.$t("dcache.operationManage.hasShrinkage")),t.next=26;break;case 22:t.prev=22,t.t0=t["catch"](0),console.error(t.t0),e.$tip.error(t.t0.message);case 26:case"end":return t.stop()}}),t,null,[[0,22]])})))()},serverMigrationHandler:function(){var e=this;return Object(G["a"])(regeneratorRuntime.mark((function t(){var a,r,o,s,n,l,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,a=e.checkPatchVersion(),a){t.next=4;break}throw new Error(e.$t("dcache.noTheSamePatchVersion"));case 4:if(r=De.a.uniqBy(e.checkedServers,"group_name"),!(r.length>1)){t.next=7;break}throw new Error(e.$t("dcache.oneGroup"));case 7:return o=e.checkedServers[0],s=o.app_name,n=o.module_name,l=o.group_name,t.next=11,ee({appName:s,moduleName:n,srcGroupName:l});case 11:if(i=t.sent,!i){t.next=14;break}throw new Error(e.$t("dcache.hasMigrationOperation"));case 14:e.lastGroupServers=e.getLastGroupServers(),e.serverMigrationShow=!0,t.next=22;break;case 18:t.prev=18,t.t0=t["catch"](0),console.error(t.t0),e.$tip.error(t.t0.message);case 22:case"end":return t.stop()}}),t,null,[[0,18]])})))()},switchHandler:function(){var e=this;return Object(G["a"])(regeneratorRuntime.mark((function t(){var a,r,o,s,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,a=e.serverList[0],r=a.app_name,o=a.module_name,s=e.serverList.filter((function(e){return e.isChecked})),n=s.map((function(e){return e.group_name})),n=Array.from(new Set(n)),1==n.length){t.next=8;break}throw new Error(e.$t("dcache.operationManage.onceSwitch"));case 8:return t.next=10,e.$confirm(e.$t("dcache.operationManage.ensureSwitch"));case 10:return t.next=12,se({appName:r,moduleName:o,groupName:n[0]});case 12:e.$tip.success(e.$t("dcache.operationManage.switchSuccess")),e.getServerList(),t.next=20;break;case 16:t.prev=16,t.t0=t["catch"](0),console.error(t.t0),e.$tip.error(t.t0.message);case 20:case"end":return t.stop()}}),t,null,[[0,16]])})))()},getLastGroupServers:function(){var e=this.serverList.sort((function(e,t){return e.group_name>t.group_name}))[this.serverList.length-1].group_name;return this.serverList.filter((function(t){return t.group_name===e}))},checkPatchVersion:function(){var e=!0,t={};return this.serverList.forEach((function(a,r){var o=a.patch_version;if(0===r)return t[o]=o;t[o]||(e=!1)})),e},checkedAllChange:function(){console.log(arguments)},getServerList:function(){var e=this;return Object(G["a"])(regeneratorRuntime.mark((function t(){var a,r,o,s,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.$refs.serverListLoading.$loading.show(),t.prev=1,r=e.serverData,o=r.application,s=r.module_name,t.next=5,ce({appName:o,moduleName:s});case 5:n=t.sent,n.forEach((function(t){var a=e.serverList.find((function(e){return e.id===t.id}));t.isChecked=!!a&&a.isChecked})),e.serverList=n,t.next=14;break;case 10:t.prev=10,t.t0=t["catch"](1),console.error(t.t0),e.$tip.error(t.t0.message);case 14:return t.prev=14,a.hide(),t.finish(14);case 17:case"end":return t.stop()}}),t,null,[[1,10,14,17]])})))()},getServerNotifyList:function(e){var t=this;if(this.showOthers){var a=this.$refs.serverNotifyListLoading.$loading.show();this.$ajax.getJSON("/server/api/server_notify_list",{tree_node_id:this.$route.params.treeid,page_size:this.pageSize,curr_page:e}).then((function(r){a.hide(),t.pageNum=e,t.total=Math.ceil(r.count/t.pageSize),t.serverNotifyList=r.rows})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("serverList.restart.failed"),": ").concat(e.err_msg||e.message))}))}},getTemplateList:function(){var e=this;this.$ajax.getJSON("/server/api/template_name_list").then((function(t){e.configModal.model?e.configModal.model.templates=t:e.configModal.model={templates:t}})).catch((function(t){e.$tip.error("".concat(e.$t("serverList.restart.failed"),": ").concat(t.err_msg||t.message))}))},getServerConfig:function(e){var t=this,a=this.$loading.show({target:this.$refs.configFormLoading});this.$ajax.getJSON("/server/api/server",{id:e}).then((function(e){a.hide(),t.configModal.model?t.configModal.model=Object.assign({},t.configModal.model,e):(e.templates=[],t.configModal.model=e)})).catch((function(e){a.hide(),t.closeConfigModal(),t.$tip.error("".concat(t.$t("serverList.restart.failed"),": ").concat(e.err_msg||e.message))}))},configServer:function(e){this.configModal.show=!0,this.getTemplateList(),this.getServerConfig(e)},saveConfig:function(){var e=this;if(this.$refs.configForm.validate()){var t=this.$Loading.show();this.$ajax.postJSON("/server/api/update_server",Object(E["a"])({isBak:this.configModal.model.bak_flag},this.configModal.model)).then((function(a){t.hide(),e.serverList=e.serverList.map((function(e){return e.id===a.id?a:e})),e.closeConfigModal(),e.$tip.success(e.$t("serverList.restart.success"))})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("serverList.restart.failed"),": ").concat(a.message||a.err_msg))}))}},closeConfigModal:function(){this.$refs.configForm&&this.$refs.configForm.resetValid(),this.configModal.show=!1,this.configModal.model=null},checkTaskStatus:function(e,t){var a=this;return new Promise((function(r,o){a.$ajax.getJSON("/server/api/task",{task_no:e}).then((function(t){1===t.status||0===t.status?setTimeout((function(){r(a.checkTaskStatus(e))}),3e3):2===t.status?r("taskid: ".concat(t.task_no)):o(new Error("taskid: ".concat(t.task_no)))})).catch((function(s){t?o(new Error(s.err_msg||s.message||a.$t("common.networkErr"))):setTimeout((function(){r(a.checkTaskStatus(e,!0))}),3e3)}))}))},addTask:function(e,t,a){var r=this,o=this.$Loading.show();this.$ajax.postJSON("/server/api/add_task",{serial:!0,items:[{server_id:e,command:t}]}).then((function(e){return r.checkTaskStatus(e).then((function(e){o.hide(),r.getServerList(),r.$tip.success({title:a.success,message:e})})).catch((function(e){throw e}))})).catch((function(e){o.hide(),r.getServerList(),r.$tip.error({title:a.error,message:e.err_msg||e.message||r.$t("common.networkErr")})}))},restartServer:function(e){this.addTask(e,"restart",{success:this.$t("serverList.restart.success"),error:this.$t("serverList.restart.failed")})},stopServer:function(e){var t=this;this.$confirm(this.$t("serverList.stopService.msg.stopService"),this.$t("common.alert")).then((function(){t.addTask(e,"stop",{success:t.$t("serverList.restart.success"),error:t.$t("serverList.restart.failed")})}))},undeployServer:function(e){var t=this;this.$confirm(this.$t("serverList.dlg.msg.undeploy"),this.$t("common.alert")).then((function(){t.addTask(e,"undeploy_tars",{success:t.$t("serverList.restart.success"),error:t.$t("serverList.restart.failed")}),t.closeMoreCmdModal()}))},manageServant:function(e){var t=this;this.servantModal.show=!0;var a=this.$loading.show({target:this.$refs.servantModalLoading});this.$ajax.getJSON("/server/api/adapter_conf_list",{id:e.id}).then((function(r){a.hide(),t.servantModal.model=r,t.servantModal.currentServer=e})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("serverList.restart.failed"),": ").concat(e.err_msg||e.message))}))},closeServantModal:function(){this.servantModal.show=!1,this.servantModal.model=null,this.servantModal.currentServer=null},configServant:function(e){if(this.servantDetailModal.model={application:this.servantModal.currentServer.application,server_name:this.servantModal.currentServer.server_name,obj_name:"",node_name:"",endpoint:"",servant:"",thread_num:"",max_connections:"200000",queuecap:"10000",queuetimeout:"60000",allow_ip:"",protocol:"not_tars",handlegroup:""},this.servantDetailModal.isNew=!0,e){var t=this.servantModal.model.find((function(t){return t.id===e}));t.obj_name=t.servant.split(".")[2],this.servantDetailModal.model=Object.assign({},this.servantDetailModal.model,t),this.servantDetailModal.isNew=!1}this.servantDetailModal.show=!0},closeServantDetailModal:function(){this.$refs.servantDetailForm&&this.$refs.servantDetailForm.resetValid(),this.servantDetailModal.show=!1,this.servantDetailModal.model=null},checkServantEndpoint:function(e){var t=e.split(/\s-/),a=/^tcp|udp$/i,r=/^h\s(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/i,o=/^t\s([1-9]|[1-9]\d+)$/i,s=/^p\s\d{4,5}$/i,n=!0;if(a.test(t[0])){for(var l=0,i=1;i<t.length;i++)if(r&&r.test(t[i])&&(l++,this.servantDetailModal.model.node_name=t[i].split(/\s/)[1],r=null),o&&o.test(t[i])&&(l++,o=null),s&&s.test(t[i])){var c=t[i].substring(2);c<0||c>65535||l++,s=null}n=3===l}else n=!1;return n},saveServantDetail:function(){var e=this;if(this.$refs.servantDetailForm.validate()){var t=this.$Loading.show();if(this.servantDetailModal.isNew){var a=this.servantDetailModal.model;a.servant=[a.application,a.server_name,a.obj_name].join("."),this.$ajax.postJSON("/server/api/add_adapter_conf",a).then((function(a){t.hide(),e.servantModal.model.unshift(a),e.$tip.success(e.$t("common.success")),e.closeServantDetailModal()})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.err_msg||a.message))}))}else this.servantDetailModal.model.servant=this.servantDetailModal.model.application+"."+this.servantDetailModal.model.server_name+"."+this.servantDetailModal.model.obj_name,this.$ajax.postJSON("/server/api/update_adapter_conf",this.servantDetailModal.model).then((function(a){t.hide(),e.servantModal.model=e.servantModal.model.map((function(e){return e.id===a.id?a:e})),e.$tip.success(e.$t("common.success")),e.closeServantDetailModal()})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.err_msg||a.message))}))}},deleteServant:function(e){var t=this;this.$confirm(this.$t("serverList.servant.a"),this.$t("common.alert")).then((function(){var a=t.$Loading.show();t.$ajax.getJSON("/server/api/delete_adapter_conf",{id:e}).then((function(r){a.hide(),t.servantModal.model=t.servantModal.model.map((function(t){if(t.id!==e)return t})).filter((function(e){return e})),t.$tip.success(t.$t("common.success"))})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))}))}))},showMoreCmd:function(e){var t=this;this.moreCmdModal.model={selected:"setloglevel",setloglevel:"NONE",loadconfig:"",command:"",configs:null},this.moreCmdModal.unwatch=this.$watch("moreCmdModal.model.selected",(function(){t.$refs.moreCmdForm&&t.$refs.moreCmdForm.resetValid()})),this.moreCmdModal.show=!0,this.moreCmdModal.currentServer=e,this.$ajax.getJSON("/server/api/config_file_list",{level:5,application:e.application,server_name:e.server_name}).then((function(e){t.moreCmdModal.model&&(t.moreCmdModal.model.configs=e)})).catch((function(e){t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))}))},sendCommand:function(e,t,a){var r=this,o=this.$Loading.show();this.$ajax.getJSON("/server/api/send_command",{server_ids:e,command:t}).then((function(e){o.hide();var t=e[0].err_msg.replace(/\n/g,"<br>");if(0!==e[0].ret_code)throw new Error(t);var s={title:r.$t("common.success"),message:t};a&&(s.duration=0),r.$tip.success(s)})).catch((function(e){o.hide(),r.$tip.error({title:r.$t("common.error"),message:e.err_msg||e.message})}))},invokeMoreCmd:function(){var e=this.moreCmdModal.model,t=this.moreCmdModal.currentServer;"undeploy_tars"===e.selected?this.undeployServer(t.id):"setloglevel"===e.selected?this.sendCommand(t.id,"tars.setloglevel ".concat(e.setloglevel)):"loadconfig"===e.selected&&this.$refs.moreCmdForm.validate()?this.sendCommand(t.id,"tars.loadconfig ".concat(e.loadconfig)):"command"===e.selected&&this.$refs.moreCmdForm.validate()?this.sendCommand(t.id,e.command):"connection"===e.selected&&this.sendCommand(t.id,"tars.connection",!0)},closeMoreCmdModal:function(){this.$refs.moreCmdForm&&this.$refs.moreCmdForm.resetValid(),this.moreCmdModal.unwatch&&this.moreCmdModal.unwatch(),this.moreCmdModal.show=!1,this.moreCmdModal.model=null},handleNoPublishedTime:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.$t("pub.dlg.unpublished");return"0000:00:00 00:00:00"===e?t:e}},created:function(){this.serverData=this.$parent.getServerData()},mounted:function(){this.getServerList(),this.getServerNotifyList(1)}},yt=$t,kt=(a("eee6"),Object(k["a"])(yt,Ce,Ne,!1,null,null,null)),wt=kt.exports,Mt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page_server_property_monitor"},[a("let-form",{attrs:{inline:"",itemWidth:"200px"},nativeOn:{submit:function(t){return t.preventDefault(),e.search(t)}}},[a("let-form-group",[a("let-form-item",{attrs:{label:e.$t("monitor.search.a")}},[a("let-date-picker",{attrs:{size:"small",formatter:e.formatter},model:{value:e.query.thedate,callback:function(t){e.$set(e.query,"thedate",t)},expression:"query.thedate"}})],1),a("let-form-item",{attrs:{label:e.$t("monitor.search.b")}},[a("let-date-picker",{attrs:{size:"small",formatter:e.formatter},model:{value:e.query.predate,callback:function(t){e.$set(e.query,"predate",t)},expression:"query.predate"}})],1),a("let-form-item",{attrs:{label:e.$t("monitor.search.start")}},[a("let-input",{attrs:{size:"small"},model:{value:e.query.startshowtime,callback:function(t){e.$set(e.query,"startshowtime",t)},expression:"query.startshowtime"}})],1),a("let-form-item",{attrs:{label:e.$t("monitor.search.end")}},[a("let-input",{attrs:{size:"small"},model:{value:e.query.endshowtime,callback:function(t){e.$set(e.query,"endshowtime",t)},expression:"query.endshowtime"}})],1)],1),a("let-form-group",[a("tars-form-item",{attrs:{label:e.$t("module.name")},on:{onLabelClick:function(t){return e.groupBy("moduleName")}}},[a("let-input",{attrs:{size:"small"},model:{value:e.query.moduleName,callback:function(t){e.$set(e.query,"moduleName",t)},expression:"query.moduleName"}})],1),a("tars-form-item",{attrs:{label:e.$t("service.serverName")},on:{onLabelClick:function(t){return e.groupBy("serverName")}}},[a("let-input",{attrs:{size:"small"},model:{value:e.query.serverName,callback:function(t){e.$set(e.query,"serverName",t)},expression:"query.serverName"}})],1),a("let-form-item",[a("let-button",{attrs:{size:"small",type:"submit",theme:"primary"}},[e._v(e._s(e.$t("operate.search")))])],1)],1)],1),e.showChart?a("let-row",{ref:"charts",staticClass:"charts"},e._l(e.charts,(function(t){return a("let-col",{key:t.title,attrs:{span:12}},[e.allItems.length>0?a("compare-chart",e._b({},"compare-chart",t,!1)):e._e()],1)})),1):e._e(),a("hours-filter",{model:{value:e.hour,callback:function(t){e.hour=t},expression:"hour"}}),a("div",{staticStyle:{width:"1200px","overflow-x":"auto","padding-bottom":"20px"}},[a("let-table",{ref:"table",attrs:{data:e.pagedItems,"empty-msg":e.$t("common.nodata"),stripe:""}},[a("let-table-column",{attrs:{title:e.$t("common.time"),prop:"show_time",width:"80px"}}),a("let-table-column",{attrs:{title:e.$t("module.name"),prop:"moduleName",width:""}}),a("let-table-column",{attrs:{title:e.$t("service.serverName"),prop:"serverName",width:"150px"}}),e._l(e.keys,(function(t){return[a("let-table-column",{attrs:{title:e.$t("monitor.table.curr")+" "+t,prop:"the_"+t}}),a("let-table-column",{attrs:{title:e.$t("monitor.table.contrast")+" "+t,prop:"pre_"+t}})]})),e.pageCount?a("let-pagination",{attrs:{slot:"pagination",total:e.pageCount,page:e.page,sum:e.itemsCount,"show-sums":"",jump:""},on:{change:e.changePage},slot:"pagination"}):e._e()],2)],1)],1)},xt=[],St=(a("b64b"),a("2699")),Ct=a("0b18"),Nt=a("0abb"),Lt=20,Dt="YYYYMMDD",Ot={name:"ServerPropertyMonitor",components:{HoursFilter:Ct["a"],CompareChart:Nt["a"]},data:function(){var e=this.$route.params.treeid;return{query:{thedate:Object(St["b"])(new Date,Dt),predate:Object(St["b"])(Date.now()-St["a"],Dt),startshowtime:"0000",endshowtime:"2360",moduleName:e.split(".")[1].substr(1),serverName:""},formatter:Dt,allItems:[],hour:-1,page:1,showChart:!0,keys:[]}},computed:{filteredItems:function(){var e=this.hour;return e>=0?this.allItems.filter((function(t){return+t.show_time.slice(0,2)===e})):this.allItems},itemsCount:function(){return this.filteredItems.length},pageCount:function(){return Math.ceil(this.filteredItems.length/Lt)},pagedItems:function(){return this.filteredItems.slice(Lt*(this.page-1),Lt*this.page)},chartOptions:function(){return{title:this.$t("monitor.table.total"),timeColumn:"show_time",dataColumns:[{name:"the_value",label:this.$t("monitor.property.property")},{name:"pre_value",label:this.$t("monitor.property.propertyC")}],data:this.allItems}},charts:function(){var e=this;return this.keys.map((function(t){return{title:t,timeColumn:"show_time",dataColumns:[{name:"the_".concat(t),label:e.$t("monitor.table.curr")},{name:"pre_".concat(t),label:e.$t("monitor.table.contrast")}],data:e.allItems}}))}},mounted:function(){this.fetchData()},methods:{fetchData:function(){var e=this;return Object(G["a"])(regeneratorRuntime.mark((function t(){var a,r,o,s,n,l,i,c,d,u;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.$refs.charts&&e.$refs.charts.$loading.show(),r=e.$refs.table.$loading.show(),t.prev=2,o=e.query,s=e.query,n=s.group_by,l=s.serverName,i=Object(E["a"])({},o),"serverName"===n&&""===l&&(i=Object(E["a"])({},i,{serverName:"*"})),t.next=8,pe(i);case 8:c=t.sent,d=c.data,u=c.keys,e.allItems=d,e.keys=u,t.next=19;break;case 15:t.prev=15,t.t0=t["catch"](2),console.error(t.t0),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.t0.message||t.t0.err_msg));case 19:return t.prev=19,a&&a.hide(),r.hide(),t.finish(19);case 23:case"end":return t.stop()}}),t,null,[[2,15,19,23]])})))()},groupBy:function(e){this.query.group_by=e,this.showChart=!1,this.fetchData()},search:function(){delete this.query.group_by,this.showChart=!0,this.fetchData()},changePage:function(e){this.page=e}}},It=Ot,Tt=(a("197e"),Object(k["a"])(It,Mt,xt,!1,null,null,null)),Rt=Tt.exports,jt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page_server_publish"},[e.showHistory?e._e():a("div",[e.serverList&&e.serverList.length>0?a("let-table",{ref:"table",attrs:{data:e.serverList,title:e.$t("serverList.title.serverList"),"empty-msg":e.$t("common.noService")}},[a("let-table-column",{scopedSlots:e._u([{key:"head",fn:function(t){return[a("let-checkbox",{model:{value:e.isCheckedAll,callback:function(t){e.isCheckedAll=t},expression:"isCheckedAll"}})]}},{key:"default",fn:function(t){return[a("let-checkbox",{attrs:{value:t.row.id},model:{value:t.row.isChecked,callback:function(a){e.$set(t.row,"isChecked",a)},expression:"scope.row.isChecked"}})]}}],null,!1,1693185143)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.ip"),prop:"node_name"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.enableSet")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.enable_set?e.$t("common.enable"):e.$t("common.disable")))])]}}],null,!1,2059146282)}),a("let-table-column",{attrs:{title:e.$t("common.set.setName"),prop:"set_name"}}),a("let-table-column",{attrs:{title:e.$t("common.set.setArea"),prop:"set_area"}}),a("let-table-column",{attrs:{title:e.$t("common.set.setGroup"),prop:"set_group"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.configStatus")},scopedSlots:e._u([{key:"default",fn:function(e){return[a("span",{class:"active"==e.row.setting_state?"status-active":"status-off"})]}}],null,!1,483453731)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.currStatus")},scopedSlots:e._u([{key:"default",fn:function(e){return[a("span",{class:"active"==e.row.present_state?"status-active":"status-off"})]}}],null,!1,3783586142)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.version"),prop:"patch_version"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.time")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticStyle:{"word-break":"break-word"}},[e._v(e._s(e.handleNoPublishedTime(t.row.patch_time)))])]}}],null,!1,3144837894)}),a("let-pagination",{attrs:{slot:"pagination",align:"right",total:e.totalPage,page:e.page},on:{change:e.changePage},slot:"pagination"}),a("div",{staticStyle:{"margin-left":"-15px"},attrs:{slot:"operations"},slot:"operations"},[a("let-button",{attrs:{theme:"primary",size:"small"},on:{click:e.openPublishModal}},[e._v(e._s(e.$t("pub.btn.pub")))]),e.serverList&&e.serverList.length>0?a("let-button",{attrs:{size:"small"},on:{click:e.gotoHistory}},[e._v(" "+e._s(e.$t("pub.btn.history"))+" ")]):e._e()],1)],1):e._e(),a("let-modal",{attrs:{title:e.$t("index.rightView.tab.patch"),width:"880px",footShow:!1},on:{close:e.closePublishModal,"on-confirm":e.savePublishServer},model:{value:e.publishModal.show,callback:function(t){e.$set(e.publishModal,"show",t)},expression:"publishModal.show"}},[e.publishModal.model?a("let-form",{ref:"publishForm",attrs:{itemWidth:"100%"}},[a("let-form-item",{attrs:{label:e.$t("serverList.servant.appService")}},[e._v(" "+e._s(e.publishModal.model.application)+"·"+e._s(e.publishModal.model.server_name)+" ")]),a("let-form-item",{attrs:{label:e.$t("pub.dlg.ip")}},e._l(e.publishModal.model.serverList,(function(t){return a("div",{key:t.id},[e._v(e._s(t.node_name))])})),0),"tars"==e.serverType?a("let-form-item",{attrs:{label:e.$t("serverList.servant.comment")}},[a("let-input",{model:{value:e.publishModal.model.update_text,callback:function(t){e.$set(e.publishModal.model,"update_text",t)},expression:"publishModal.model.update_text"}})],1):e._e(),e.patchRadioData.length>1?a("let-form-item",{attrs:{label:e.$t("pub.dlg.patchType")}},[a("let-radio-group",{attrs:{type:"button",size:"small",data:e.patchRadioData},on:{change:e.patchChange},model:{value:e.patchType,callback:function(t){e.patchType=t},expression:"patchType"}})],1):e._e(),e.publishModal.model.show?a("let-form-item",{attrs:{label:e.$t("pub.dlg.releaseVersion")}},["tars"==e.serverType?a("let-select",{attrs:{size:"small",required:"","required-tip":e.$t("pub.dlg.ab")},model:{value:e.publishModal.model.patch_id,callback:function(t){e.$set(e.publishModal.model,"patch_id",t)},expression:"publishModal.model.patch_id"}},e._l(e.publishModal.model.patchList,(function(t){return a("let-option",{key:t.id,attrs:{value:t.id}},[e._v(" "+e._s(t.id)+" | "+e._s(t.posttime)+" | "+e._s(t.comment)+" ")])})),1):e._e(),"tars"==e.serverType?a("let-button",{staticClass:"mt10",attrs:{theme:"primary",size:"small"},on:{click:e.showUploadModal}},[e._v(" "+e._s(e.$t("pub.dlg.upload"))+" ")]):e._e(),a("br"),"tars"!==e.serverType?a("let-table",{attrs:{data:e.publishModal.model.patchList,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-radio",{attrs:{label:t.row.id},model:{value:e.publishModal.publishId,callback:function(t){e.$set(e.publishModal,"publishId",t)},expression:"publishModal.publishId"}})]}}],null,!1,2512545811)}),a("let-table-column",{attrs:{title:"ID",prop:"id"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.id)+" "),a("span",{staticStyle:{color:"green",display:"inline-block",width:"1em",height:"1em"},attrs:{title:e.$t("releasePackage.default")}},[1==t.row.default_version?a("icon",{attrs:{name:"default"}}):e._e()],1)]}}],null,!1,1246507548)}),a("let-table-column",{attrs:{title:e.$t("releasePackage.moduleName"),prop:"server"}}),"dcache"===e.serverType?a("let-table-column",{attrs:{title:e.$t("releasePackage.cacheType")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(1==t.row.package_type?"KVcache":"MKVcache"))])]}}],null,!1,1195663938)}):e._e(),a("let-table-column",{attrs:{title:e.$t("serverList.servant.comment"),prop:"comment"}}),a("let-table-column",{attrs:{title:e.$t("releasePackage.uploadTime"),prop:"posttime"}}),a("let-pagination",{attrs:{slot:"pagination",align:"right",total:e.publishModal.totalPatchPage,page:e.publishModal.patchPage},on:{change:e.patchChangePage},slot:"pagination"})],1):e._e(),a("let-button",{staticClass:"mt10",attrs:{theme:"primary",size:"small"},on:{click:e.savePublishServer}},[e._v(e._s(e.$t("common.patch"))+" ")])],1):a("let-form-item",{attrs:{label:e.$t("serverList.table.th.version")}},[a("let-select",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty"),requred:""},model:{value:e.tagVersion,callback:function(t){e.tagVersion=t},expression:"tagVersion"}},e._l(e.tagList,(function(t){return a("let-option",{key:""+t.version,attrs:{value:t.path+"--"+t.version}},[e._v(" "+e._s(t.version)+" ")])})),1),a("let-button",{staticClass:"mt10",attrs:{theme:"primary",size:"small"},on:{click:e.addCompileTask}},[e._v(" "+e._s(e.$t("pub.dlg.compileAndPublish"))+" ")]),e._e()],1)],1):e._e()],1),a("let-modal",{attrs:{title:e.$t("pub.dlg.upload"),width:"880px",footShow:!1},on:{"on-cancel":e.closeUploadModal},model:{value:e.uploadModal.show,callback:function(t){e.$set(e.uploadModal,"show",t)},expression:"uploadModal.show"}},[e.uploadModal.model?a("let-form",{ref:"uploadForm",attrs:{itemWidth:"100%"},nativeOn:{submit:function(t){return t.preventDefault(),e.uploadPatchPackage(t)}}},[a("let-form-item",{attrs:{label:e.$t("pub.dlg.releasePkg"),itemWidth:"400px"}},[a("let-uploader",{attrs:{placeholder:e.$t("pub.dlg.defaultValue")},on:{upload:e.uploadFile}},[e._v(e._s(e.$t("common.submit"))+" ")]),e.uploadModal.model.file?a("span",[e._v(e._s(e.uploadModal.model.file.name))]):e._e()],1),a("let-form-item",{attrs:{label:e.$t("serverList.servant.comment")}},[a("let-input",{attrs:{type:"textarea",rows:3},model:{value:e.uploadModal.model.comment,callback:function(t){e.$set(e.uploadModal.model,"comment",t)},expression:"uploadModal.model.comment"}})],1),a("let-button",{attrs:{type:"submit",theme:"primary"}},[e._v(e._s(e.$t("serverList.servant.upload")))])],1):e._e()],1),a("let-modal",{attrs:{title:e.$t("serverList.table.th.result"),width:"880px",footShow:!1},on:{"on-cancel":e.closeFinishModal},model:{value:e.finishModal.show,callback:function(t){e.$set(e.finishModal,"show",t)},expression:"finishModal.show"}},[e.finishModal.model?a("let-table",{attrs:{title:e.$t("serverList.servant.taskID")+e.finishModal.model.task_no,data:e.finishModal.model.items}},[a("let-table-column",{attrs:{title:e.$t("serverList.table.th.ip"),prop:"node_name"}}),a("let-table-column",{attrs:{title:e.$t("common.status")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-tag",{attrs:{theme:2==t.row.status?"success":3==t.row.status?"danger":"",checked:""}},[e._v(" "+e._s(e.statusConfig[t.row.status]+(2!=t.row.status&&3!=t.row.status?"...":""))+" ")])]}}],null,!1,244065872)})],1):e._e()],1)],1),e.showHistory?a("div",[a("let-form",{attrs:{inline:"",itemWidth:"300px"},nativeOn:{submit:function(t){return t.preventDefault(),e.getHistoryList(t)}}},[a("let-form-item",{attrs:{label:e.$t("pub.date")}},[a("let-date-range-picker",{attrs:{start:e.startTime,end:e.endTime},on:{"update:start":function(t){e.startTime=t},"update:end":function(t){e.endTime=t}}})],1),a("let-form-item",[a("let-button",{attrs:{type:"submit",theme:"primary"}},[e._v(e._s(e.$t("operate.search")))])],1)],1),a("let-table",{ref:"historyTable",attrs:{data:e.totalHistoryList,title:e.$t("historyList.title"),"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("serverList.servant.taskID"),prop:"task_no"}}),a("let-table-column",{attrs:{title:e.$t("historyList.table.th.c2")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.serial?e.$t("common.yes"):e.$t("common.no")))])]}}],null,!1,98019885)}),a("let-table-column",{attrs:{title:e.$t("serverList.dlg.title.taskStatus")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e.statusMap[t.row.status]||"-"))])]}}],null,!1,3973050033)}),a("let-table-column",{attrs:{title:e.$t("historyList.table.th.c4")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.viewTask(t.row.task_no)}}},[e._v(e._s(e.$t("operate.view")))])]}}],null,!1,1853944e3)}),a("let-pagination",{attrs:{slot:"pagination",align:"right",total:e.historyTotalPage,page:e.historyPage},on:{change:e.changeHistoryPage},slot:"pagination"}),a("div",{staticStyle:{"margin-left":"-15px"},attrs:{slot:"operations"},slot:"operations"},[a("let-button",{attrs:{theme:"primary",size:"small"},on:{click:function(t){e.showHistory=!1}}},[e._v(e._s(e.$t("operate.goback")))])],1)],1),a("let-modal",{attrs:{title:e.$t("historyList.table.th.c4"),width:"880px",footShow:!1},on:{"on-cancel":function(t){e.taskModal.show=!1}},model:{value:e.taskModal.show,callback:function(t){e.$set(e.taskModal,"show",t)},expression:"taskModal.show"}},[e.taskModal.model?a("let-table",{attrs:{data:e.taskModal.model.items}},[a("let-table-column",{attrs:{title:e.$t("historyList.dlg.th.c1"),prop:"item_no"}}),a("let-table-column",{attrs:{title:e.$t("historyList.dlg.th.c2"),prop:"application"}}),a("let-table-column",{attrs:{title:e.$t("historyList.dlg.th.c3"),prop:"server_name"}}),a("let-table-column",{attrs:{title:e.$t("historyList.dlg.th.c4"),prop:"node_name"}}),a("let-table-column",{attrs:{title:e.$t("historyList.dlg.th.c5"),prop:"command"}}),a("let-table-column",{attrs:{title:e.$t("monitor.search.start"),prop:"start_time"}}),a("let-table-column",{attrs:{title:e.$t("monitor.search.end"),prop:"end_time"}}),a("let-table-column",{attrs:{title:e.$t("common.status"),prop:"status_info"}}),a("let-table-column",{attrs:{title:e.$t("historyList.dlg.th.c7"),prop:"execute_info"}})],1):e._e()],1)],1):e._e(),a("let-modal",{attrs:{title:e.$t("pub.dlg.conf"),width:"800px",footShow:!0},on:{"on-confirm":e.saveCompilerUrl,"on-cancel":function(t){e.publishUrlConfModal.show=!1}},model:{value:e.publishUrlConfModal.show,callback:function(t){e.$set(e.publishUrlConfModal,"show",t)},expression:"publishUrlConfModal.show"}},[e.publishUrlConfModal.model?a("let-form",{ref:"compilerForm",attrs:{itemWidth:"100%",required:""}},[a("let-form-item",{attrs:{label:e.$t("pub.dlg.tag")}},[a("let-input",{attrs:{size:"small",placeholder:e.$t("pub.tips.tag"),"required-tip":e.$t("deployService.table.tips.empty"),required:""},model:{value:e.publishUrlConfModal.model.tag,callback:function(t){e.$set(e.publishUrlConfModal.model,"tag",t)},expression:"publishUrlConfModal.model.tag"}})],1)],1):e._e()],1),a("let-modal",{attrs:{title:e.$t("pub.dlg.compileProgress"),width:"880px",footShow:!1},model:{value:e.compilerModal.show,callback:function(t){e.$set(e.compilerModal,"show",t)},expression:"compilerModal.show"}},[e.compilerModal.model?a("let-table",{attrs:{data:e.compilerModal.model.progress}},[a("let-table-column",{attrs:{title:e.$t("historyList.dlg.th.c2"),prop:"application"}}),a("let-table-column",{attrs:{title:e.$t("historyList.dlg.th.c3"),prop:"server_name"}}),a("let-table-column",{attrs:{title:e.$t("historyList.dlg.th.c4"),prop:"node"}}),a("let-table-column",{attrs:{title:e.$t("historyList.dlg.th.c8"),prop:"status"},scopedSlots:e._u([{key:"default",fn:function(t){return["1"==t.row.state?a("span",{staticClass:"running"},[e._v(e._s(t.row.status))]):"2"==t.row.state?a("span",{staticClass:"success"},[e._v(e._s(t.row.status))]):a("span",{staticClass:"stop"},[e._v(e._s(t.row.status))])]}}],null,!1,3193835083)}),a("let-table-column",{attrs:{title:e.$t("monitor.search.start"),prop:"start_time"}}),a("let-table-column",{attrs:{title:e.$t("monitor.search.end"),prop:"end_time"}})],1):e._e()],1)],1)},Pt=[],At={name:"ServerPublish",data:function(){return{serverType:this.$route.params.serverType||"tars",activeKey:"",treeData:[],totalServerList:[],serverList:[],isCheckedAll:!1,totalPage:0,pageSize:20,page:1,publishModal:{publishId:null,show:!1,model:null,module_name:"",application:"",totalPatchPage:0,patchPageSize:10,patchPage:1},finishModal:{show:!1,model:{task_no:"",items:[]}},statusConfig:{0:this.$t("serverList.restart.notStart"),1:this.$t("serverList.restart.running"),2:this.$t("serverList.restart.success"),3:this.$t("serverList.restart.failed"),4:this.$t("serverList.restart.cancel"),5:this.$t("serverList.restart.parial")},statusMap:{0:"EM_T_NOT_START",1:"EM_T_RUNNING",2:"EM_T_SUCCESS",3:"EM_T_FAILED",4:"EM_T_CANCEL",5:"EM_T_PARIAL"},showHistory:!1,startTime:"",endTime:"",totalHistoryList:[],historyList:[],historyTotalPage:0,historyPage:1,historyPageSize:20,taskModal:{show:!1,modal:!0},uploadModal:{show:!1,model:null},patchType:"patch",patchRadioData:[{value:"patch",text:this.$t("pub.dlg.upload")}],tagList:[],tagVersion:"",publishUrlConfModal:{show:!1,model:{tag:"",compiler:"",task:""}},compilerModal:{show:!1,model:null},pkgUpload:{show:!1,model:null}}},methods:{getCompileConf:function(){var e=this;this.$ajax.getJSON("/server/api/get_compile_conf").then((function(t){t.enable&&e.patchRadioData.push({value:"compile",text:e.$t("pub.dlg.compileAndPublish")})})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))},getServerList:function(){var e=this,t=this.$Loading.show();this.$ajax.getJSON("/server/api/server_list",{tree_node_id:this.$route.params.treeid}).then((function(a){t.hide();var r=a||[];r.forEach((function(e){e.isChecked=!1})),e.totalServerList=r,e.totalPage=Math.ceil(e.totalServerList.length/e.pageSize),e.page=1,e.updateServerList()})).catch((function(a){t.hide(),e.$confirm(a.err_msg||a.message||e.$t("serverList.table.msg.fail")).then((function(){e.getServerList()}))}))},changePage:function(e){this.page=e},openPublishModal:function(){var e=this,t=this.serverList.filter((function(e){return e.isChecked}));if(t.length<=0)this.$tip.warning(this.$t("pub.dlg.a"));else{var a=t[0];this.publishModal.publishId=null,this.publishModal.model={application:a.application,server_name:a.server_name,serverList:t,patchList:[],patch_id:"",update_text:"",show:!0};var r=this.serverType,o=a.server_name,s=1,n=5;"router"==r?o="RouterServer":"proxy"==r?o="ProxyServer":"dcache"==r&&(o="DCacheServerGroup"),this.publishModal.module_name=o,this.publishModal.application=a.application,this.publishModal.patchPage=s,this.publishModal.patchPageSize=n,this.getPatchList(a.application,o,s,n).then((function(t){e.publishModal.model.patchList=t.rows,e.publishModal.totalPatchPage=Math.ceil(t.count/n),e.publishModal.show=!0}))}},patchChangePage:function(e){var t=this;this.publishModal.patchPage=e;var a=this.publishModal,r=a.module_name,o=a.application,s=a.patchPage,n=a.patchPageSize;this.getPatchList(o,r,s,n).then((function(e){t.publishModal.model.patchList=e.rows,t.publishModal.totalPatchPage=Math.ceil(e.count/n)}))},getPatchList:function(e,t,a,r){return this.$ajax.getJSON("/server/api/server_patch_list",{application:e,module_name:t,curr_page:a,page_size:r})},closePublishModal:function(){this.publishModal.show=!1,this.publishModal.modal=null,this.patchType="patch",this.$refs.publishForm.resetValid()},savePublishServer:function(){var e=this;if(this.$refs.publishForm.validate()){var t=[],a="tars"===this.serverType?this.publishModal.model.patch_id.toString():this.publishModal.publishId;if(!a)return this.$tip.warning(this.$t("pub.dlg.ab"));var r=this.serverType,o="";"router"==r?o="RouterServer":"proxy"==r?o="ProxyServer":"dcache"==r&&(o="DCacheServerGroup"),this.publishModal.model.serverList.forEach((function(r){t.push({server_id:r.id.toString(),command:"patch_tars",parameters:{patch_id:a,bak_flag:r.bak_flag,update_text:e.publishModal.model.update_text,group_name:o}})}));var s=this.$Loading.show();this.$ajax.postJSON("/server/api/add_task",{serial:!0,items:t}).then((function(t){s.hide(),e.closePublishModal(),e.finishModal.model.task_no=t,e.finishModal.show=!0,e.getTaskRepeat(t)})).catch((function(t){s.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))}},closeFinishModal:function(){this.finishModal.show=!1,this.finishModal.modal=null,this.$refs.finishForm.resetValid()},getTaskRepeat:function(e){var t,a=this;t&&clearTimeout(t);var r=function r(){a.$ajax.getJSON("/server/api/task",{task_no:e}).then((function(e){var o=!0;e.items.forEach((function(e){[2,3].includes(e.status)||(o=!1)})),o?clearTimeout(t):t=setTimeout(r,2e3),a.finishModal.model.items=e.items})).catch((function(e){clearTimeout(t),a.$tip.error("".concat(a.$t("common.error"),": ").concat(e.message||e.err_msg))}))};r()},updateServerList:function(){var e=(this.page-1)*this.pageSize,t=this.page*this.pageSize;this.serverList=this.totalServerList.slice(e,t)},gotoHistory:function(){this.showHistory=!0,this.getHistoryList(1)},getHistoryList:function(e){var t=this;"number"!=typeof e&&(e=1);var a=this.$Loading.show(),r={application:this.serverList[0].application||"",server_name:this.serverList[0].server_name||"",from:this.startTime,to:this.endTime,page_size:this.historyPageSize,curr_page:e};this.historyPage=e,this.$ajax.getJSON("/server/api/task_list",r).then((function(e){a.hide(),t.totalHistoryList=e.rows||[],t.historyTotalPage=Math.ceil(e.count/t.historyPageSize)})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))},viewTask:function(e){var t=this;this.$ajax.getJSON("/server/api/task",{task_no:e}).then((function(e){t.taskModal.model=e,t.taskModal.show=!0}))},changeHistoryPage:function(e){this.getHistoryList(e)},showUploadModal:function(){this.serverList.length<=0&&this.$tip.warning(this.$t("pub.dlg.a")),this.uploadModal.model={application:this.serverList[0].application||"",server_name:this.serverList[0].server_name||"",file:null,comment:""},this.uploadModal.show=!0},closeUploadModal:function(){this.uploadModal.show=!1,this.uploadModal.model=null,this.$refs.uploadForm.resetValid()},uploadFile:function(e){this.uploadModal.model.file=e},uploadPatchPackage:function(){var e=this;if(this.$refs.uploadForm.validate()){var t=this.$Loading.show(),a=new FormData;a.append("application",this.uploadModal.model.application),a.append("module_name",this.uploadModal.model.server_name),a.append("suse",this.uploadModal.model.file),a.append("comment",this.uploadModal.model.comment),a.append("task_id",(new Date).getTime()),this.$ajax.postForm("/server/api/upload_patch_package",a).then((function(){e.getPatchList(e.uploadModal.model.application,e.uploadModal.model.server_name,1,50).then((function(a){t.hide(),e.publishModal.model.patchList=a.rows,e.closeUploadModal()}))})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.message||a.err_msg))}))}},handleNoPublishedTime:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.$t("pub.dlg.unpublished");return"0000:00:00 00:00:00"===e?t:e},patchChange:function(){"patch"==this.patchType?this.publishModal.model.show=!0:(this.publishModal.model.show=!1,this.getCodeVersion())},getCodeVersion:function(){var e=this;this.$ajax.get("/server/api/get_tag_list",{application:this.publishModal.model.application,server_name:this.publishModal.model.server_name}).then((function(t){""==t.data?e.openPubConfModal():e.tagList=t.data})).catch((function(t){e.tagList=[],e.$tip.error("".concat(e.$t("common.error"),": ").concat(err.err_msg||err.message))}))},openPubConfModal:function(){var e=this;this.publishUrlConfModal.show=!0,this.$ajax.getJSON("/server/api/get_tag_conf",{application:this.publishModal.model.application,server_name:this.publishModal.model.server_name}).then((function(t){e.publishUrlConfModal.model.tag=t.path})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.err_msg||t.message))}))},saveCompilerUrl:function(){var e=this;if(this.$refs.compilerForm.validate()){var t=this.$Loading.show();this.$ajax.getJSON("/server/api/set_tag_conf",{path:this.publishUrlConfModal.model.tag,application:this.publishModal.model.application,server_name:this.publishModal.model.server_name}).then((function(a){t.hide(),e.$tip.success(e.$t("common.success")),e.publishUrlConfModal.show=!1,e.getCodeVersion()})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.err_msg||a.message))}))}},addCompileTask:function(){var e=this;this.$ajax.getJSON("/server/api/get_compile_conf").then((function(t){var a=t.getVersionList;if(a){var r=e.publishModal.model.serverList.map((function(e){return e.node_name})),o={application:e.publishModal.model.application,server_name:e.publishModal.model.server_name,node:r.join(";"),path:e.tagVersion.split("--")[0],version:e.tagVersion.split("--")[1],comment:e.publishModal.model.update_text||"",compileUrl:a},s=e.$Loading.show();e.$ajax.postJSON("/server/api/do_compile",o).then((function(t){s.hide(),e.compilerModal.show=!0;var a="string"===typeof t?t:t.data;e.getStatus(a)})).catch((function(t){s.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.err_msg||t.message))}))}else e.openPubConfModal()})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.err_msg||t.message))}))},taskStatus:function(e){this.getStatus(e)},getStatus:function(e){var t=this,a=function a(){var r=null;r&&clearTimeout(r),t.$ajax.getJSON("/server/api/compiler_task",{taskNo:e}).then((function(o){var s="array"===typeof o?o:o.data;if(s[0].status=t.statusConfig[s[0].state],1==s[0].state&&(r=setTimeout(a,2e3)),t.compilerModal.model?Object.assign(t.compilerModal.model,{progress:s}):t.compilerModal.model={progress:s},2==s[0].state){var n=t.$Loading({text:"回传发布包"});n.show(),t.compilerModal.show=!1;var l=function a(){t.$ajax.getJSON("/server/api/get_server_patch",{task_id:e}).then((function(e){0!==Object.keys(e).length?(n.hide(),t.publishModal.model.patch_id=e.id,t.publishModal.show=!1,t.savePublishServer()):setTimeout(a,2e3)})).catch((function(e){n.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))}))};setTimeout(l,2e3)}})).catch((function(e){t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))}))};a()}},mounted:function(){this.getServerList(),this.getCompileConf()},watch:{isCheckedAll:function(){var e=this.isCheckedAll;this.serverList.forEach((function(t){t.isChecked=e}))},page:function(){this.updateServerList()}}},qt=At,zt=(a("0207"),Object(k["a"])(qt,jt,Pt,!1,null,null,null)),Et=zt.exports,Gt=a("918a"),Vt=a("8d5c"),Wt=a("107e"),Ft=a("a618"),Ut=a("575d"),Jt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page_operation"},[a("let-tabs",{attrs:{activekey:e.$route.matched[1]?e.$route.matched[1].path:"/operation/apply"},on:{click:e.onTabClick}},[a("let-tab-pane",{attrs:{tab:e.$t("apply.title"),tabkey:"/operation/apply"}}),a("let-tab-pane",{attrs:{tab:e.$t("module.title"),tabkey:"/operation/module"}}),a("let-tab-pane",{attrs:{tab:e.$t("region.title"),tabkey:"/operation/region"}})],1),a("router-view",{staticClass:"page_operation_children"})],1)},Zt=[],Bt={name:"Oparetion",methods:{onTabClick:function(e){this.$router.replace(e)}}},Yt=Bt,Kt=Object(k["a"])(Yt,Jt,Zt,!1,null,null,null),Qt=Kt.exports,Ht=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page_operation_apply"},[a("let-steps",{staticClass:"apply_steps",attrs:{current:e.step}},[a("let-step",{attrs:{title:e.$t(e.title1)}}),a("let-step",{attrs:{title:e.$t(e.title2)}}),a("let-step",{attrs:{title:e.$t(e.title3)}})],1),a("router-view",{staticClass:"page_operation_apply_children"})],1)},Xt=[],ea={data:function(){var e=this.$route.fullPath,t=1;return e.indexOf("createApply")>-1?t=1:e.indexOf("createService")>-1?t=2:e.indexOf("installAndPublish")>-1&&(t=3),{title1:"apply.createApply",title2:"apply.createRouterProxyService",title3:"apply.installAndPublish",step:t}},watch:{$route:function(e,t){var a=e.fullPath;a.indexOf("createApply")>-1?this.step=1:a.indexOf("createService")>-1?this.step=2:a.indexOf("installAndPublish")>-1&&(this.step=3)}},methods:{}},ta=ea,aa=(a("4ff0"),Object(k["a"])(ta,Ht,Xt,!1,null,null,null)),ra=aa.exports,oa=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"page_operation_create_apply"},[a("let-form",{ref:"detailForm",attrs:{inline:""}},[a("let-form-item",{attrs:{label:e.$t("apply.title"),itemWidth:"240px",required:""}},[a("let-input",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:e.model.name,callback:function(t){e.$set(e.model,"name",t)},expression:"model.name"}})],1),a("let-form-item",{attrs:{label:e.$t("common.admin"),itemWidth:"240px"}},[a("let-input",{attrs:{size:"small"},model:{value:e.model.admin,callback:function(t){e.$set(e.model,"admin",t)},expression:"model.admin"}})],1),a("br"),a("let-form-item",{attrs:{label:e.$t("region.idcArea"),itemWidth:"240px"}},[a("let-select",{attrs:{size:"small"},on:{change:e.changeSelect},model:{value:e.model.idcArea,callback:function(t){e.$set(e.model,"idcArea",t)},expression:"model.idcArea"}},e._l(e.regions,(function(t){return a("let-option",{key:t.label,attrs:{value:t.label}},[e._v(" "+e._s(t.region)+" ")])})),1)],1),a("let-form-item",{attrs:{label:e.$t("region.setArea"),itemWidth:"240px"}},[a("let-select",{attrs:{size:"small",multiple:!0},model:{value:e.model.setArea,callback:function(t){e.$set(e.model,"setArea",t)},expression:"model.setArea"}},e._l(e.setRegions,(function(t){return a("let-option",{key:t.label,attrs:{value:t.label}},[e._v(" "+e._s(t.region)+" ")])})),1)],1),a("div",[a("let-button",{attrs:{size:"small",theme:"primary"},on:{click:e.createApply}},[e._v(e._s(e.$t("apply.createApply")))])],1)],1)],1)},sa=[],na=function(){return{name:"",admin:"",idcArea:"",setArea:[]}},la={data:function(){return{regions:[],setRegions:[],model:na()}},methods:{changeSelect:function(){var e=this;this.model.setArea=[];var t=this.regions.concat();t.splice(t.indexOf(t.find((function(t){return t.label==e.model.idcArea}))),1),this.setRegions=t},createApply:function(){var e=this;if(this.$refs.detailForm.validate()){var t=this.model,a="/server/api/add_apply",r=this.$Loading.show();this.$ajax.postJSON(a,t).then((function(t){r.hide(),e.$tip.success(e.$t("common.success")),e.$router.push("/operation/apply/createService/"+t.id)})).catch((function(t){r.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))}},getRegionList:function(){var e=this;return Object(G["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,_e();case 3:a=t.sent,e.regions=a,t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](0),console.error(t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()}},created:function(){this.getRegionList()},beforeRouteEnter:function(e,t,a){o["a"].getJSON("/server/api/has_dcahce_patch_package").then((function(e){e?a():(console.log(e),a((function(e){console.log("aaaaa"),e.$tip.warning("".concat(e.$t("common.warning"),": ").concat(e.$t("apply.uploadPatchPackage"))),e.$router.push("/releasePackage/proxyList")})))})).catch((function(e){console.error(e.message||e.err_msg)}))}},ia=la,ca=Object(k["a"])(ia,oa,sa,!1,null,null,null),da=ca.exports,ua=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"page_operation_create_service"},[a("let-form",{ref:"detailForm",attrs:{"label-position":"top"}},[a("let-form-group",{attrs:{title:e.$t("apply.RouterConfigInfo"),inline:"","label-position":"top"}},[a("let-form-item",{attrs:{label:e.$t("service.serverName"),itemWidth:"240px",required:""}},[a("let-input",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:e.apply.Router.server_name,callback:function(t){e.$set(e.apply.Router,"server_name",t)},expression:"apply.Router.server_name"}})],1),a("let-form-item",{attrs:{label:e.$t("service.serverIp"),itemWidth:"240px",required:""}},[a("let-input",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:e.apply.Router.server_ip,callback:function(t){e.$set(e.apply.Router,"server_ip",t)},expression:"apply.Router.server_ip"}})],1),a("let-form-item",{attrs:{label:e.$t("deployService.form.template"),itemWidth:"240px",required:""}},[a("let-select",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.form.templateTips")},model:{value:e.apply.Router.template_file,callback:function(t){e.$set(e.apply.Router,"template_file",t)},expression:"apply.Router.template_file"}},e._l(e.templates,(function(t){return a("let-option",{key:t,attrs:{value:t}},[e._v(e._s(t))])})),1)],1),a("br"),a("span",{staticStyle:{"margin-left":"20px"}},[e._v(e._s(e.$t("service.routerDbNameTip")))]),a("br"),a("let-form-item",{attrs:{label:e.$t("service.routerDbName"),itemWidth:"240px",required:""}},[a("let-input",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:e.apply.Router.router_db_name,callback:function(t){e.$set(e.apply.Router,"router_db_name",t)},expression:"apply.Router.router_db_name"}})],1),a("let-form-item",{attrs:{label:e.$t("service.routerDbIp"),itemWidth:"240px",required:""}},[a("let-input",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:e.apply.Router.router_db_ip,callback:function(t){e.$set(e.apply.Router,"router_db_ip",t)},expression:"apply.Router.router_db_ip"}})],1),a("let-form-item",{attrs:{label:e.$t("service.routerDbPort"),itemWidth:"240px",required:""}},[a("let-input",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:e.apply.Router.router_db_port,callback:function(t){e.$set(e.apply.Router,"router_db_port",t)},expression:"apply.Router.router_db_port"}})],1),a("let-form-item",{attrs:{label:e.$t("service.routerDbUser"),itemWidth:"240px",required:""}},[a("let-input",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:e.apply.Router.router_db_user,callback:function(t){e.$set(e.apply.Router,"router_db_user",t)},expression:"apply.Router.router_db_user"}})],1),a("let-form-item",{attrs:{label:e.$t("service.routerDbPass"),itemWidth:"240px",required:""}},[a("let-input",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:e.apply.Router.router_db_pass,callback:function(t){e.$set(e.apply.Router,"router_db_pass",t)},expression:"apply.Router.router_db_pass"}})],1)],1),a("let-form-group",{attrs:{title:e.$t("apply.ProxyConfigInfo"),inline:"","label-position":"top"}},[a("let-table",{ref:"table",attrs:{data:e.apply.Proxy,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("service.serverName"),prop:"server_name",width:"25%"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-input",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:t.row.server_name,callback:function(a){e.$set(t.row,"server_name",a)},expression:"scope.row.server_name"}})]}}])}),a("let-table-column",{attrs:{title:e.$t("service.multipleIp"),prop:"server_ip",width:"25%"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-input",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:t.row.server_ip,callback:function(a){e.$set(t.row,"server_ip",a)},expression:"scope.row.server_ip"}})]}}])}),a("let-table-column",{attrs:{title:e.$t("region.idcArea"),prop:"idc_area"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.idc_area)+" ")]}}])}),a("let-table-column",{attrs:{title:e.$t("deployService.form.template"),prop:"template_file"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-select",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.form.templateTips")},model:{value:t.row.template_file,callback:function(a){e.$set(t.row,"template_file",a)},expression:"scope.row.template_file"}},e._l(e.templates,(function(t){return a("let-option",{key:t,attrs:{value:t}},[e._v(e._s(t))])})),1)]}}])})],1)],1),a("let-button",{attrs:{size:"small",theme:"primary"},on:{click:e.createService}},[e._v(e._s(e.$t("apply.createRouterProxyService"))+" ")])],1)],1)},ma=[],pa=(a("3e8f"),function(){return{apply_id:17,create_person:"adminUser",router_db_ip:"",router_db_name:"",router_db_pass:"",router_db_port:"",router_db_user:"",server_ip:"",server_name:"aswRouterServer",template_file:""}}),ha=function(){return{apply_id:17,create_person:"adminUser",idc_area:"sz",server_ip:"",server_name:"aswRouterServer",template_file:""}},fa={data:function(){var e=this.$route.params.applyId;return{templates:[],applyId:e,apply:{Router:pa(),Proxy:[ha()]}}},methods:{templateNameList:function(){var e=this;return this.$ajax.getJSON("/server/api/template_name_list").then((function(t){e.templates=t,e.apply.Router.template_file=t[0],e.apply.Proxy.forEach((function(e){return e.template_file=t[0]}))})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))},getApplyInfo:function(){var e=this,t=this.applyId;return this.$ajax.getJSON("/server/api/get_apply_and_router_and_proxy",{applyId:t}).then((function(t){e.apply=t||{}})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))},createService:function(){var e=this;if(this.$refs.detailForm.validate()){var t=this.apply,a="/server/api/save_router_proxy",r=this.checkDuplicateIp(t.Proxy);if(r)this.$tip.error(this.$t("apply.duplicateIp"));else{var o=this.$Loading.show();this.$ajax.postJSON(a,t).then((function(t){o.hide();var a=e.applyId;e.$router.push("/operation/apply/installAndPublish/"+a)})).catch((function(t){o.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))}}},checkDuplicateIp:function(e){var t=[],a=!1;return e.forEach((function(e){e.server_ip.split(";").filter((function(e){return e})).forEach((function(e){t.indexOf(e)>-1?a=!0:t.push(e)}))})),a}},created:function(){var e=this;return Object(G["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getApplyInfo();case 2:return t.next=4,e.templateNameList();case 4:case"end":return t.stop()}}),t)})))()}},va=fa,ga=(a("04bd"),Object(k["a"])(va,ua,ma,!1,null,null,null)),_a=ga.exports,ba=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"page_operation_install_and_publish"},[a("let-form",{ref:"detailForm",attrs:{"label-position":"top"}},[a("let-form-group",{attrs:{title:e.$t("common.baseInfo"),inline:"","label-position":"top"}},[a("let-form-item",{attrs:{label:e.$t("apply.name"),itemWidth:"240px",required:""}},[e._v(" "+e._s(e.apply.name)+" ")]),a("let-form-item",{attrs:{label:e.$t("common.admin"),itemWidth:"240px"}},[e._v(" "+e._s(e.apply.admin)+" ")]),a("let-form-item",{attrs:{label:e.$t("region.idcArea"),itemWidth:"240px"}},[e._v(" "+e._s(e.apply.idc_area)+" ")]),a("let-form-item",{attrs:{label:e.$t("region.setArea"),itemWidth:"240px"}},[e._v(" "+e._s(e.apply.set_area.join(","))+" ")]),a("let-form-item",{attrs:{label:e.$t("common.createPerson"),itemWidth:"240px",required:""}},[e._v(" "+e._s(e.apply.create_person)+" ")])],1),a("let-form-group",{attrs:{title:e.$t("apply.RouterConfigInfo"),inline:"","label-position":"top"}},[a("let-form-item",{attrs:{label:e.$t("service.serverName"),itemWidth:"240px",required:""}},[e._v(" "+e._s(e.apply.Router.server_name)+" ")]),a("let-form-item",{attrs:{label:e.$t("service.serverIp"),itemWidth:"240px",required:""}},[e._v(" "+e._s(e.apply.Router.server_ip)+" ")]),a("let-form-item",{attrs:{label:e.$t("service.templateFile"),itemWidth:"240px",required:""}},[e._v(" "+e._s(e.apply.Router.template_file)+" ")]),a("let-form-item",{attrs:{label:e.$t("service.routerDbName"),itemWidth:"240px",required:""}},[e._v(" "+e._s(e.apply.Router.router_db_name)+" ")]),a("br"),a("let-form-item",{attrs:{label:e.$t("service.routerDbIp"),itemWidth:"240px",required:""}},[e._v(" "+e._s(e.apply.Router.router_db_ip)+" ")]),a("let-form-item",{attrs:{label:e.$t("service.routerDbPort"),itemWidth:"240px",required:""}},[e._v(" "+e._s(e.apply.Router.router_db_port)+" ")]),a("let-form-item",{attrs:{label:e.$t("service.routerDbUser"),itemWidth:"240px",required:""}},[e._v(" "+e._s(e.apply.Router.router_db_user)+" ")]),a("let-form-item",{attrs:{label:e.$t("service.routerDbPass"),itemWidth:"240px",required:""}},[e._v(" "+e._s(e.apply.Router.router_db_pass)+" ")])],1),a("let-form-group",{attrs:{title:e.$t("apply.ProxyConfigInfo"),inline:"","label-position":"top"}},[a("let-table",{ref:"table",attrs:{data:e.apply.Proxy,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("service.serverName"),prop:"server_name",width:"25%"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.server_name)+" ")]}}])}),a("let-table-column",{attrs:{title:e.$t("service.multipleIp"),prop:"server_ip",width:"25%"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.server_ip)+" ")]}}])}),a("let-table-column",{attrs:{title:e.$t("region.idcArea"),prop:"idc_area"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.idc_area)+" ")]}}])}),a("let-table-column",{attrs:{title:e.$t("service.templateFile"),prop:"template_file"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.template_file)+" ")]}}])})],1)],1),a("let-button",{attrs:{size:"small",theme:"primary"},on:{click:e.installAndPublish}},[e._v(e._s(e.$t("apply.installAndPublish"))+" ")])],1),a("let-modal",{attrs:{title:e.$t("publishLog.title"),width:"800px"},on:{"on-confirm":e.confirmPublish},model:{value:e.showModal,callback:function(t){e.showModal=t},expression:"showModal"}},[a("let-table",{ref:"ProgressTable",staticStyle:{"margin-top":"20px"},attrs:{data:e.items,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("module.title"),prop:"module",width:"20%"}}),a("let-table-column",{attrs:{title:e.$t("publishLog.releaseId"),prop:"releaseId",width:"20%"}}),a("let-table-column",{attrs:{title:e.$t("publishLog.releaseProgress"),prop:"percent"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row,o=r.percent,s=r.errMsg;return[s?a("p",{staticStyle:{color:"red"}},[e._v(e._s(s))]):a("span",[e._v(e._s(o))]),100===o||s?e._e():a("icon",{staticClass:"spinner-icon",attrs:{name:"spinner"}})]}}])})],1)],1)],1)},$a=[],ya=(a("2ff6"),function(){return{apply_id:17,create_person:"adminUser",router_db_ip:"",router_db_name:"",router_db_pass:"",router_db_port:"",router_db_user:"",server_ip:"",server_name:"aswRouterServer",template_file:""}}),ka=function(){return{apply_id:17,create_person:"adminUser",idc_area:"sz",server_ip:"",server_name:"aswRouterServer",template_file:""}},wa={data:function(){var e=this.$route.params.applyId;return{applyId:e,showModal:!1,items:[],apply:{set_area:[],Router:ya(),Proxy:[ka()]},timerId:null}},methods:{getApplyInfo:function(){var e=this,t=this.applyId;this.$ajax.getJSON("/server/api/get_apply_and_router_and_proxy",{applyId:t}).then((function(t){e.apply=t||{}})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))},installAndPublish:function(){var e=this;return Object(G["a"])(regeneratorRuntime.mark((function t(){var a,r,o,s,n,l;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,a=e.applyId,t.next=4,me({applyId:a});case 4:r=t.sent,o=r.proxy,s=r.router,e.showModal=!0,n=o.releaseId,l=s.releaseId,e.items=[{module:"ProxyServer",releaseId:n,percent:"0",errMsg:"",timer:""},{module:"RouterServer",releaseId:l,percent:"0",errMsg:"",timer:""}],e.items.forEach((function(t){return e.repeatGetReleaseProgress(t)})),t.next=18;break;case 14:t.prev=14,t.t0=t["catch"](0),console.error(t.t0),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.t0.message||t.t0.err_msg));case 18:case"end":return t.stop()}}),t,null,[[0,14]])})))()},repeatGetReleaseProgress:function(e){var t=this;return Object(G["a"])(regeneratorRuntime.mark((function a(){var r,o;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return clearTimeout(e.timer),a.prev=1,a.next=4,Q({releaseId:e.releaseId});case 4:r=a.sent,o=r.percent,e.percent=o,100===o?clearTimeout(e.timer):e.timer=setTimeout(t.repeatGetReleaseProgress.bind(t,e),1e3),a.next=16;break;case 10:a.prev=10,a.t0=a["catch"](1),console.error(a.t0),t.$tip.error("".concat(t.$t("common.error"),": ").concat(a.t0.message||a.t0.err_msg)),e.errMsg=a.t0,clearTimeout(e.timer);case 16:case"end":return a.stop()}}),a,null,[[1,10]])})))()},confirmPublish:function(){this.showModal=!1,document.body.classList.remove("has-modal-open"),this.$router.push("/operation/module/createModule")}},beforeRouteLeave:function(e,t,a){clearTimeout(this.timerId),a()},created:function(){this.getApplyInfo()}},Ma=wa,xa=(a("0e15"),Object(k["a"])(Ma,ba,$a,!1,null,null,null)),Sa=xa.exports,Ca=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page_operation_module"},[a("let-steps",{staticClass:"apply_steps",attrs:{current:e.step}},[a("let-step",{attrs:{title:e.$t(e.title1)}}),a("let-step",{attrs:{title:e.$t(e.title2)}}),a("let-step",{attrs:{title:e.$t(e.title3)}}),a("let-step",{attrs:{title:e.$t(e.title4)}})],1),a("router-view",{staticClass:"page_operation_apply_children"})],1)},Na=[],La={data:function(){var e=this.$route.fullPath,t=1;return e.indexOf("createApply")>-1?t=1:e.indexOf("moduleConfig")>-1?t=2:e.indexOf("serverConfig")>-1?t=3:e.indexOf("installAndPublish")>-1&&(t=4),{title1:"module.createModule",title2:"module.moduleConfig",title3:"module.serverConfig",title4:"apply.installAndPublish",step:t}},watch:{$route:function(e,t){var a=e.fullPath;a.indexOf("createApply")>-1?this.step=1:a.indexOf("moduleConfig")>-1?this.step=2:a.indexOf("serverConfig")>-1?this.step=3:a.indexOf("installAndPublish")>-1&&(this.step=4)}},methods:{}},Da=La,Oa=(a("1481"),Object(k["a"])(Da,Ca,Na,!1,null,null,null)),Ia=Oa.exports,Ta=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"page_operation_create_module"},[a("let-form",{ref:"detailForm",attrs:{inline:""}},[a("let-form-item",{attrs:{label:e.$t("apply.title"),itemWidth:"240px",required:""}},[a("let-select",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:e.model.apply_id,callback:function(t){e.$set(e.model,"apply_id",t)},expression:"model.apply_id"}},e._l(e.applys,(function(t){return a("let-option",{key:t.id,attrs:{value:t.id}},[e._v(" "+e._s(t.name)+" ")])})),1)],1),a("let-form-item",{attrs:{label:e.$t("module.cacheType"),itemWidth:"240px",required:""}},[a("let-select",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:e.type,callback:function(t){e.type=t},expression:"type"}},e._l(e.types,(function(t){return a("let-option",{key:t.key,attrs:{value:t.key}},[e._v(" "+e._s(t.value)+" ")])})),1)],1),a("let-form-item",{attrs:{label:e.$t("module.follower"),itemWidth:"240px"}},[a("let-input",{attrs:{size:"small"},model:{value:e.model.follower,callback:function(t){e.$set(e.model,"follower",t)},expression:"model.follower"}})],1),a("div",[a("let-button",{attrs:{size:"small",theme:"primary"},on:{click:e.createModule}},[e._v(e._s(e.$t("common.nextStep")))])],1)],1)],1)},Ra=[],ja=function(){return{apply_id:"",follower:"",cache_version:"",mkcache_struct:""}},Pa=[{key:"1-0",value:"key-value(KVCache)"},{key:"2-1",value:"k-k-row(MKVCache)"},{key:"2-2",value:"Set(MKVCache)"},{key:"2-3",value:"List(MKVCache)"},{key:"2-4",value:"Zset(MKVCache)"}],Aa={data:function(){return{model:ja(),applys:[],types:Pa}},computed:{type:{get:function(){return this.model.cache_version?this.model.cache_version+"-"+this.model.mkcache_struct:""},set:function(e){var t=e.split("-");this.model.cache_version=t[0],this.model.mkcache_struct=t[1]}}},methods:{createModule:function(){var e=this;if(this.$refs.detailForm.validate()){var t=this.model,a="/server/api/add_module_base_info",r=this.$Loading.show();this.$ajax.postJSON(a,t).then((function(t){r.hide(),e.$tip.success(e.$t("common.success")),e.$router.push("/operation/module/moduleConfig/"+t.id)})).catch((function(t){r.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))}}},beforeRouteEnter:function(e,t,a){o["a"].getJSON("/server/api/get_apply_list").then((function(e){e.length?a((function(t){t.applys=e})):a((function(e){e.$tip.warning("".concat(e.$t("common.warning"),": ").concat(e.$t("module.createApplyTips"))),e.$router.push("/operation/apply/createApply")}))})).catch((function(e){alert(e.message||e.err_msg)}))}},qa=Aa,za=Object(k["a"])(qa,Ta,Ra,!1,null,null,null),Ea=za.exports,Ga=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"page_operation_module_info"},[a("let-form",{ref:"detailForm",attrs:{inline:""}},[a("let-form-item",{attrs:{label:e.$t("module.name"),itemWidth:"240px",required:""}},[a("let-poptip",{attrs:{placement:"top",content:e.$t("module.namingRule"),trigger:"hover"}},[a("let-input",{attrs:{size:"small",placeholder:e.$t("module.namingRule"),required:"","required-tip":e.$t("deployService.table.tips.empty"),pattern:"^[a-zA-Z][a-zA-Z0-9]+$","pattern-tip":e.$t("module.namingRule")},model:{value:e.model.module_name,callback:function(t){e.$set(e.model,"module_name",t)},expression:"model.module_name"}})],1)],1),a("let-form-item",{attrs:{label:e.$t("module.deployArea"),itemWidth:"240px"}},[a("let-select",{attrs:{size:"small"},on:{change:e.changeSelect},model:{value:e.model.idc_area,callback:function(t){e.$set(e.model,"idc_area",t)},expression:"model.idc_area"}},e._l(e.regions,(function(t){return a("let-option",{key:t.label,attrs:{value:t.label}},[e._v(" "+e._s(t.region)+" ")])})),1)],1),a("let-form-item",{attrs:{label:e.$t("region.setArea"),itemWidth:"240px"}},[a("let-select",{attrs:{size:"small",multiple:!0},model:{value:e.model.set_area,callback:function(t){e.$set(e.model,"set_area",t)},expression:"model.set_area"}},e._l(e.setRegions,(function(t){return a("let-option",{key:t.label,attrs:{value:t.label}},[e._v(" "+e._s(t.region)+" ")])})),1)],1),a("br"),a("let-form-item",{attrs:{label:e.$t("cache.perRecordAvg"),itemWidth:"240px",required:""}},[a("let-input",{attrs:{size:"small",placeholder:e.$t("cache.perRecordAvgUnit"),required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:e.model.per_record_avg,callback:function(t){e.$set(e.model,"per_record_avg",t)},expression:"model.per_record_avg"}})],1),a("let-form-item",{attrs:{label:e.$t("cache.totalRecord"),itemWidth:"240px",required:""}},[a("let-input",{attrs:{size:"small",placeholder:e.$t("cache.dbDataCountUnit"),required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:e.model.total_record,callback:function(t){e.$set(e.model,"total_record",t)},expression:"model.total_record"}})],1),a("let-form-item",{attrs:{label:e.$t("cache.maxReadFlow"),itemWidth:"240px",required:""}},[a("let-input",{attrs:{size:"small",placeholder:e.$t("cache.flowUnit"),required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:e.model.max_read_flow,callback:function(t){e.$set(e.model,"max_read_flow",t)},expression:"model.max_read_flow"}})],1),a("let-form-item",{attrs:{label:e.$t("cache.maxWriteFlow"),itemWidth:"240px",required:""}},[a("let-input",{attrs:{size:"small",placeholder:e.$t("cache.flowUnit"),required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:e.model.max_write_flow,callback:function(t){e.$set(e.model,"max_write_flow",t)},expression:"model.max_write_flow"}})],1),a("br"),a("let-form-item",{attrs:{label:e.$t("module.scenario"),itemWidth:"240px",required:""}},[a("let-select",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:e.model.cache_module_type,callback:function(t){e.$set(e.model,"cache_module_type",t)},expression:"model.cache_module_type"}},e._l(e.cacheModuleType,(function(t){return a("let-option",{key:t.key,attrs:{value:t.key}},[e._v(" "+e._s(e.$t(t.value))+" ")])})),1)],1),1==e.model.cache_module_type?a("let-form-item",{attrs:{label:e.$t("cache.cacheType"),itemWidth:"500px",required:""}},[a("let-radio-group",{attrs:{size:"small",required:"",data:e.cacheTypeOption},model:{value:e.model.key_type,callback:function(t){e.$set(e.model,"key_type",t)},expression:"model.key_type"}})],1):e._e(),2==e.model.cache_module_type?a("let-form-item",{attrs:{label:e.$t("cache.dbAccessServantObj"),itemWidth:"240px",required:""}},[a("let-input",{attrs:{size:"small",placeholder:e.$t("cache.dbAccessServantObjEx"),required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:e.model.dbAccessServant,callback:function(t){e.$set(e.model,"dbAccessServant",t)},expression:"model.dbAccessServant"}})],1):e._e(),a("br"),a("let-form-item",{attrs:{label:e.$t("cache.moduleRemark"),itemWidth:"516px",required:""}},[a("let-input",{attrs:{size:"small",type:"textarea",rows:4,required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:e.model.module_remark,callback:function(t){e.$set(e.model,"module_remark",t)},expression:"model.module_remark"}})],1),a("div",[a("let-button",{attrs:{size:"small",theme:"primary"},on:{click:e.addModuleConfig}},[e._v(e._s(e.$t("common.nextStep")))])],1)],1)],1)},Va=[],Wa=(a("4d63"),a("ade3")),Fa=function(){var e;return e={admin:"",idc_area:"",key_type:null,module_name:"",cache_module_type:""},Object(Wa["a"])(e,"key_type",""),Object(Wa["a"])(e,"dbAccessServant",""),Object(Wa["a"])(e,"per_record_avg",""),Object(Wa["a"])(e,"total_record",""),Object(Wa["a"])(e,"max_read_flow",""),Object(Wa["a"])(e,"max_write_flow",""),Object(Wa["a"])(e,"module_remark",""),Object(Wa["a"])(e,"set_area",[]),Object(Wa["a"])(e,"module_id",""),Object(Wa["a"])(e,"apply_id",""),e},Ua=[{key:"1",value:"cache.title"},{key:"2",value:"cache.cachePersistent"}],Ja=[{key:"0",value:"string"},{key:"1",value:"int"},{key:"2",value:"longlong"}],Za={data:function(){var e=[{value:"1",text:this.$t("cache.cacheTypeTip1")},{value:"2",text:this.$t("cache.cacheTypeTip2")},{value:"3",text:this.$t("cache.cacheTypeTip3")}];return{cacheTypeOption:e,keyTypeOption:Ja,cacheModuleType:Ua,regions:[],setRegions:[],module:{cache_version:1},app_name:"",model:Fa()}},methods:{addModuleConfig:function(){var e=this,t=new RegExp("^"+this.app_name+"[a-zA-Z0-9]+$");if(t.test(this.model.module_name)){if(this.$refs.detailForm.validate()){var a=this.model,r="/server/api/add_module_config",o=this.$Loading.show();this.$ajax.postJSON(r,a).then((function(t){o.hide(),e.$tip.success(e.$t("common.success")),e.$router.push("/operation/module/serverConfig/"+t.module_id)})).catch((function(t){o.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))}}else this.$tip.error(this.$t("module.namingError"))},changeSelect:function(){var e=this;this.model.set_area=[];var t=this.regions.concat();t.splice(t.indexOf(t.find((function(t){return t.label==e.model.idc_area}))),1),this.setRegions=t},getRegionList:function(){var e=this;this.$ajax.getJSON("/server/api/get_region_list").then((function(t){t.length&&(e.regions=t)})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))},getModuleInfo:function(){var e=this,t=this.$route.params.moduleId;this.$ajax.getJSON("/server/api/get_module_info",{moduleId:t}).then((function(t){e.model.apply_id=t.apply_id,e.model.module_id=t.id,e.module=t,e.getAppName(t.apply_id)})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))},getAppName:function(e){var t=this;this.$ajax.getJSON("/server/api/get_apply_and_router_and_proxy",{applyId:e}).then((function(e){t.app_name=e.name||"",t.model.module_name=t.app_name})).catch((function(e){t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))}},created:function(){this.getRegionList(),this.getModuleInfo()}},Ba=Za,Ya=(a("ebfe"),Object(k["a"])(Ba,Ga,Va,!1,null,null,null)),Ka=Ya.exports,Qa=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"page_operation_create_service"},[a("let-form",{ref:"detailForm",attrs:{inline:""}},[a("let-form-group",{attrs:{title:e.$t("module.serverInfo"),inline:"","label-position":"top"}},[a("let-table",{ref:"table",attrs:{data:e.moduleData,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("module.name"),prop:"module_name"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.module_name)+" ")]}}])}),a("let-table-column",{attrs:{title:e.$t("module.serverGroup"),prop:"group_name"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.group_name)+" ")]}}])}),a("let-table-column",{attrs:{title:e.$t("service.serverName"),prop:"server_name"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.server_name)+" ")]}}])}),a("let-table-column",{attrs:{title:e.$t("deployService.form.serviceType"),prop:"server_type"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.mapServerType(t.row.server_type))+" ")]}}])}),a("let-table-column",{attrs:{title:e.$t("service.serverIp"),prop:"server_ip"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-input",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:t.row.server_ip,callback:function(a){e.$set(t.row,"server_ip",a)},expression:"scope.row.server_ip"}})]}}])}),a("let-table-column",{attrs:{title:e.$t("module.shmKey"),prop:"shmKey"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-input",{attrs:{size:"small",placeholder:e.$t("module.shmKeyRule"),required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:t.row.shmKey,callback:function(a){e.$set(t.row,"shmKey",a)},expression:"scope.row.shmKey"}})]}}])}),a("let-table-column",{attrs:{title:e.$t("deployService.form.template")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-select",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.form.templateTips")},model:{value:t.row.template_name,callback:function(a){e.$set(t.row,"template_name",a)},expression:"scope.row.template_name"}},e._l(e.templates,(function(t){return a("let-option",{key:t,attrs:{value:t}},[e._v(e._s(t))])})),1)]}}])}),a("let-table-column",{attrs:{title:e.$t("module.memorySize"),prop:"memory"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-input",{staticStyle:{width:"60px"},attrs:{size:"small",placeholder:e.$t("module.memorySize"),required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:t.row.memory,callback:function(a){e.$set(t.row,"memory",a)},expression:"scope.row.memory"}})]}}])}),a("let-table-column",{attrs:{title:e.$t("module.deployArea"),prop:"area"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.area)+" ")]}}])})],1)],1),a("div",[a("let-button",{attrs:{size:"small",theme:"primary"},on:{click:e.submitServerConfig}},[e._v(e._s(e.$t("common.nextStep")))])],1)],1),a("let-modal",{attrs:{title:e.$t("module.MultiKeyConfig"),width:"1000px"},on:{"on-confirm":e.submitMKCache},model:{value:e.showMKModal,callback:function(t){e.showMKModal=t},expression:"showMKModal"}},[a("let-form",{ref:"multiKeyForm",attrs:{"label-position":"top"}},[a("let-form-group",{attrs:{title:e.$t("MKCache.mainKey"),inline:"","label-position":"top"}},[a("let-table",{ref:"mainKey",attrs:{data:e.mkCacheStructure.mainKey,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("MKCache.fieldName"),prop:"fieldName",width:"30%"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-input",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:t.row.fieldName,callback:function(a){e.$set(t.row,"fieldName",a)},expression:"scope.row.fieldName"}})]}}])}),a("let-table-column",{attrs:{title:e.$t("MKCache.dataType"),prop:"dataType"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-select",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:t.row.dataType,callback:function(a){e.$set(t.row,"dataType",a)},expression:"scope.row.dataType"}},e._l(e.dataTypeOption,(function(t){return a("let-option",{key:t.key,attrs:{value:t.value}},[e._v(" "+e._s(t.value)+" ")])})),1)]}}])}),a("let-table-column",{attrs:{title:e.$t("MKCache.fieldProperty"),prop:"property",width:"15%"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.property)+" ")]}}])}),a("let-table-column",{attrs:{title:e.$t("MKCache.defaultValue"),prop:"defaultValue"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-input",{attrs:{size:"small"},model:{value:t.row.defaultValue,callback:function(a){e.$set(t.row,"defaultValue",a)},expression:"scope.row.defaultValue"}})]}}])}),a("let-table-column",{attrs:{title:e.$t("MKCache.maxLen"),prop:"maxLen"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-input",{attrs:{size:"small"},model:{value:t.row.maxLen,callback:function(a){e.$set(t.row,"maxLen",a)},expression:"scope.row.maxLen"}})]}}])})],1)],1),e.multiKey?a("let-form-group",{attrs:{title:e.$t("MKCache.unionKey"),inline:"","label-position":"top"}},[a("let-table",{ref:"unionKey",attrs:{data:e.mkCacheStructure.unionKey,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("MKCache.fieldName"),prop:"fieldName",width:"25%"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-input",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:t.row.fieldName,callback:function(a){e.$set(t.row,"fieldName",a)},expression:"scope.row.fieldName"}})]}}],null,!1,4011857556)}),a("let-table-column",{attrs:{title:e.$t("MKCache.dataType"),prop:"dataType"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-select",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:t.row.dataType,callback:function(a){e.$set(t.row,"dataType",a)},expression:"scope.row.dataType"}},e._l(e.dataTypeOption,(function(t){return a("let-option",{key:t.key,attrs:{value:t.value}},[e._v(" "+e._s(t.value)+" ")])})),1)]}}],null,!1,955089555)}),a("let-table-column",{attrs:{title:e.$t("MKCache.fieldProperty"),prop:"property",width:"15%"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.property)+" ")]}}],null,!1,2792689594)}),a("let-table-column",{attrs:{title:e.$t("MKCache.defaultValue"),prop:"defaultValue"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-input",{attrs:{size:"small"},model:{value:t.row.defaultValue,callback:function(a){e.$set(t.row,"defaultValue",a)},expression:"scope.row.defaultValue"}})]}}],null,!1,3960107341)}),a("let-table-column",{attrs:{title:e.$t("MKCache.maxLen"),prop:"maxLen"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-input",{attrs:{size:"small"},model:{value:t.row.maxLen,callback:function(a){e.$set(t.row,"maxLen",a)},expression:"scope.row.maxLen"}})]}}],null,!1,112591966)}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"15%"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:e.addUnionKey}},[e._v(e._s(e.$t("operate.add")))]),a("let-table-operation",{on:{click:function(a){return e.deleteUnionKey(t.$index)}}},[e._v(e._s(e.$t("operate.delete")))])]}}],null,!1,2523220812)})],1)],1):e._e(),a("let-form-group",{attrs:{title:e.$t("MKCache.dataValue"),inline:"","label-position":"top"}},[a("let-table",{ref:"dataValue",attrs:{data:e.mkCacheStructure.value,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("MKCache.fieldName"),prop:"fieldName",width:"25%"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-input",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:t.row.fieldName,callback:function(a){e.$set(t.row,"fieldName",a)},expression:"scope.row.fieldName"}})]}}])}),a("let-table-column",{attrs:{title:e.$t("MKCache.dataType"),prop:"dataType"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-select",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:t.row.dataType,callback:function(a){e.$set(t.row,"dataType",a)},expression:"scope.row.dataType"}},e._l(e.dataTypeOption,(function(t){return a("let-option",{key:t.key,attrs:{value:t.value}},[e._v(" "+e._s(t.value)+" ")])})),1)]}}])}),a("let-table-column",{attrs:{title:e.$t("MKCache.fieldProperty"),prop:"property",width:"15%"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-select",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:t.row.property,callback:function(a){e.$set(t.row,"property",a)},expression:"scope.row.property"}},e._l(e.propertyOption,(function(t){return a("let-option",{key:t.key,attrs:{value:t.value}},[e._v(" "+e._s(t.value)+" ")])})),1)]}}])}),a("let-table-column",{attrs:{title:e.$t("MKCache.defaultValue"),prop:"defaultValue"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-input",{attrs:{size:"small","required-tip":e.$t("deployService.table.tips.empty")},model:{value:t.row.defaultValue,callback:function(a){e.$set(t.row,"defaultValue",a)},expression:"scope.row.defaultValue"}})]}}])}),a("let-table-column",{attrs:{title:e.$t("MKCache.maxLen"),prop:"maxLen"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-input",{attrs:{size:"small","required-tip":e.$t("deployService.table.tips.empty")},model:{value:t.row.maxLen,callback:function(a){e.$set(t.row,"maxLen",a)},expression:"scope.row.maxLen"}})]}}])}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"15%"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:e.addValue}},[e._v(e._s(e.$t("operate.add")))]),a("let-table-operation",{on:{click:function(a){return e.deleteValue(t.$index)}}},[e._v(e._s(e.$t("operate.delete")))])]}}])})],1)],1)],1)],1)],1)},Ha=[],Xa=(a("2532"),[{key:"int",value:"int"},{key:"long",value:"long"},{key:"string",value:"string"},{key:"byte",value:"byte"},{key:"float",value:"float"},{key:"double",value:"double"}]),er=[{key:"require",value:"require"},{key:"optional",value:"optional"}],tr={data:function(){var e=this.$route.params.moduleId;return{moduleId:e,moduleData:[],templates:[],isMkCache:!1,multiKey:!1,dataTypeOption:Xa,propertyOption:er,showMKModal:!1,mkCacheStructure:{mainKey:[{fieldName:"",keyType:"mkey",dataType:"",property:"require",defaultValue:"",maxLen:""}],unionKey:[{fieldName:"",keyType:"ukey",dataType:"",property:"require",defaultValue:"",maxLen:""}],value:[{fieldName:"",keyType:"value",dataType:"",property:"",defaultValue:"",maxLen:""}]}}},methods:{submitServerConfig:function(){this.$refs.detailForm.validate()&&(this.isMkCache?this.showMKModal=!0:this.checkSameShmKey(this.moduleData)?this.addServerConfig():this.$tip.error(this.$t("module.shmKeyError")))},checkSameShmKey:function(e){var t=De.a.uniqWith(e,(function(e,t){return e.server_ip===t.server_ip&&e.shmKey===t.shmKey}));return console.log(t),e.length===t.length},addServerConfig:function(){var e=this,t=this.moduleData,a="/server/api/add_server_config",r=this.$Loading.show();this.$ajax.postJSON(a,t).then((function(t){r.hide(),e.$tip.success(e.$t("common.success")),e.$router.push("/operation/module/installAndPublish/"+e.moduleId)})).catch((function(t){r.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))},getModuleConfigInfo:function(){var e=this;return Object(G["a"])(regeneratorRuntime.mark((function t(){var a,r,o,s,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,ge();case 3:return a=t.sent,e.templates=a,r=e.$route.params.moduleId,t.next=8,ve({moduleId:r});case 8:o=t.sent,s=1===o.ModuleBase.cache_version?"KV":"MKV",o.group_name=o.module_name+s+"Group1",o.area=o.idc_area,o.server_name=o.module_name+s+"CacheServer1-1",o.server_type=0,o.memory=Math.ceil(o.per_record_avg*o.total_record*1e4/1024/1024/1024),e.moduleData.push(Object(E["a"])({},o)),n=Object(E["a"])({},o,{server_name:o.module_name+s+"CacheServer1-2",server_type:1}),e.moduleData.push(n),o.set_area.length>0&&o.set_area.forEach((function(t,a){var r=Object(E["a"])({},o,{area:t,server_name:o.module_name+s+"CacheServer1-"+(a+3),server_type:2});e.moduleData.push(r)})),e.moduleData=e.moduleData.map((function(e){return Object(E["a"])({},e,{template_name:a.includes("DCache.Cache")?"DCache.Cache":"tars.default"})})),e.isMkCache=2===o.ModuleBase.cache_version,e.multiKey=2===o.ModuleBase.cache_version&&1===o.ModuleBase.mkcache_struct,t.next=28;break;case 24:t.prev=24,t.t0=t["catch"](0),console.error(t.t0),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.t0.message||t.t0.err_msg));case 28:case"end":return t.stop()}}),t,null,[[0,24]])})))()},mapServerType:function(e){return 0===e?this.$t("module.mainServer"):1===e?this.$t("module.backServer"):this.$t("module.mirror")},addUnionKey:function(){this.mkCacheStructure.unionKey.push({fieldName:"",keyType:"ukey",dataType:"",property:"require",defaultValue:"",maxLen:""})},deleteUnionKey:function(e){this.mkCacheStructure.unionKey.length>1?this.mkCacheStructure.unionKey.splice(e,1):this.$tip.error(this.$t("MKCache.error"))},addValue:function(){this.mkCacheStructure.value.push({fieldName:"",keyType:"value",dataType:"",property:"",defaultValue:"",maxLen:""})},deleteValue:function(e){this.mkCacheStructure.value.length>1?this.mkCacheStructure.value.splice(e,1):this.$tip.error(this.$t("MKCache.error"))},submitMKCache:function(){this.$refs.multiKeyForm.validate()&&(sessionStorage.setItem("mkCache",JSON.stringify(this.mkCacheStructure)),this.showMKModal=!1,document.body.classList.remove("has-modal-open"),this.addServerConfig())}},created:function(){var e=this;return Object(G["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return sessionStorage.clear(),t.next=3,e.getModuleConfigInfo();case 3:case"end":return t.stop()}}),t)})))()}},ar=tr,rr=Object(k["a"])(ar,Qa,Ha,!1,null,null,null),or=rr.exports,sr=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"page_operation_install_and_publish"},[a("let-form",{ref:"detailForm",attrs:{"label-position":"top"}},[a("let-form-group",{attrs:{title:e.$t("common.baseInfo"),inline:"","label-position":"top"}},[a("let-form-item",{attrs:{label:e.$t("module.moduleId"),itemWidth:"240px",required:""}},[e._v(" "+e._s(e.moduleData.module_id)+" ")]),a("let-form-item",{attrs:{label:e.$t("module.name"),itemWidth:"240px",required:""}},[e._v(" "+e._s(e.moduleData.module_name)+" ")]),a("let-form-item",{attrs:{label:e.$t("module.cacheType"),itemWidth:"240px",required:""}},[e._v(" "+e._s(e.mapCacheType(e.moduleData.ModuleBase))+" ")]),a("let-form-item",{attrs:{label:e.$t("module.follower"),itemWidth:"240px"}},[e._v(" "+e._s(e.moduleData.ModuleBase&&e.moduleData.ModuleBase.follower)+" ")])],1),a("let-form-group",{attrs:{title:e.$t("module.moduleInfo"),inline:"","label-position":"top"}},[a("let-form-item",{attrs:{label:e.$t("module.deployArea"),itemWidth:"240px"}},[e._v(" "+e._s(e.moduleData.idc_area)+" ")]),a("let-form-item",{attrs:{label:e.$t("region.setArea"),itemWidth:"240px"}},[e._v(" "+e._s(e.moduleData.set_area&&e.moduleData.set_area.join(","))+" ")]),a("let-form-item",{attrs:{label:e.$t("module.scenario"),itemWidth:"240px",required:""}},[e._v(" "+e._s(e.mapModuleType(e.moduleData.cache_module_type))+" ")]),a("let-form-item",{attrs:{label:e.$t("cache.perRecordAvg"),itemWidth:"240px",required:""}},[e._v(" "+e._s(e.moduleData.per_record_avg)+" ")]),a("let-form-item",{attrs:{label:e.$t("cache.maxReadFlow"),itemWidth:"240px",required:""}},[e._v(" "+e._s(e.moduleData.max_read_flow)+" ")]),a("let-form-item",{attrs:{label:e.$t("cache.totalRecord"),itemWidth:"240px",required:""}},[e._v(" "+e._s(e.moduleData.total_record)+" ")]),a("let-form-item",{attrs:{label:e.$t("cache.maxWriteFlow"),itemWidth:"240px",required:""}},[e._v(" "+e._s(e.moduleData.max_write_flow)+" ")]),a("let-form-item",{attrs:{label:e.$t("cache.moduleRemark"),itemWidth:"240px",required:""}},[e._v(" "+e._s(e.moduleData.module_remark)+" ")])],1),a("let-form-group",{attrs:{title:e.$t("module.serverInfo"),inline:"","label-position":"top"}},[a("let-table",{ref:"table",attrs:{data:e.moduleData.ServerConf,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("module.name"),prop:"module_name",width:"25%"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.module_name)+" ")]}}])}),a("let-table-column",{attrs:{title:e.$t("module.serverGroup"),prop:"group_name",width:"25%"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.group_name)+" ")]}}])}),a("let-table-column",{attrs:{title:e.$t("service.serverName"),prop:"server_name"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.server_name)+" ")]}}])}),a("let-table-column",{attrs:{title:e.$t("service.serverIp"),prop:"server_ip"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.server_ip)+" ")]}}])}),a("let-table-column",{attrs:{title:e.$t("module.deployArea"),prop:"area"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.area)+" ")]}}])}),a("let-table-column",{attrs:{title:e.$t("deployService.form.serviceType"),prop:"server_type"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.mapServerType(t.row.server_type))+" ")]}}])}),a("let-table-column",{attrs:{title:e.$t("module.memorySize"),prop:"memory"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.memory)+" ")]}}])}),a("let-table-column",{attrs:{title:e.$t("module.shmKey"),prop:"shmKey"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.shmKey)+" ")]}}])})],1)],1),a("let-button",{attrs:{size:"small",theme:"primary"},on:{click:e.installAndPublish}},[e._v(e._s(e.$t("apply.installAndPublish"))+" ")])],1),a("let-modal",{attrs:{title:e.$t("publishLog.title"),width:"800px"},on:{"on-confirm":e.confirmPublish},model:{value:e.showModal,callback:function(t){e.showModal=t},expression:"showModal"}},[a("let-table",{ref:"ProgressTable",attrs:{data:e.releaseProgress,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("service.serverName"),prop:"serverName",width:"30%"}}),a("let-table-column",{attrs:{title:e.$t("service.serverIp"),prop:"nodeName",width:"30%"}}),a("let-table-column",{attrs:{title:e.$t("publishLog.releaseId"),prop:"releaseId",width:"15%"}}),a("let-table-column",{attrs:{title:e.$t("publishLog.releaseProgress"),prop:"percent"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.percent))]),100!=t.row.percent?a("icon",{staticClass:"spinner-icon",attrs:{name:"spinner"}}):e._e()]}}])})],1)],1)],1)},nr=[],lr={data:function(){var e=this.$route.params.moduleId;return{moduleId:e,moduleData:{},releaseProgress:[],showModal:!1,timerId:null}},methods:{getModuleFullInfo:function(){var e=this,t=this.moduleId;this.$ajax.getJSON("/server/api/get_module_full_info",{moduleId:t}).then((function(t){e.moduleData=t||{}})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))},installAndPublish:function(){var e=this,t=this.moduleId,a=sessionStorage.getItem("mkCache");this.$ajax.getJSON("/server/api/module_install_and_publish",{moduleId:t,mkCache:a}).then((function(t){var a=t.releaseRsp.releaseId;e.getTaskRepeat({releaseId:a}),e.$tip.success(t.releaseRsp.errMsg)})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))},getTaskRepeat:function(e){var t=this,a=e.releaseId;clearTimeout(this.timerId),this.showModal=!0;var r=function e(){t.$ajax.getJSON("/server/api/get_module_release_progress",{releaseId:a}).then((function(a){var r=!0;a.progress.forEach((function(e){100!==parseInt(e.percent,10)&&(r=!1)})),r?clearTimeout(t.timerId):t.timerId=setTimeout(e,1e3),t.releaseProgress=a.progress})).catch((function(e){clearTimeout(t.timerId),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))};r()},getReleaseProgress:function(e){var t=this;this.$ajax.getJSON("/server/api/get_module_release_progress",{releaseId:e}).then((function(e){console.log(e),t.showModal=!0,t.releaseProgress=e.progress})).catch((function(e){t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))},mapServerType:function(e){return 0===e?this.$t("module.mainServer"):1===e?this.$t("module.backServer"):this.$t("module.mirror")},mapModuleType:function(e){return 1===e?this.$t("cache.title"):this.$t("cache.cachePersistent")},mapCacheType:function(e){if(!e)return null;if(1===e.cache_version)return"key-value(KVCache)";switch(e.mkcache_struct){case 1:return"k-k-row(MKVCache)";case 2:return"Set(MKVCache)";case 3:return"List(MKVCache)";case 4:return"Zset(MKVCache)";default:return null}},confirmPublish:function(){this.showModal=!1,document.body.classList.remove("has-modal-open"),this.$router.push("/server"),window.dcacheIndex&&window.dcacheIndex.getTreeData&&window.dcacheIndex.getTreeData()}},beforeRouteLeave:function(e,t,a){clearTimeout(this.timerId),a()},created:function(){this.getModuleFullInfo()}},ir=lr,cr=(a("bb06"),Object(k["a"])(ir,sr,nr,!1,null,null,null)),dr=cr.exports,ur=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"page_operation_region"},[a("let-button",{attrs:{theme:"primary",size:"mini"},on:{click:e.addRegion}},[e._v(e._s(e.$t("region.add")))]),a("let-table",{ref:"table",attrs:{data:e.items,"empty-msg":e.$t("common.nodata"),title:e.$t("region.list")}},[a("let-table-column",{attrs:{title:e.$t("common.serial"),width:"25%"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.$index+1))]}}])}),a("let-table-column",{attrs:{title:e.$t("region.title"),prop:"region",width:"25%"}}),a("let-table-column",{attrs:{title:e.$t("region.label"),prop:"label"}}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"180px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.editRegion(t.row)}}},[e._v(e._s(e.$t("operate.update")))]),a("let-table-operation",{on:{click:function(a){return e.removeItem(t.row)}}},[e._v(e._s(e.$t("operate.delete")))])]}}])})],1),a("let-modal",{attrs:{title:e.$t(e.title),width:"600px"},on:{"on-confirm":e.saveItem},model:{value:e.showModel,callback:function(t){e.showModel=t},expression:"showModel"}},[a("let-form",{ref:"detailForm"},[a("let-form-item",{attrs:{label:e.$t("region.title"),required:""}},[a("let-input",{attrs:{size:"small",required:"",placeholder:e.$t("region.regionTips")},model:{value:e.model.region,callback:function(t){e.$set(e.model,"region",t)},expression:"model.region"}})],1),a("let-form-item",{attrs:{label:e.$t("region.label"),required:""}},[a("let-input",{attrs:{size:"small",required:"",placeholder:e.$t("region.labelTips")},model:{value:e.model.label,callback:function(t){e.$set(e.model,"label",t)},expression:"model.label"}})],1)],1)],1)],1)},mr=[],pr={data:function(){return{title:"region.add",items:[],showModel:!1,model:{}}},mounted:function(){this.fetchData()},methods:{fetchData:function(){var e=this;this.$ajax.getJSON("/server/api/get_region_list").then((function(t){e.items=t||[]})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))},addRegion:function(){this.showModel=!0,this.title="region.add",this.model={region:"",label:""}},editRegion:function(e){this.showModel=!0,this.showModel=!0,this.title="region.modify",this.model=e},saveItem:function(){var e=this;if(this.$refs.detailForm.validate()){var t=this.model,a=t.id?"/server/api/update_region":"/server/api/add_region",r=this.$Loading.show();this.$ajax.postJSON(a,t).then((function(){r.hide(),e.$tip.success(e.$t("common.success")),e.closeDetailModal(),e.fetchData()})).catch((function(t){r.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))}},removeItem:function(e){var t=this,a=e.id;this.$ajax.getJSON("/server/api/delete_region",{id:a}).then((function(e){t.$tip.success(t.$t("common.success")),t.fetchData()})).catch((function(e){t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))},closeDetailModal:function(){this.$refs.detailForm.resetValid(),this.showModel=!1,this.model={}}}},hr=pr,fr=Object(k["a"])(hr,ur,mr,!1,null,null,null),vr=fr.exports,gr=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page_operation"},[a("let-tabs",{attrs:{activekey:e.$route.matched[1]?e.$route.matched[1].path:"/operation/apply"},on:{click:e.onTabClick}},[a("let-tab-pane",{attrs:{tab:e.$t("releasePackage.proxyList"),tabkey:"/releasePackage/proxyList"}}),a("let-tab-pane",{attrs:{tab:e.$t("releasePackage.routerList"),tabkey:"/releasePackage/routerList"}}),a("let-tab-pane",{attrs:{tab:e.$t("releasePackage.cacheList"),tabkey:"/releasePackage/cacheList"}})],1),a("router-view",{staticClass:"page_operation_children"})],1)},_r=[],br={methods:{onTabClick:function(e){this.$router.replace(e)}}},$r=br,yr=(a("a4f7"),Object(k["a"])($r,gr,_r,!1,null,null,null)),kr=yr.exports,wr=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"container"},[a("div",[a("let-button",{attrs:{theme:"primary",size:"small"},on:{click:function(t){e.uploadModal.show=!e.uploadModal.show}}},[e._v(" "+e._s(e.$t("releasePackage.uploadPackage"))+" ")])],1),a("let-table",{attrs:{data:e.packages.rows,title:e.$t("serverList.title.serverList"),"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:"ID",prop:"id"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticStyle:{color:"green",display:"inline-block",width:"1em",height:"1em"},attrs:{title:e.$t("releasePackage.default")}},[1==t.row.default_version?a("icon",{attrs:{name:"default"}}):e._e()],1),e._v(" "+e._s(t.row.id)+" ")]}}])}),a("let-table-column",{attrs:{title:e.$t("releasePackage.moduleName"),prop:"server"}}),a("let-table-column",{attrs:{title:e.$t("serverList.servant.comment"),prop:"comment"}}),a("let-table-column",{attrs:{title:e.$t("releasePackage.uploadTime"),prop:"posttime"}}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"260px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.setDefault(t.row)}}},[e._v(e._s(e.$t("operate.default")))]),a("let-table-operation",{on:{click:function(a){return e.deletePackage(t.row.id)}}},[e._v(e._s(e.$t("operate.delete")))])]}}])})],1),a("let-modal",{attrs:{title:e.$t("pub.dlg.upload"),width:"880px",footShow:!1},on:{"on-cancel":e.closeUploadModal},model:{value:e.uploadModal.show,callback:function(t){e.$set(e.uploadModal,"show",t)},expression:"uploadModal.show"}},[e.uploadModal.model?a("let-form",{ref:"uploadForm",attrs:{itemWidth:"100%"},nativeOn:{submit:function(t){return t.preventDefault(),e.uploadPatchPackage(t)}}},[a("let-form-item",{attrs:{label:e.$t("releasePackage.moduleName")}},[e._v(" "+e._s(e.uploadModal.model.application)+"."+e._s(e.uploadModal.model.module_name)+" ")]),a("let-form-item",{attrs:{label:e.$t("pub.dlg.releasePkg"),itemWidth:"400px"}},[a("let-uploader",{attrs:{placeholder:e.$t("pub.dlg.defaultValue")},on:{upload:e.uploadFile}},[e._v(e._s(e.$t("common.submit"))+" ")]),e.uploadModal.model.file?a("span",[e._v(e._s(e.uploadModal.model.file.name))]):e._e()],1),a("let-form-item",{attrs:{label:e.$t("serverList.servant.comment")}},[a("let-input",{attrs:{type:"textarea",rows:3},model:{value:e.uploadModal.model.comment,callback:function(t){e.$set(e.uploadModal.model,"comment",t)},expression:"uploadModal.model.comment"}})],1),a("let-button",{attrs:{type:"submit",theme:"primary"}},[e._v(e._s(e.$t("serverList.servant.upload")))])],1):e._e()],1)],1)},Mr=[],xr=(a("3ab4"),{data:function(){return{uploadModal:{show:!1,model:{application:"DCache",module_name:"ProxyServer",file:{},comment:""}},packages:{count:0,rows:[]}}},methods:{closeUploadModal:function(){this.uploadModal.show=!1},uploadFile:function(e){this.uploadModal.model.file=e},uploadPatchPackage:function(){var e=this;if(this.$refs.uploadForm.validate()){var t=this.$Loading.show(),a=new FormData;a.append("application",this.uploadModal.model.application),a.append("module_name",this.uploadModal.model.module_name),a.append("task_id",(new Date).getTime()),a.append("suse",this.uploadModal.model.file),a.append("comment",this.uploadModal.model.comment),this.$ajax.postForm("/server/api/upload_patch_package",a).then((function(){t.hide(),e.closeUploadModal(),e.getPatchPackage()})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.message||a.err_msg))}))}},getPatchPackage:function(){var e=this;this.$ajax.getJSON("/server/api/server_patch_list",{application:"DCache",module_name:"ProxyServer"}).then((function(t){e.packages=t})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))},deletePackage:function(e){var t=this;this.$confirm(this.$t("releasePackage.confirmDeleteTip"),this.$t("common.alert")).then((function(){t.$ajax.postJSON("/server/api/delete_patch_package",{id:e}).then((function(e){t.getPatchPackage()}))})).catch((function(e){t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))},setDefault:function(e){var t=this,a=e.id,r=e.package_type;this.$ajax.postJSON("/server/api/set_patch_package_default",{id:a,package_type:r,application:this.uploadModal.model.application,module_name:this.uploadModal.model.module_name}).then((function(e){t.getPatchPackage()})).catch((function(e){t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))}},created:function(){this.getPatchPackage()}}),Sr=xr,Cr=Object(k["a"])(Sr,wr,Mr,!1,null,null,null),Nr=Cr.exports,Lr=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"container"},[a("div",[a("let-button",{attrs:{theme:"primary",size:"small"},on:{click:function(t){e.uploadModal.show=!e.uploadModal.show}}},[e._v(" "+e._s(e.$t("releasePackage.uploadPackage"))+" ")])],1),a("let-table",{attrs:{data:e.packages.rows,title:e.$t("serverList.title.serverList"),"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:"ID",prop:"id"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticStyle:{color:"green",display:"inline-block",width:"1em",height:"1em"},attrs:{title:e.$t("releasePackage.default")}},[1==t.row.default_version?a("icon",{attrs:{name:"default"}}):e._e()],1),e._v(" "+e._s(t.row.id)+" ")]}}])}),a("let-table-column",{attrs:{title:e.$t("releasePackage.moduleName"),prop:"server"}}),a("let-table-column",{attrs:{title:e.$t("serverList.servant.comment"),prop:"comment"}}),a("let-table-column",{attrs:{title:e.$t("releasePackage.uploadTime"),prop:"posttime"}}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"260px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.setDefault(t.row)}}},[e._v(e._s(e.$t("operate.default")))]),a("let-table-operation",{on:{click:function(a){return e.deletePackage(t.row.id)}}},[e._v(e._s(e.$t("operate.delete")))])]}}])})],1),a("let-modal",{attrs:{title:e.$t("pub.dlg.upload"),width:"880px",footShow:!1},on:{"on-cancel":e.closeUploadModal},model:{value:e.uploadModal.show,callback:function(t){e.$set(e.uploadModal,"show",t)},expression:"uploadModal.show"}},[e.uploadModal.model?a("let-form",{ref:"uploadForm",attrs:{itemWidth:"100%"},nativeOn:{submit:function(t){return t.preventDefault(),e.uploadPatchPackage(t)}}},[a("let-form-item",{attrs:{label:e.$t("releasePackage.moduleName")}},[e._v(" "+e._s(e.uploadModal.model.application)+"."+e._s(e.uploadModal.model.module_name)+" ")]),a("let-form-item",{attrs:{label:e.$t("pub.dlg.releasePkg"),itemWidth:"400px"}},[a("let-uploader",{attrs:{placeholder:e.$t("pub.dlg.defaultValue")},on:{upload:e.uploadFile}},[e._v(e._s(e.$t("common.submit"))+" ")]),e.uploadModal.model.file?a("span",[e._v(e._s(e.uploadModal.model.file.name))]):e._e()],1),a("let-form-item",{attrs:{label:e.$t("serverList.servant.comment")}},[a("let-input",{attrs:{type:"textarea",rows:3},model:{value:e.uploadModal.model.comment,callback:function(t){e.$set(e.uploadModal.model,"comment",t)},expression:"uploadModal.model.comment"}})],1),a("let-button",{attrs:{type:"submit",theme:"primary"}},[e._v(e._s(e.$t("serverList.servant.upload")))])],1):e._e()],1)],1)},Dr=[],Or={data:function(){return{uploadModal:{show:!1,model:{application:"DCache",module_name:"RouterServer",file:{},comment:""}},packages:{count:0,rows:[]}}},methods:{closeUploadModal:function(){this.uploadModal.show=!1},uploadFile:function(e){this.uploadModal.model.file=e},uploadPatchPackage:function(){var e=this;if(this.$refs.uploadForm.validate()){var t=this.$Loading.show(),a=new FormData;a.append("application",this.uploadModal.model.application),a.append("module_name",this.uploadModal.model.module_name),a.append("task_id",(new Date).getTime()),a.append("suse",this.uploadModal.model.file),a.append("comment",this.uploadModal.model.comment),this.$ajax.postForm("/server/api/upload_patch_package",a).then((function(){t.hide(),e.closeUploadModal(),e.getPatchPackage()})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.message||a.err_msg))}))}},getPatchPackage:function(){var e=this;this.$ajax.getJSON("/server/api/server_patch_list",{application:"DCache",module_name:"RouterServer"}).then((function(t){e.packages=t})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))},deletePackage:function(e){var t=this;this.$confirm(this.$t("releasePackage.confirmDeleteTip"),this.$t("common.alert")).then((function(){t.$ajax.postJSON("/server/api/delete_patch_package",{id:e}).then((function(e){t.getPatchPackage()}))})).catch((function(e){t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))},setDefault:function(e){var t=this,a=e.id,r=e.package_type;this.$ajax.postJSON("/server/api/set_patch_package_default",{id:a,package_type:r,application:this.uploadModal.model.application,module_name:this.uploadModal.model.module_name}).then((function(e){t.getPatchPackage()})).catch((function(e){t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))}},created:function(){this.getPatchPackage()}},Ir=Or,Tr=Object(k["a"])(Ir,Lr,Dr,!1,null,null,null),Rr=Tr.exports,jr=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"container"},[a("div",[a("let-button",{attrs:{theme:"primary",size:"small"},on:{click:function(t){e.uploadModal.show=!e.uploadModal.show}}},[e._v(" "+e._s(e.$t("releasePackage.uploadPackage"))+" ")])],1),a("let-table",{attrs:{data:e.packages.rows,title:e.$t("serverList.title.serverList"),"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:"ID",prop:"id"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticStyle:{color:"green",display:"inline-block",width:"1em",height:"1em"},attrs:{title:e.$t("releasePackage.default")}},[1==t.row.default_version?a("icon",{attrs:{name:"default"}}):e._e()],1),e._v(" "+e._s(t.row.id)+" ")]}}])}),a("let-table-column",{attrs:{title:e.$t("releasePackage.moduleName"),prop:"server"}}),a("let-table-column",{attrs:{title:e.$t("releasePackage.cacheType")},scopedSlots:e._u([{key:"default",fn:function(t){return[1==t.row.package_type?a("span",[e._v("KVCache")]):2==t.row.package_type?a("span",[e._v("MKVCache")]):e._e()]}}])}),a("let-table-column",{attrs:{title:e.$t("serverList.servant.comment"),prop:"comment"}}),a("let-table-column",{attrs:{title:e.$t("releasePackage.uploadTime"),prop:"posttime"}}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"260px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.setDefault(t.row)}}},[e._v(e._s(e.$t("operate.default")))]),a("let-table-operation",{on:{click:function(a){return e.deletePackage(t.row.id)}}},[e._v(e._s(e.$t("operate.delete")))])]}}])})],1),a("let-modal",{attrs:{title:e.$t("pub.dlg.upload"),width:"880px",footShow:!1},on:{"on-cancel":e.closeUploadModal},model:{value:e.uploadModal.show,callback:function(t){e.$set(e.uploadModal,"show",t)},expression:"uploadModal.show"}},[e.uploadModal.model?a("let-form",{ref:"uploadForm",attrs:{itemWidth:"100%"},nativeOn:{submit:function(t){return t.preventDefault(),e.uploadPatchPackage(t)}}},[a("let-form-item",{attrs:{label:e.$t("releasePackage.moduleName")}},[e._v(" "+e._s(e.uploadModal.model.application)+"."+e._s(e.uploadModal.model.module_name)+" ")]),a("let-form-item",{attrs:{label:e.$t("releasePackage.cacheType")}},[a("let-select",{attrs:{size:"small"},model:{value:e.uploadModal.model.package_type,callback:function(t){e.$set(e.uploadModal.model,"package_type",t)},expression:"uploadModal.model.package_type"}},[a("let-option",{attrs:{value:"1"}},[e._v("KVCache")]),a("let-option",{attrs:{value:"2"}},[e._v("MKVCache")])],1)],1),a("let-form-item",{attrs:{label:e.$t("pub.dlg.releasePkg"),itemWidth:"400px"}},[a("let-uploader",{attrs:{placeholder:e.$t("pub.dlg.defaultValue")},on:{upload:e.uploadFile}},[e._v(e._s(e.$t("common.submit"))+" ")]),e.uploadModal.model.file?a("span",[e._v(e._s(e.uploadModal.model.file.name))]):e._e()],1),a("let-form-item",{attrs:{label:e.$t("serverList.servant.comment")}},[a("let-input",{attrs:{type:"textarea",rows:3},model:{value:e.uploadModal.model.comment,callback:function(t){e.$set(e.uploadModal.model,"comment",t)},expression:"uploadModal.model.comment"}})],1),a("let-button",{attrs:{type:"submit",theme:"primary"}},[e._v(e._s(e.$t("serverList.servant.upload")))])],1):e._e()],1)],1)},Pr=[],Ar={data:function(){return{uploadModal:{show:!1,model:{application:"DCache",module_name:"DCacheServerGroup",package_type:"1",file:{},comment:""}},packages:{count:0,rows:[]}}},methods:{closeUploadModal:function(){this.uploadModal.show=!1},uploadFile:function(e){this.uploadModal.model.file=e},uploadPatchPackage:function(){var e=this;if(this.$refs.uploadForm.validate()){var t=this.$Loading.show(),a=new FormData;a.append("application",this.uploadModal.model.application),a.append("module_name",this.uploadModal.model.module_name),a.append("task_id",(new Date).getTime()),a.append("package_type",this.uploadModal.model.package_type),a.append("suse",this.uploadModal.model.file),a.append("comment",this.uploadModal.model.comment),this.$ajax.postForm("/server/api/upload_patch_package",a).then((function(){t.hide(),e.closeUploadModal(),e.getPatchPackage()})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.message||a.err_msg))}))}},getPatchPackage:function(){var e=this;this.$ajax.getJSON("/server/api/server_patch_list",{application:"DCache",module_name:"DCacheServerGroup"}).then((function(t){e.packages=t})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))},deletePackage:function(e){var t=this;this.$confirm(this.$t("releasePackage.confirmDeleteTip"),this.$t("common.alert")).then((function(){t.$ajax.postJSON("/server/api/delete_patch_package",{id:e}).then((function(e){t.getPatchPackage()}))})).catch((function(e){t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))},setDefault:function(e){var t=this,a=e.id,r=e.package_type;this.$ajax.postJSON("/server/api/set_patch_package_default",{id:a,package_type:r,application:this.uploadModal.model.application,module_name:this.uploadModal.model.module_name}).then((function(e){t.getPatchPackage()})).catch((function(e){t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))}},created:function(){this.getPatchPackage()}},qr=Ar,zr=Object(k["a"])(qr,jr,Pr,!1,null,null,null),Er=zr.exports,Gr=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"page_operation"},[a("let-button",{attrs:{theme:"primary",size:"small"},on:{click:e.addConfig}},[e._v(e._s(e.$t("cache.config.addConfig")))]),a("let-table",{attrs:{data:e.list,title:e.$t("cache.config.tableTitle"),"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:"ID",prop:"id"}}),a("let-table-column",{attrs:{title:e.$t("cache.config.remark"),prop:"remark"}}),a("let-table-column",{attrs:{title:e.$t("cache.config.path"),prop:"path"}}),a("let-table-column",{attrs:{title:e.$t("cache.config.item"),prop:"item"}}),a("let-table-column",{attrs:{title:e.$t("cache.config.reload"),prop:"reload"}}),a("let-table-column",{attrs:{title:e.$t("cache.config.period"),prop:"period"}}),a("let-table-column",{attrs:{title:e.$t("operate.operates")},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("let-table-operation",{on:{click:function(t){return e.editConfig(r)}}},[e._v(e._s(e.$t("operate.update")))]),a("let-table-operation",{staticClass:"danger",on:{click:function(t){return e.deleteConfig(r)}}},[e._v(e._s(e.$t("operate.delete")))])]}}])})],1),a("let-modal",{attrs:{footShow:!1,closeOnClickBackdrop:!0},model:{value:e.addConfigVisible,callback:function(t){e.addConfigVisible=t},expression:"addConfigVisible"}},[e.addConfigVisible?a("add-config",{on:{"call-back":e.getConfig}}):e._e()],1),a("let-modal",{attrs:{footShow:!1,closeOnClickBackdrop:!0},model:{value:e.editConfigVisible,callback:function(t){e.editConfigVisible=t},expression:"editConfigVisible"}},[e.editConfigVisible?a("edit-config",e._b({on:{"call-back":e.getConfig}},"edit-config",e.editConfigObj,!1)):e._e()],1)],1)},Vr=[],Wr=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",[a("let-form",{ref:"addConfigForm",attrs:{type:"medium",title:e.$t("cache.config.addConfig"),columns:2}},[a("let-form-item",{attrs:{label:e.$t("cache.config.item"),required:""}},[a("let-input",{attrs:{size:"small",required:""},model:{value:e.config.item,callback:function(t){e.$set(e.config,"item",t)},expression:"config.item"}})],1),a("let-form-item",{attrs:{label:e.$t("cache.config.path"),required:""}},[a("let-input",{attrs:{size:"small",required:""},model:{value:e.config.path,callback:function(t){e.$set(e.config,"path",t)},expression:"config.path"}})],1),a("let-form-item",{attrs:{label:e.$t("cache.config.reload"),required:""}},[a("let-input",{attrs:{size:"small",required:""},model:{value:e.config.reload,callback:function(t){e.$set(e.config,"reload",t)},expression:"config.reload"}})],1),a("let-form-item",{attrs:{label:e.$t("cache.config.period"),required:""}},[a("let-input",{attrs:{size:"small",required:""},model:{value:e.config.period,callback:function(t){e.$set(e.config,"period",t)},expression:"config.period"}})],1),a("let-form-item",{attrs:{label:e.$t("cache.config.remark"),required:""}},[a("let-input",{attrs:{size:"small",required:""},model:{value:e.config.remark,callback:function(t){e.$set(e.config,"remark",t)},expression:"config.remark"}})],1),a("br"),a("let-form-item",{attrs:{label:" "}},[a("let-button",{attrs:{theme:"primary"},on:{click:e.submit}},[e._v(e._s(e.$t("cache.add")))])],1)],1)],1)},Fr=[],Ur={data:function(){return{config:{item:"",path:"",period:"",reload:"",remark:""}}},methods:{submit:function(){var e=this;return Object(G["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.$refs.addConfigForm.validate()){t.next=13;break}return t.prev=1,t.next=4,e.$ajax.postJSON("/server/api/cache/addConfig",e.config);case 4:e.$tip.success("".concat(e.$t("cache.config.addSuccess"))),Object.assign(e.config,{item:""}),e.$emit("call-back"),t.next=13;break;case 9:t.prev=9,t.t0=t["catch"](1),console.error(t.t0),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.t0.message||t.t0.err_msg));case 13:case"end":return t.stop()}}),t,null,[[1,9]])})))()}}},Jr=Ur,Zr=Object(k["a"])(Jr,Wr,Fr,!1,null,null,null),Br=Zr.exports,Yr=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{},[a("let-form",{ref:"editConfigForm",attrs:{type:"medium",title:e.$t("cache.config.editConfig"),columns:2}},[a("let-form-item",{attrs:{label:e.$t("cache.config.reload"),required:""}},[a("let-input",{attrs:{size:"small",required:""},model:{value:e.config.reload,callback:function(t){e.$set(e.config,"reload",t)},expression:"config.reload"}})],1),a("let-form-item",{attrs:{label:e.$t("cache.config.period"),required:""}},[a("let-input",{attrs:{size:"small",required:""},model:{value:e.config.period,callback:function(t){e.$set(e.config,"period",t)},expression:"config.period"}})],1),a("let-form-item",{attrs:{label:e.$t("cache.config.remark"),required:""}},[a("let-input",{attrs:{size:"small",required:""},model:{value:e.config.remark,callback:function(t){e.$set(e.config,"remark",t)},expression:"config.remark"}})],1),a("br"),a("let-form-item",{attrs:{label:" "}},[a("let-button",{attrs:{theme:"primary"},on:{click:e.submit}},[e._v(e._s(e.$t("cache.modification")))])],1)],1)],1)},Kr=[],Qr={props:{id:{type:String,required:!0},item:{type:String,required:!0},path:{type:String,required:!0},period:{type:String,required:!0},reload:{type:String,required:!0},remark:{type:String,required:!0}},data:function(){return{config:{id:this.id,item:this.item,path:this.path,period:this.period,reload:this.reload,remark:this.remark}}},methods:{submit:function(){var e=this;return Object(G["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.$refs.editConfigForm.validate()){t.next=12;break}return t.prev=1,t.next=4,e.$ajax.postJSON("/server/api/cache/editConfig",e.config);case 4:e.$tip.success("".concat(e.$t("cache.config.addSuccess"))),e.$emit("call-back"),t.next=12;break;case 8:t.prev=8,t.t0=t["catch"](1),console.error(t.t0),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.t0.message||t.t0.err_msg));case 12:case"end":return t.stop()}}),t,null,[[1,8]])})))()}}},Hr=Qr,Xr=Object(k["a"])(Hr,Yr,Kr,!1,null,null,null),eo=Xr.exports,to={components:{AddConfig:Br,EditConfig:eo},data:function(){return{list:[],addConfigVisible:!1,editConfigVisible:!1,editConfigObj:null}},methods:{addConfig:function(){this.addConfigVisible=!0},editConfig:function(e){this.editConfigVisible=!0,this.editConfigObj=e},deleteConfig:function(e){var t=this,a=e.id;this.$confirm(this.$t("cache.config.deleteConfig"),this.$t("common.alert")).then(Object(G["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$ajax.getJSON("/server/api/cache/deleteConfig",{id:a});case 3:return e.sent,e.next=6,t.getConfig();case 6:e.next=12;break;case 8:e.prev=8,e.t0=e["catch"](0),console.error(e.t0),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.t0.message||e.t0.err_msg));case 12:case"end":return e.stop()}}),e,null,[[0,8]])}))))},getConfig:function(){var e=this;return Object(G["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$ajax.getJSON("/server/api/cache/getConfig");case 3:a=t.sent,e.list=a,t.next=11;break;case 7:t.prev=7,t.t0=t["catch"](0),console.error(t.t0),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.t0.message||t.t0.err_msg));case 11:case"end":return t.stop()}}),t,null,[[0,7]])})))()}},created:function(){var e=this;return Object(G["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:console.log("aaaaaaaaaaa"),e.getConfig();case 2:case"end":return t.stop()}}),t)})))()}},ao=to,ro=Object(k["a"])(ao,Gr,Vr,!1,null,null,null),oo=ro.exports,so=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"moduleCache"},[e.serverList?a("let-table",{ref:"serverListLoading",attrs:{data:e.serverList,title:e.$t("serverList.title.serverList"),"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("serverList.table.th.service"),prop:"server_name"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.ip"),prop:"node_name",width:"140px"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.zb"),width:"140px"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row.server_type;return["M"===r?a("span",[e._v(e._s(e.$t("cache.mainEngine")))]):"S"===r?a("span",[e._v(e._s(e.$t("cache.standByEngine")))]):"I"===r?a("span",[e._v(e._s(e.$t("cache.mirror")))]):e._e()]}}],null,!1,888927167)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.configStatus"),width:"90px"},scopedSlots:e._u([{key:"default",fn:function(e){return[a("span",{class:"active"===e.row.setting_state?"status-active":"status-off"})]}}],null,!1,3224184510)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.currStatus"),width:"65px"},scopedSlots:e._u([{key:"default",fn:function(e){return[a("span",{class:"active"===e.row.present_state?"status-active":"activating"===e.row.present_state?"status-activating":"status-off"})]}}],null,!1,4116932289)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.time")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticStyle:{"word-break":"break-word"}},[e._v(e._s(e.handleNoPublishedTime(t.row.patch_time)))])]}}],null,!1,3144837894)}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"260px"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("let-table-operation",{on:{click:function(t){return e.editServerConfig(r)}}},[e._v(e._s(e.$t("cache.config.edit")))]),a("let-table-operation",{on:{click:function(t){return e.checkServerConfigList(r)}}},[e._v(e._s(e.$t("cache.config.view")))]),a("let-table-operation",{on:{click:function(t){return e.addServerConfig(r)}}},[e._v(e._s(e.$t("cache.config.add")))])]}}],null,!1,1655738820)})],1):e._e(),a("let-table",{attrs:{data:e.showConfigList,title:e.$t("cache.config.tableTitle"),"empty-msg":e.$t("common.nodata"),stripe:!0}},[a("let-table-column",{scopedSlots:e._u([{key:"head",fn:function(t){return[a("let-checkbox",{attrs:{value:e.isCheckedAll,change:e.checkedAllChange},model:{value:e.isCheckedAll,callback:function(t){e.isCheckedAll=t},expression:"isCheckedAll"}})]}},{key:"default",fn:function(t){return[a("let-checkbox",{attrs:{value:t.row.id},model:{value:t.row.isChecked,callback:function(a){e.$set(t.row,"isChecked",a)},expression:"scope.row.isChecked"}})]}}])}),a("let-table-column",{attrs:{title:e.$t("cache.config.remark"),prop:"remark"}}),a("let-table-column",{attrs:{title:e.$t("cache.config.path"),prop:"path"}}),a("let-table-column",{attrs:{title:e.$t("cache.config.item"),prop:"item"}}),a("let-table-column",{attrs:{title:e.$t("cache.config.config_value"),prop:"config_value"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row.config_value;return[a("div",{staticStyle:{"white-space":"pre-wrap"}},[e._v(e._s(r))])]}}])}),a("let-table-column",{attrs:{title:e.$t("cache.config.modify_value"),prop:"period"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("let-input",{attrs:{size:"small",type:"textarea",rows:1},on:{focus:e.inputFocus,blur:e.inputBlur},model:{value:r.modify_value,callback:function(t){e.$set(r,"modify_value",t)},expression:"row.modify_value"}})]}}])}),a("let-table-column",{attrs:{title:e.$t("operate.operates")},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("let-table-operation",{on:{click:function(t){return e.saveConfig(r)}}},[e._v(e._s(e.$t("operate.save")))]),a("let-table-operation",{staticClass:"danger",on:{click:function(t){return e.deleteConfig(r)}}},[e._v(e._s(e.$t("operate.delete")))])]}}])}),e.total?a("let-pagination",{attrs:{slot:"pagination",total:e.total,page:e.pagination.page,"show-sums":"",sum:e.configList.length,jump:"",align:"right"},on:{change:e.changePage},slot:"pagination"}):e._e(),a("template",{slot:"operations"},[a("let-button",{attrs:{theme:"success",disabled:!e.hasCheckedItem},on:{click:e.saveConfigBatch}},[e._v(e._s(e.$t("cache.config.batchUpdate")))]),a("let-button",{attrs:{theme:"danger",disabled:!e.hasCheckedItem},on:{click:e.deleteServerConfigItemBatch}},[e._v(e._s(e.$t("cache.config.batchDelete")))]),a("let-button",{attrs:{theme:"primary"},on:{click:function(t){return e.addServerConfig({appName:e.appName,moduleName:e.moduleName})}}},[e._v(e._s(e.$t("cache.config.addModuleConfig")))])],1)],2),a("let-modal",{staticClass:"server_config_list_modal",attrs:{footShow:!1,closeOnClickBackdrop:!0,width:"80%",height:"80%",title:e.$t("cache.config.tableTitle")},model:{value:e.serverConfigListVisible,callback:function(t){e.serverConfigListVisible=t},expression:"serverConfigListVisible"}},[e.serverConfigListVisible?a("server-config-list",e._b({attrs:{moduleName:e.moduleName}},"server-config-list",e.checkServer,!1)):e._e()],1),a("let-modal",{staticClass:"server_config_list_modal",attrs:{footShow:!1,closeOnClickBackdrop:!0,width:"80%",height:"80%",title:e.$t("cache.config.tableTitle")},model:{value:e.serverConfigVisible,callback:function(t){e.serverConfigVisible=t},expression:"serverConfigVisible"}},[e.serverConfigVisible?a("server-config",e._b({},"server-config",e.checkServer,!1)):e._e()],1),a("let-modal",{attrs:{footShow:!1,closeOnClickBackdrop:!0},model:{value:e.addServerConfigVisible,callback:function(t){e.addServerConfigVisible=t},expression:"addServerConfigVisible"}},[e.addServerConfigVisible?a("add-server-config",e._b({on:{"call-back":e.getModuleConfig}},"add-server-config",e.checkServer,!1)):e._e()],1)],1)},no=[],lo=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",[a("let-table",{attrs:{data:e.configList,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("cache.config.remark"),prop:"remark"}}),a("let-table-column",{attrs:{title:e.$t("cache.config.path"),prop:"path"}}),a("let-table-column",{attrs:{title:e.$t("cache.config.item"),prop:"item"}}),a("let-table-column",{attrs:{title:e.$t("cache.config.value"),prop:"config_value"}})],1)],1)},io=[],co={props:{moduleName:{type:String,required:!0},serverName:{type:String,required:!0},nodeName:{type:String,required:!0}},data:function(){return{configList:[]}},methods:{getServerConfig:function(){var e=this;return Object(G["a"])(regeneratorRuntime.mark((function t(){var a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,a={moduleName:e.moduleName,serverName:e.serverName,nodeName:e.nodeName},t.next=4,e.$ajax.getJSON("/server/api/cache/getServerConfig",a);case 4:r=t.sent,e.configList=r.filter((function(e){var t=r.filter((function(t){return t.path===e.path&&t.item===e.item})),a=t[t.length-1];return e===a})),t.next=12;break;case 8:t.prev=8,t.t0=t["catch"](0),console.error(t.t0),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.t0.message||t.t0.err_msg));case 12:case"end":return t.stop()}}),t,null,[[0,8]])})))()}},created:function(){this.getServerConfig()}},uo=co,mo=Object(k["a"])(uo,lo,io,!1,null,null,null),po=mo.exports,ho=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",[a("let-table",{attrs:{data:e.configList,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("cache.config.remark"),prop:"remark"}}),a("let-table-column",{attrs:{title:e.$t("cache.config.path"),prop:"path"}}),a("let-table-column",{attrs:{title:e.$t("cache.config.item"),prop:"item"}}),a("let-table-column",{attrs:{title:e.$t("cache.config.value"),prop:"config_value"}}),a("let-table-column",{attrs:{title:e.$t("cache.config.modify_value"),prop:"config_value"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("let-input",{attrs:{size:"small"},model:{value:r.modify_value,callback:function(t){e.$set(r,"modify_value",t)},expression:"row.modify_value"}})]}}])}),a("let-table-column",{attrs:{title:e.$t("operate.operates")},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("let-table-operation",{on:{click:function(t){return e.saveConfig(r)}}},[e._v(e._s(e.$t("operate.save")))]),a("let-table-operation",{staticClass:"danger",on:{click:function(t){return e.deleteConfig(r)}}},[e._v(e._s(e.$t("operate.delete")))])]}}])})],1)],1)},fo=[],vo={props:{serverName:{type:String,required:!0},nodeName:{type:String,required:!0}},data:function(){return{configList:[]}},methods:{getServerConfig:function(){var e=this;return Object(G["a"])(regeneratorRuntime.mark((function t(){var a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,a={serverName:e.serverName,nodeName:e.nodeName},t.next=4,e.$ajax.getJSON("/server/api/cache/getServerNodeConfig",a);case 4:r=t.sent,r.forEach((function(e){return e.modify_value=""})),e.configList=r,t.next=13;break;case 9:t.prev=9,t.t0=t["catch"](0),console.error(t.t0),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.t0.message||t.t0.err_msg));case 13:case"end":return t.stop()}}),t,null,[[0,9]])})))()},deleteConfig:function(e){var t=this,a=e.id;this.$confirm(this.$t("cache.config.deleteConfig"),this.$t("common.alert")).then(Object(G["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$ajax.getJSON("/server/api/cache/deleteServerConfigItem",{id:a});case 3:return e.sent,e.next=6,t.getServerConfig();case 6:e.next=12;break;case 8:e.prev=8,e.t0=e["catch"](0),console.error(e.t0),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.t0.message||e.t0.err_msg));case 12:case"end":return e.stop()}}),e,null,[[0,8]])}))))},saveConfig:function(e){var t=this,a=e.id,r=e.modify_value;return Object(G["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$ajax.getJSON("/server/api/cache/updateServerConfigItem",{id:a,configValue:r});case 3:return e.sent,e.next=6,t.getServerConfig();case 6:e.next=12;break;case 8:e.prev=8,e.t0=e["catch"](0),console.error(e.t0),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.t0.message||e.t0.err_msg));case 12:case"end":return e.stop()}}),e,null,[[0,8]])})))()}},created:function(){this.getServerConfig()}},go=vo,_o=Object(k["a"])(go,ho,fo,!1,null,null,null),bo=_o.exports,$o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",[a("let-form",{ref:"addConfigForm",attrs:{type:"medium",title:e.$t("cache.config.addConfig")}},[a("let-form-item",{attrs:{label:e.$t("cache.config.item"),required:""}},[a("let-select",{attrs:{size:"small"},model:{value:e.itemId,callback:function(t){e.itemId=t},expression:"itemId"}},e._l(e.list,(function(t){return a("let-option",{key:t.id,attrs:{value:t.id}},[e._v(e._s(t.path)+"__"+e._s(t.item)+"("+e._s(t.remark)+")")])})),1)],1),a("let-form-item",{attrs:{label:e.$t("cache.config.itemValue"),required:""}},[a("let-input",{attrs:{size:"small",required:""},model:{value:e.configValue,callback:function(t){e.configValue=t},expression:"configValue"}})],1),a("br"),a("let-form-item",{attrs:{label:" "}},[a("let-button",{attrs:{theme:"primary"},on:{click:e.submit}},[e._v(e._s(e.$t("cache.add")))])],1)],1)],1)},yo=[],ko={props:{serverName:{type:String,required:!1},nodeName:{type:String,required:!1},appName:{type:String,required:!1},moduleName:{type:String,required:!1}},computed:{isModule:function(){return!(!this.appName||!this.moduleName)}},data:function(){return{itemId:"",list:[],configValue:""}},methods:{submit:function(){var e=this;return Object(G["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.$refs.addConfigForm.validate()){t.next=16;break}return t.prev=1,a={itemId:e.itemId,configValue:e.configValue,serverName:e.serverName,nodeName:e.nodeName,appName:e.appName,moduleName:e.moduleName},t.next=5,e.$ajax.postJSON("/server/api/cache/addServerConfigItem",a);case 5:e.$tip.success("".concat(e.$t("cache.config.addSuccess"))),e.configValue="",e.itemId="",e.getConfig(),e.moduleName&&e.$emit("call-back"),t.next=16;break;case 12:t.prev=12,t.t0=t["catch"](1),console.error(t.t0),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.t0.message||t.t0.err_msg));case 16:case"end":return t.stop()}}),t,null,[[1,12]])})))()},getConfig:function(){var e=this;return Object(G["a"])(regeneratorRuntime.mark((function t(){var a,r,o,s,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,ue();case 3:if(a=t.sent,r=e.isModule,o=e.appName,s=e.moduleName,!r){t.next=10;break}return t.next=8,de({appName:o,moduleName:s});case 8:n=t.sent,a=a.filter((function(e){var t=n.filter((function(t){return"".concat(t.path,"__").concat(t.item)==="".concat(e.path,"__").concat(e.item)})).length;return!t}));case 10:e.list=a,t.next=17;break;case 13:t.prev=13,t.t0=t["catch"](0),console.error(t.t0),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.t0.message||t.t0.err_msg));case 17:case"end":return t.stop()}}),t,null,[[0,13]])})))()}},created:function(){this.getConfig(),window.config=this}},wo=ko,Mo=Object(k["a"])(wo,$o,yo,!1,null,null,null),xo=Mo.exports,So={components:{ServerConfigList:po,ServerConfig:bo,addServerConfig:xo},data:function(){return{appName:"",moduleName:"",configList:[],serverList:[],serverConfigListVisible:!1,serverConfigVisible:!1,addServerConfigVisible:!1,checkServer:{},isCheckedAll:!1,pagination:{page:1}}},computed:{showConfigList:function(){return this.configList.slice(10*(this.pagination.page-1),10*this.pagination.page)},total:function(){return Math.ceil(this.configList.length/10)},hasCheckedItem:function(){return 0!==this.showConfigList.filter((function(e){return!0===e.isChecked})).length}},watch:{isCheckedAll:function(){var e=this.isCheckedAll;this.showConfigList.forEach((function(t){t.isChecked=e}))}},methods:{checkedAllChange:function(){console.log(arguments)},changePage:function(e){this.pagination.page=e},inputFocus:function(e){e.target.rows=4},inputBlur:function(e){e.target.rows=1},getModuleConfig:function(){var e=this;return Object(G["a"])(regeneratorRuntime.mark((function t(){var a,r,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,a=e.appName,r=e.moduleName,t.next=4,de({appName:a,moduleName:r});case 4:o=t.sent,o.forEach((function(e){e.modify_value="",e.isChecked=!1})),e.configList=o,t.next=13;break;case 9:t.prev=9,t.t0=t["catch"](0),console.error(t.t0),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.t0.message||t.t0.err_msg));case 13:case"end":return t.stop()}}),t,null,[[0,9]])})))()},getServerList:function(){var e=this;return Object(G["a"])(regeneratorRuntime.mark((function t(){var a,r,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,a=e.appName,r=e.moduleName,t.next=4,ce({appName:a,moduleName:r});case 4:o=t.sent,e.serverList=o,t.next=12;break;case 8:t.prev=8,t.t0=t["catch"](0),console.error(t.t0),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.t0.message||t.t0.err_msg));case 12:case"end":return t.stop()}}),t,null,[[0,8]])})))()},saveConfig:function(e){var t=this;return Object(G["a"])(regeneratorRuntime.mark((function a(){var r,o;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=e.id,o=e.modify_value,a.prev=1,a.next=4,t.$ajax.getJSON("/server/api/cache/updateServerConfigItem",{id:r,configValue:o});case 4:return a.sent,a.next=7,t.getModuleConfig();case 7:a.next=13;break;case 9:a.prev=9,a.t0=a["catch"](1),console.error(a.t0),t.$tip.error("".concat(t.$t("common.error"),": ").concat(a.t0.message||a.t0.err_msg));case 13:case"end":return a.stop()}}),a,null,[[1,9]])})))()},saveConfigBatch:function(){var e=this;return Object(G["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.showConfigList.filter((function(e){return e.isChecked})).map((function(e){return{indexId:e.id,configValue:e.modify_value}})),t.prev=1,t.next=4,e.$ajax.postJSON("/server/api/cache/updateServerConfigItemBatch",{serverConfigList:a});case 4:return t.sent,t.next=7,e.getModuleConfig();case 7:t.next=13;break;case 9:t.prev=9,t.t0=t["catch"](1),console.error(t.t0),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.t0.message||t.t0.err_msg));case 13:case"end":return t.stop()}}),t,null,[[1,9]])})))()},deleteConfig:function(e){var t=this,a=e.id;this.$confirm(this.$t("cache.config.deleteConfig"),this.$t("common.alert")).then(Object(G["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$ajax.getJSON("/server/api/cache/deleteServerConfigItem",{id:a});case 3:return e.sent,e.next=6,t.getModuleConfig();case 6:e.next=12;break;case 8:e.prev=8,e.t0=e["catch"](0),console.error(e.t0),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.t0.message||e.t0.err_msg));case 12:case"end":return e.stop()}}),e,null,[[0,8]])}))))},deleteServerConfigItemBatch:function(e){var t=this,a=(e.id,this.showConfigList.filter((function(e){return e.isChecked})).map((function(e){return{indexId:e.id}})));this.$confirm(this.$t("cache.config.deleteConfig"),this.$t("common.alert")).then(Object(G["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$ajax.postJSON("/server/api/cache/deleteServerConfigItemBatch",{serverConfigList:a});case 3:return e.sent,e.next=6,t.getModuleConfig();case 6:e.next=12;break;case 8:e.prev=8,e.t0=e["catch"](0),console.error(e.t0),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.t0.message||e.t0.err_msg));case 12:case"end":return e.stop()}}),e,null,[[0,8]])}))))},handleNoPublishedTime:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.$t("pub.dlg.unpublished");return"0000:00:00 00:00:00"===e?t:e},checkServerConfigList:function(e){this.serverConfigListVisible=!0,this.checkServer={serverName:e.server_name,nodeName:e.node_name}},editServerConfig:function(e){this.serverConfigVisible=!0,this.checkServer={serverName:e.server_name,nodeName:e.node_name}},addServerConfig:function(e){this.addServerConfigVisible=!0,this.checkServer={serverName:e.server_name,nodeName:e.node_name,moduleName:e.moduleName,appName:e.appName}}},created:function(){var e=this.$parent.getServerData(),t=e.application,a=e.module_name;this.appName=t,this.moduleName=a,this.getModuleConfig(),this.getServerList()}},Co=So,No=(a("82b4"),Object(k["a"])(Co,so,no,!1,null,null,null)),Lo=No.exports,Do=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"operation-manage"},[a("let-tabs",{attrs:{activekey:e.$route.path},on:{click:e.onTabClick}},[a("let-tab-pane",{attrs:{tab:e.$t("dcache.operationManage.expand"),tabkey:"/operationManage/expand"}}),a("let-tab-pane",{attrs:{tab:e.$t("dcache.operationManage.shrinkage"),tabkey:"/operationManage/shrinkage"}}),a("let-tab-pane",{attrs:{tab:e.$t("dcache.operationManage.migration"),tabkey:"/operationManage/migration"}}),a("let-tab-pane",{attrs:{tab:e.$t("dcache.operationManage.mainBackup"),tabkey:"/operationManage/mainBackup"}})],1),a("router-view",{staticClass:"operation-manage-children"})],1)},Oo=[],Io={methods:{onTabClick:function(e){this.$router.replace(e)}}},To=Io,Ro=(a("e8b0"),Object(k["a"])(To,Do,Oo,!1,null,null,null)),jo=Ro.exports,Po=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("let-table",{ref:"pageTable",attrs:{data:e.showList,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("dcache.operationManage.appName"),prop:"appName"}}),a("let-table-column",{attrs:{title:e.$t("dcache.operationManage.moduleName"),prop:"moduleName"}}),a("let-table-column",{attrs:{title:e.$t("dcache.operationManage.srcGroupName"),prop:"srcGroupName"}}),a("let-table-column",{attrs:{title:e.$t("dcache.operationManage.dstGroupName"),prop:"dstGroupName"}}),a("let-table-column",{attrs:{title:e.$t("dcache.operationManage.status"),prop:"status"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e.$t(a.statusText))+" ")]}}])}),a("let-table-column",{attrs:{title:e.$t("dcache.operationManage.beginTime"),prop:"beginTime"}}),a("let-table-column",{attrs:{title:e.$t("dcache.operationManage.progress"),prop:"progress"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.progressText)+" ")]}}])}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),prop:"appName",width:"120px"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[3===r.status?a("let-table-operation",{on:{click:function(t){return e.ensureStop(r)}}},[e._v(e._s(e.$t("operate.stop")))]):e._e(),3!==r.status?a("let-table-operation",{on:{click:function(t){return e.ensureDelete(r)}}},[e._v(e._s(e.$t("operate.delete")))]):e._e(),5===r.status?a("let-table-operation",{on:{click:function(t){return e.restartDask(r)}}},[e._v(e._s(e.$t("operate.retry")))]):e._e()]}}])}),a("let-pagination",{attrs:{slot:"pagination",align:"right",total:e.total,page:e.page},on:{change:e.changePage},slot:"pagination"})],1)],1)},Ao=[],qo={data:function(){return{list:[],total:0,page:1}},computed:{showList:function(){var e=this.page,t=this.list;return t.slice(10*(e-1),10*e)},type:function(){var e={expand:"1",shrinkage:"2",migration:"0"};return e[this.$route.params.type]||"1"}},methods:{getRouterChange:function(){var e=this;return Object(G["a"])(regeneratorRuntime.mark((function t(){var a,r,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,X({type:e.type});case 3:a=t.sent,r=a.totalNum,o=a.transferRecord,e.list=o.map((function(e){return e.statusText="dcache.operationManage.statusText."+e.status,e.progressText=e.progress+"%",e})),e.total=Math.ceil(r/10),t.next=14;break;case 10:t.prev=10,t.t0=t["catch"](0),console.error(t.t0),e.$tip.error(t.t0.message);case 14:case"end":return t.stop()}}),t,null,[[0,10]])})))()},changePage:function(e){this.page=e},ensureStop:function(e){var t=this;return Object(G["a"])(regeneratorRuntime.mark((function a(){var r,o,s,n,l;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,t.$confirm(t.$t("dcache.operationManage.ensureStop"));case 3:return console.log("ensure stop",e),r=e.appName,o=e.moduleName,s=e.type,n=e.srcGroupName,l=e.dstGroupName,a.next=7,te({appName:r,moduleName:o,type:s,srcGroupName:n,dstGroupName:l});case 7:t.getRouterChange(),a.next=14;break;case 10:a.prev=10,a.t0=a["catch"](0),console.error(a.t0),t.$tip.error(a.t0.message);case 14:case"end":return a.stop()}}),a,null,[[0,10]])})))()},ensureDelete:function(e){var t=this;return Object(G["a"])(regeneratorRuntime.mark((function a(){var r,o,s,n,l;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,t.$confirm(t.$t("dcache.operationManage.ensureDelete"));case 3:return console.log("ensure delete",e),r=e.appName,o=e.moduleName,s=e.type,n=e.srcGroupName,l=e.dstGroupName,a.next=7,re({appName:r,moduleName:o,type:s,srcGroupName:n,dstGroupName:l});case 7:t.getRouterChange(),a.next=14;break;case 10:a.prev=10,a.t0=a["catch"](0),console.error(a.t0),t.$tip.error(a.t0.message);case 14:case"end":return a.stop()}}),a,null,[[0,10]])})))()},restartDask:function(e){var t=this;return Object(G["a"])(regeneratorRuntime.mark((function a(){var r,o,s,n,l;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,t.$confirm(t.$t("dcache.operationManage.ensureRestart"));case 3:return r=e.appName,o=e.moduleName,s=e.type,n=e.srcGroupName,l=e.dstGroupName,a.next=6,ae({appName:r,moduleName:o,type:s,srcGroupName:n,dstGroupName:l});case 6:t.getRouterChange(),a.next=13;break;case 9:a.prev=9,a.t0=a["catch"](0),console.error(a.t0),t.$tip.error(a.t0.message);case 13:case"end":return a.stop()}}),a,null,[[0,9]])})))()}},beforeRouteUpdate:function(e,t,a){a(),this.getRouterChange()},created:function(){this.getRouterChange()}},zo=qo,Eo=Object(k["a"])(zo,Po,Ao,!1,null,null,null),Go=Eo.exports,Vo=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("let-table",{ref:"pageTable",attrs:{data:e.showList,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("dcache.operationManage.appName"),prop:"appName"}}),a("let-table-column",{attrs:{title:e.$t("dcache.operationManage.moduleName"),prop:"moduleName"}}),a("let-table-column",{attrs:{title:e.$t("dcache.operationManage.groupName"),prop:"groupName"}}),a("let-table-column",{attrs:{title:e.$t("dcache.operationManage.switchTime"),prop:"switchTime"}}),a("let-table-column",{attrs:{title:e.$t("dcache.operationManage.modifyTime"),prop:"modifyTime"}}),a("let-table-column",{attrs:{title:e.$t("dcache.operationManage.switchType"),prop:"switchType"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row.switchType;return[a("span",{style:{color:e.color[r]}},[e._v(e._s(e.$t("dcache."+e.switchTypeText[r])))])]}}])}),a("let-table-column",{attrs:{title:e.$t("dcache.operationManage.switchResult"),prop:"switchResult"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row.switchResult;return[a("span",{style:{color:e.color[r]}},[e._v(e._s(e.$t("dcache."+e.switchResultText[r])))])]}}])}),a("let-table-column",{attrs:{title:e.$t("dcache.operationManage.groupStatus"),prop:"groupStatus"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row.groupStatus;return[a("span",{style:{color:e.color[r]}},[e._v(e._s(e.$t("dcache."+e.groupStatusText[r])))])]}}])}),a("let-table-column",{attrs:{title:e.$t("dcache.operationManage.switchMethod"),prop:"switchProperty"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row.switchProperty;return[a("span",[e._v(e._s(e.$t("dcache."+e.switchPropertyText[r])))])]}}])}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),prop:"appName",width:"100px"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("let-table-operation",{attrs:{title:e.$t("dcache.areset"),disabled:!(2===r.switchType&&2===r.groupStatus)},on:{click:function(t){return e.recoverMirrorStatus(r)}}},[e._v(e._s(e.$t("dcache.oreset")))])]}}])}),a("let-pagination",{attrs:{slot:"pagination",align:"right",total:e.total,page:e.page},on:{change:e.changePage},slot:"pagination"})],1)],1)},Wo=[],Fo={data:function(){return{list:[],total:0,page:1,switchTypeText:["switch","mirrorSwitch","mirrorOffSwitch","readFail"],switchResultText:["switching","switchSuccess","notSwitch","switchFailure"],groupStatusText:["rw","ro","imageUnavailable"],switchPropertyText:{auto:"auto",manual:"manual"},color:["#00AA90","#6accab","#9096a3","#f56c77"]}},computed:{showList:function(){var e=this.page,t=this.list;return t.slice(10*(e-1),10*e)}},methods:{getSwitchInfo:function(){var e=this;return Object(G["a"])(regeneratorRuntime.mark((function t(){var a,r,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,ne({});case 3:a=t.sent,r=a.totalNum,o=a.switchRecord,e.list=o.map((function(e){return e})),e.total=Math.ceil(r/10),t.next=14;break;case 10:t.prev=10,t.t0=t["catch"](0),console.error(t.t0),e.$tip.error(t.t0.message);case 14:case"end":return t.stop()}}),t,null,[[0,10]])})))()},changePage:function(e){this.page=e},switchServer:function(e){var t=this;return Object(G["a"])(regeneratorRuntime.mark((function a(){var r,o,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,r=e.appName,o=e.moduleName,s=e.groupName,a.next=4,se({appName:r,moduleName:o,groupName:s});case 4:t.getSwitchInfo(),a.next=11;break;case 7:a.prev=7,a.t0=a["catch"](0),console.error(a.t0),t.$tip.error(a.t0.message);case 11:case"end":return a.stop()}}),a,null,[[0,7]])})))()},recoverMirrorStatus:function(e){var t=this;return Object(G["a"])(regeneratorRuntime.mark((function a(){var r,o,s,n,l,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(2!==e.switchType){a.next=14;break}if(a.prev=1,r=e.appName,o=e.moduleName,s=e.groupName,n=e.mirrorIdc,l=e.dbFlag,i=e.enableErase,n){a.next=5;break}throw new Error(t.$t("dcache.mirrorEmpty"));case 5:return a.next=7,le({appName:r,moduleName:o,groupName:s,mirrorIdc:n,dbFlag:l,enableErase:i});case 7:t.getSwitchInfo(),a.next=14;break;case 10:a.prev=10,a.t0=a["catch"](1),console.error(a.t0),t.$tip.error(a.t0.message);case 14:case"end":return a.stop()}}),a,null,[[1,10]])})))()}},created:function(){this.getSwitchInfo()}},Uo=Fo,Jo=Object(k["a"])(Uo,Vo,Wo,!1,null,null,null),Zo=Jo.exports;r["default"].use(D["a"]);var Bo=new D["a"]({routes:[{path:"/server",name:"Server",component:P,children:[{path:":treeid/manage",component:Se},{path:":treeid/manage/:serverType",component:Se},{path:":treeid/publish/:serverType",component:Et},{path:":treeid/config/:serverType",component:Gt["a"]},{path:":treeid/server-monitor/:serverType",component:Vt["a"]},{path:":treeid/property-monitor/:serverType",component:Wt["a"]},{path:":treeid/interface-debuger/:serverType",component:Ut["a"]},{path:":treeid/user-manage/:serverType",component:Ft["a"]},{path:":treeid/cache",component:wt},{path:":treeid/moduleCache",component:Lo},{path:":treeid/propertyMonitor",component:Rt,fn:"特性监控"}]},{path:"/operation",name:"Operation",component:Qt,redirect:"/operation/apply",children:[{path:"apply",name:"apply",component:ra,redirect:"/operation/apply/createApply",children:[{path:"createApply",component:da},{path:"createService/:applyId",component:_a},{path:"installAndPublish/:applyId",component:Sa}]},{path:"module",component:Ia,redirect:"/operation/module/createModule",children:[{path:"createModule",component:Ea},{path:"moduleConfig/:moduleId",component:Ka},{path:"serverConfig/:moduleId",component:or},{path:"installAndPublish/:moduleId",component:dr}]},{path:"region",name:"region",component:vr}]},{path:"/releasePackage",name:"releasePackage",component:kr,redirect:"/releasePackage/proxyList",children:[{path:"proxyList",component:Nr},{path:"routerList",component:Rr},{path:"cacheList",component:Er}]},{path:"/config",component:oo},{path:"/operationManage",name:"operationManage",component:jo,redirect:"/operationManage/expand",children:[{path:"mainBackup",component:Zo},{path:":type",component:Go}]},{path:"*",redirect:"/server"}],scrollBehavior:function(e,t,a){return{x:0,y:0}}});r["default"].config.productionTip=!1,b["b"].call(void 0).then((function(){new r["default"]({i18n:b["a"],el:"#app",router:Bo,components:{App:L},template:"<App/>"})}))},"2ff6":function(e,t,a){e.exports=a.p+"img/spinner.dee5f891.svg"},"30e5":function(e,t,a){},3331:function(e,t,a){},3779:function(e,t,a){},"3ab4":function(e,t,a){e.exports=a.p+"img/default.c68b0cc8.svg"},"3e1a":function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA4RpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQ1IDc5LjE2MzQ5OSwgMjAxOC8wOC8xMy0xNjo0MDoyMiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1ZDFiOTQyYS0zZWUyLTkxNGQtOTBiYS1iZTVkYzNjOTU1OTAiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6NzZBQzM5NkM2MUUwMTFFQUE2QjFBQzg4RDAwMDRCRDQiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NzZBQzM5NkI2MUUwMTFFQUE2QjFBQzg4RDAwMDRCRDQiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTkgKFdpbmRvd3MpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6NjEwODNhYzItNzY4Yy02MjRkLWEyYWMtYTFiMTdmOTZhZmZhIiBzdFJlZjpkb2N1bWVudElEPSJhZG9iZTpkb2NpZDpwaG90b3Nob3A6NzRmMzZhYTgtODFhOC04ZTQ5LWExN2UtMDI2MDYwMWE2ZGMwIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+FAOt6wAAAWlJREFUeNrsWUEOwiAQhIY3mNSLj/CqD/DiyR9YX2X8gScP+gD16CM8WBs/gTRBU5ulLlCgVTbZNC2ddroMC0sp55z0yRLSM+sdYWYKXO+u5WEmfCM8RcLuwpfCD6v5KEiEdcgSee8mSIQrBMj2MqCYmxfjB9f8QKcaLuWRC+c1z2Vb5wadSh7WMnBFODVsi3k4Eu4K4XtDW9FFwpmC2E3ObmGnZsD2bWYDV4RLGaRyBsNaEVISmSYBa3kwRzJ4RZy2LQnadsUhl51vwqbLyJ/Jw8oIy0iZmrUkVD3DkC+2Ja4dyL+r6agnSfCfG3T9zBINGYEHkgRVZY7kSwFZfZCqoISwdRwWC+E+sK8I55qbIcPKuTesiPCQ6ewvVPcVyu6RUvKKhQbdEeiSIzIKzrEQ4QnyGgmBjXk4EkYQPgHXzsjnOcdCi5+pRQCcY5lB9VtYVM7W2ESz+oWqXq9YGn97RcKRsF97CjAAb0qmeUJR5DMAAAAASUVORK5CYII="},"42b8":function(e,t,a){"use strict";var r=a("1439"),o=a.n(r);o.a},"44bd":function(e,t,a){},4888:function(e,t,a){},"4d18":function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA4RpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQ1IDc5LjE2MzQ5OSwgMjAxOC8wOC8xMy0xNjo0MDoyMiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1ZDFiOTQyYS0zZWUyLTkxNGQtOTBiYS1iZTVkYzNjOTU1OTAiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6NzY2QzI2NEY2MUUwMTFFQUE2QjFBQzg4RDAwMDRCRDQiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NzY2QzI2NEU2MUUwMTFFQUE2QjFBQzg4RDAwMDRCRDQiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTkgKFdpbmRvd3MpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6NjEwODNhYzItNzY4Yy02MjRkLWEyYWMtYTFiMTdmOTZhZmZhIiBzdFJlZjpkb2N1bWVudElEPSJhZG9iZTpkb2NpZDpwaG90b3Nob3A6NzRmMzZhYTgtODFhOC04ZTQ5LWExN2UtMDI2MDYwMWE2ZGMwIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+5sw1KwAAAedJREFUeNpi/P//P8NQAkwMQwyMOnjUwWiAhRLNszc9ROayAXEGEEcCsQ5U7AoQLwfiGUD8C6Yw1U9+YByMBKSBeAsQG6CJW0BxIhD7APHTwZAk2JAcexuIQ4BYAIpDoGIgua1AzD4YHJwOddBNIDYD4rVA/BGK10LFQHL6QJxGqWWM2CoOtLRJCByHRnswEK/DoSYI6vgTQGxJrMHY0joTnmieCMTvgPg/AWwB1bMWj5q1SGmakHnvoHazkZLpuoA4b4BKLkGo3d+BuIJYB8dCads1Z8WO0NO1IcavbIDUYVCKwOZgXElCCERAHesJxM+IiEpKMcgOT6QAEiK3lJgLxJJ0CFxJqF0UF2uSdEwRktRw8GjjZ9TBQ715yThkHAwsxDHEgOUkA6l6BkOSOIyl4D88KJIEjhC1wSVGKAaIqJqpEsLoIYoLUFI1Hx5qpQQjtUoJcKsNS0gOSInCQmqagqbRI1jS8VF6lBLk9pptiVVI7WKQhdq5GE+mRY+RI6R4nNJijVRAdDFIq2KNVExMMTharFECqFYMstAok9GsGGShU3TbUssgXA5+B+1m20BDh2aNGSzAGskNRGe6xVQqHcjBsACaQ0oIl0EzRCx06Iie4D00wGqx5tLRaa9RB486mL4AIMAA17Dgy9SYTKQAAAAASUVORK5CYII="},"4ff0":function(e,t,a){"use strict";var r=a("4888"),o=a.n(r);o.a},7288:function(e,t,a){},"82b4":function(e,t,a){"use strict";var r=a("f3ba"),o=a.n(r);o.a},"8c1c":function(e,t,a){"use strict";var r=a("30e5"),o=a.n(r);o.a},"95be":function(e,t,a){},"9e5a":function(e,t,a){},a4f7:function(e,t,a){"use strict";var r=a("7288"),o=a.n(r);o.a},a8af:function(e,t,a){"use strict";var r=a("f3d5"),o=a.n(r);o.a},af6d:function(e,t,a){},bb06:function(e,t,a){"use strict";var r=a("1dcc"),o=a.n(r);o.a},bd18:function(e,t,a){},cc08:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA4RpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQ1IDc5LjE2MzQ5OSwgMjAxOC8wOC8xMy0xNjo0MDoyMiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1ZDFiOTQyYS0zZWUyLTkxNGQtOTBiYS1iZTVkYzNjOTU1OTAiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6NzY4QUI4NjE2MUUwMTFFQUE2QjFBQzg4RDAwMDRCRDQiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NzY4QUI4NjA2MUUwMTFFQUE2QjFBQzg4RDAwMDRCRDQiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTkgKFdpbmRvd3MpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6NjEwODNhYzItNzY4Yy02MjRkLWEyYWMtYTFiMTdmOTZhZmZhIiBzdFJlZjpkb2N1bWVudElEPSJhZG9iZTpkb2NpZDpwaG90b3Nob3A6NzRmMzZhYTgtODFhOC04ZTQ5LWExN2UtMDI2MDYwMWE2ZGMwIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+1rWp/gAABUtJREFUeNrsWX9MVVUc/94HT/xVEiqIEgwVZCa0VGrZL1OJRUbRWouIWjUasqHJZq7VP23+mJUV9hudo9LppsV4IZbKVlKmYm7MRiiuhkgs5IGCwft13+1z7j338a7vPnn3wRVtfrcP57377rnnc8/5fH+cgyBJEt1IZqEbzG4SNtsi9S5utbWqHx8HVgOZwMQwxzgGLAH6Q+1QlJsU1gyvA2zAw8Mgy+we4FtgjJmSWA68CbiAVcBkQAgDKcAFIBuoBCJMkQSsjLdr9/4Wu2UYzz/79ILOLLQ/AfnARTyv5MqbcM+wZ3ghb7/iLVvOcsAOSCFiLesIgo1onuQaXgFy68yQxC287ebtO8BKIMbAszcCBZz0j3yGRSY1kF5ldlgrDOPZTMPbeaRhpJkDv8hn/wOQLjCTsG9mPyqKoh/eHie3IRiT0m4eKRjpndw/2MtUgnSu6YkjNcGiaUOw8cB3wDxO+kM0G7jD7wLph0wlfOa8V25beBuiTQX2AwmcNAuZn/GXqQYyhhvWglrpVme4/sLI1gJLeWwuBW4DngUOAYtYGLzeaol0Lo/xmGWRO+FBvgIH1BUYUcIGnS5Yqt7FHBKkXTxGs3ojma/AqDudnuXykCeANEsoOX4rcF04nZ4V8Gjhn6CGDu56WySUl+pFNgPEg70pBnkJ/mOitBT+/wX8UE7H9MukYTTEjbUSPbMoku5ItNCUaIGaz/lklXtfegzFTZYdmRVZXwInR4RwuE635gkrLZuvHS5hivwMVtznzU1W6y25yFrJI8lzo+J0FqiSkWXu8vtfXtqw20Wlnzvo8oAs2zz2Z0edm1ZXOOj7Bg/1O+Tr+TyxXPtM58X4Fy9LFD1RoE1VLuq8pPhw0cdOWjIvgs7bvXS0RZmApnY3zZpuoZQZsu+lAb8Oi7BRK1tupTRolpGVdew3YjdeYu9RT0Af6+BG6gugnqfuKtOjREVJFGVnRlJSnDJM7XEPnbMPHSE/rXWrcmGJpETVuakzXJKtEG1p99In+1zkdBP92RlaOG9s9dJL5U6Kj8ZebXYEvbDMqu4zq0wjPDdRWdftB9z0R3sg0TnxAuU/aKWkWIEGUFH80iTSzvpBefRihnsHiE53eFTC95s6w5P4SUZXXyDZWXECbSkeq70GR5seI9C71e7RKS+b2xSim1+JothJ2mxb9IhVtw8LfemJWkpvPOW792dTCW+udlFDs0i3ThDosfna8xPVCfUsI8miyYyL75RFwGLpClMJ35saQZlpCtGmNm2S6esP7nwXLg3+5kaJb1e+s5z9shHC3UYJ5yxU3GPHITcdO6slbNOJvfIg0Ht9s+j7LqLbxj2+RPWAEcJfGyU853ZFt98cFwN+qzkp0p7DWudq/cdLZduccsTwt1NtkuY0KliU6OOnPzF8dl/nZwmFevldz05joIyZAhVnRdL7NYGev63OQwcbRUqNt9C/TomOnNGvTVLjfQ576mqET5ByzFrIyz31FDPkI6aMmZa7WImYtUBJIA5wrqxzaWJya5cEiLr9X0NKT0a/aTGCJkoE23Gw4yUbJ7qGS6LHqCywe2C1wKvqdw+4Pf+eg3r6JaOlaDXfrAadYbYVX0/KGXE5h2FjJ/kWQaB4FOZLM6dSlNVCwhUboHFjKEC3s2f4XGsxP6toD6Vaewto4DK4G5gQDmkvVvBvu0MmyxbzUcTkmhMiifhcmhNJmQh/Xb0SVexHCu+QKGWaIL8Etw5/sleTxIjHZciDHU0VG+jCSsqsgKuM8DVEHmADeoBeYB+QCqwHDgN9wBFgU7BnCDf/E2qy/SfAAC62Smq8ek9cAAAAAElFTkSuQmCC"},cd6a:function(e,t,a){"use strict";var r=a("af6d"),o=a.n(r);o.a},d8c6:function(e,t,a){},ddc1:function(e,t,a){"use strict";var r=a("95be"),o=a.n(r);o.a},e8b0:function(e,t,a){"use strict";var r=a("1467"),o=a.n(r);o.a},ebfe:function(e,t,a){"use strict";var r=a("bd18"),o=a.n(r);o.a},eee6:function(e,t,a){"use strict";var r=a("f281"),o=a.n(r);o.a},f281:function(e,t,a){},f3ba:function(e,t,a){},f3d5:function(e,t,a){},f3e0:function(e,t,a){"use strict";var r=a("3779"),o=a.n(r);o.a},f76f:function(e,t,a){"use strict";var r=a("3331"),o=a.n(r);o.a},f7a5:function(e,t,a){}});